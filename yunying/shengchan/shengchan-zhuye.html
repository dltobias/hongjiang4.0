<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生产管理 - 烘匠 BakeManager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">

</head>
<body class="bg-[#f7f7f5] h-screen flex flex-col">

    <!-- Header -->
    <div class="bg-white px-4 py-3 shadow-sm border-b border-gray-100 z-30 flex-shrink-0">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
                <a href="../../cangku-gongneng/erp-zhuye-canku.html" class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-50 hover:bg-gray-100 transition-all text-gray-600">
                    <i class="fas fa-chevron-left"></i>
                </a>
                <div>
                    <h1 class="text-lg font-bold text-gray-800">生产计划</h1>
                    <div class="text-xs text-gray-500 flex items-center gap-1">
                        <i class="fas fa-calendar-day"></i> 2023-10-26 (明日)
                        <i class="fas fa-caret-down"></i>
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" onclick="window.location.href='shengchan-lishi.html'">
                    <i class="fas fa-history"></i>
                </button>
            </div>
        </div>
        
        <!-- Dashboard Stats - 已删除 -->
    </div>

    <!-- Navigation Tabs -->
    <div class="bg-white px-4 border-b border-gray-100 flex-shrink-0">
        <div class="flex items-center justify-between">
            <button id="tab-btn-pending" class="nav-tab active flex-1 py-3 text-sm" onclick="switchTab('pending', this)">
                待排产
                <span class="ml-1 text-xs opacity-60">3</span>
            </button>
            <button id="tab-btn-planning" class="nav-tab flex-1 py-3 text-sm" onclick="switchTab('planning', this)">
                生产计划
                <span class="ml-1 text-xs opacity-60">5</span>
            </button>
            <button id="tab-btn-producing" class="nav-tab flex-1 py-3 text-sm" onclick="switchTab('producing', this)">
                生产确认
                <span class="ml-1 text-xs opacity-60">3</span>
            </button>
            <button id="tab-btn-picking" class="nav-tab flex-1 py-3 text-sm" onclick="switchTab('picking', this)">
                领料单
                <span class="ml-1 text-xs opacity-60">2</span>
            </button>
        </div>
    </div>

    <!-- Content Area -->
    <div class="flex-1 overflow-y-auto p-4 custom-scrollbar relative">

        <!-- Tab 1: Pending (待排产) -->
        <div id="view-pending" class="space-y-4">
            <!-- Store 1: City Center Flagship -->
            <div class="card p-4 mb-3 border-l-4 border-l-yellow-400">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">市中心旗舰店 (一号店)</div>
                            <div class="text-xs text-gray-500">期望送达: 明天上午 10:00</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-waiting mb-1">待确认</span>
                    </div>
                </div>
                
                <div id="pending-details-1" class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span>要货清单</span>
                        <span>共 18 品项</span>
                    </div>
                    <div class="divide-y divide-gray-200 max-h-32 overflow-hidden">
                        <!-- 丹麦面团 -->
                        <div class="group mb-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-bread-slice text-orange-500"></i> 丹麦面团 (3)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">法式牛角包</span>
                                    <span class="font-bold">x 30</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">全麦吐司</span>
                                    <span class="font-bold">x 20</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">肉松小贝</span>
                                    <span class="font-bold">x 50</span>
                                </div>
                            </div>
                        </div>

                        <!-- 甜面包 -->
                        <div class="group mb-3 border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-cookie text-yellow-500"></i> 甜面包 (5)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">菠萝包</span>
                                    <span class="font-bold">x 20</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">红豆面包</span>
                                    <span class="font-bold">x 15</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">奶油面包</span>
                                    <span class="font-bold">x 25</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">椰蓉面包</span>
                                    <span class="font-bold">x 10</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">毛毛虫面包</span>
                                    <span class="font-bold">x 12</span>
                                </div>
                            </div>
                        </div>

                        <!-- 欧式面包 -->
                        <div class="group mb-3 border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-cheese text-amber-700"></i> 欧式面包 (8)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">法式长棍</span>
                                    <span class="font-bold">x 10</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">乡村面包</span>
                                    <span class="font-bold">x 8</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">恰巴塔</span>
                                    <span class="font-bold">x 12</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">碱水结</span>
                                    <span class="font-bold">x 20</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">黑麦面包</span>
                                    <span class="font-bold">x 6</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">原味贝果</span>
                                    <span class="font-bold">x 15</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">佛卡夏</span>
                                    <span class="font-bold">x 5</span>
                                </div>
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">意式硬面</span>
                                    <span class="font-bold">x 8</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 包装材料 -->
                        <div class="group mb-3 border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-box text-blue-500"></i> 包装材料 (1)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-blue-50 rounded px-2 py-1.5">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-700">包装盒 (4寸)</span>
                                    </div>
                                    <span class="font-bold">x 50</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 工具/设备 -->
                        <div class="group border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-tools text-purple-500"></i> 工具/设备 (1)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-purple-50 rounded px-2 py-1.5">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-700">蛋糕模具 (4寸)</span>
                                    </div>
                                    <span class="font-bold">x 2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button class="flex-1 py-2.5 bg-white border border-gray-200 rounded-xl text-xs font-medium text-gray-600 active:scale-95 transition-transform" onclick="window.location.href='shengchan-dingdan-xiangqing.html'">
                        <i class="fas fa-eye mr-1"></i> 查看详情
                    </button>
                    <button class="flex-1 py-2.5 bg-blue-600 text-white rounded-xl text-xs font-bold active:scale-95 transition-transform" onclick="confirmOrderWithAutoSplit('store1')">
                        <i class="fas fa-check mr-1"></i> 确认接单
                    </button>
                </div>
            </div>

            <!-- Store 2: Tech Park Branch -->
            <div class="card p-4 mb-3 border-l-4 border-l-green-400">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">科技园分店 (二号店)</div>
                            <div class="text-xs text-gray-500">期望送达: 明天上午 09:00</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-done mb-1">已完成</span>
                    </div>
                </div>
                
                <div id="pending-details-2" class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span>要货清单</span>
                        <span>共 2 品项</span>
                    </div>
                    <div class="space-y-2 max-h-32 overflow-hidden">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-700">菠萝包</span>
                            <span class="font-bold">x 40</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-700">红豆餐包</span>
                            <span class="font-bold">x 30</span>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2">
                     <button class="w-full py-2.5 bg-white border border-gray-200 rounded-xl text-xs font-medium text-gray-600 active:scale-95 transition-transform" onclick="window.location.href='shengchan-dingdan-xiangqing.html?status=completed&statusText=已完成'">
                        <i class="fas fa-eye mr-1"></i> 查看详情
                    </button>
                </div>
            </div>

            <!-- Store 3: Community Store -->
            <div class="card p-4 mb-3 border-l-4 border-l-blue-400">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">幸福社区店 (三号店)</div>
                            <div class="text-xs text-gray-500">期望送达: 明天下午 14:00</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill bg-blue-50 text-blue-600 border border-blue-200 mb-1">已接单</span>
                    </div>
                </div>
                
                <div id="pending-details-3" class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="flex justify-between text-xs text-gray-500 mb-2">
                        <span>要货清单</span>
                        <span>共 3 品项</span>
                    </div>
                    <div class="divide-y divide-gray-200 max-h-32 overflow-hidden">
                        <!-- 可生产商品 -->
                        <div class="group mb-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-industry text-orange-500"></i> 需生产 (1)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-white rounded px-2 py-1.5">
                                    <span class="text-gray-700">提拉米苏</span>
                                    <span class="font-bold">x 15</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 包装材料 -->
                        <div class="group mb-3 border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-box text-blue-500"></i> 包装材料 (1)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-blue-50 rounded px-2 py-1.5">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-700">精美蛋糕盒</span>
                                    </div>
                                    <span class="font-bold">x 15</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 工具/设备 -->
                        <div class="group border-t border-gray-200 pt-3">
                            <div class="text-xs font-medium text-gray-600 mb-2 flex items-center gap-1">
                                <i class="fas fa-tools text-purple-500"></i> 工具/设备 (1)
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center text-sm bg-purple-50 rounded px-2 py-1.5">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-700">冷藏箱</span>
                                    </div>
                                    <span class="font-bold">x 1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button class="flex-1 py-2 bg-white border border-gray-200 rounded-lg text-xs font-medium text-gray-600" onclick="window.location.href='shengchan-dingdan-xiangqing.html?status=completed'">
                        <i class="fas fa-eye mr-1"></i> 查看详情
                    </button>
                    <button class="flex-1 py-2 bg-orange-500 text-white rounded-lg text-xs font-bold shadow-md shadow-orange-200" onclick="switchTab('planning')">
                        <i class="fas fa-tasks mr-1"></i> 去排产
                    </button>
                </div>
            </div>
        </div>


        <!-- Tab 3: Production Confirmation (生产确认) -->
        <div id="view-producing" class="hidden space-y-4">
            <!-- Store 1: City Center Flagship (Completed) -->
            <div class="card p-4 mb-3 border-l-4 border-l-blue-500">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">市中心旗舰店 (一号店)</div>
                            <div class="text-xs text-gray-500">20个品项 | 10:00 截单</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-done mb-1">生产完成</span>
                        <button onclick="toggleStoreCard('store-details-1', this)" class="text-xs text-gray-500 hover:text-blue-600 flex items-center gap-1">
                            <span>展开</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                
                <div id="store-details-1" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
                    <div class="flex justify-between items-center px-3 py-2 bg-gray-100 border-b border-gray-200">
                        <span class="text-xs font-bold text-gray-500">生产明细 (20)</span>
                        <span class="text-xs text-green-600 font-bold">100% 完成</span>
                    </div>
                    <div class="divide-y divide-gray-100 bg-white max-h-48 overflow-y-auto">
                        <!-- Items Generator Script Placeholder -->
                        <!-- 1. 法式牛角包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">法式牛角包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 30</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i1', -1)">-</button>
                                    <input type="number" id="qty-s1-i1" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="30" onchange="checkDiff('s1-i1', 30)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i1', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i1')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i1" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100 flex items-center gap-2">
                                    <div class="text-[10px] text-orange-600 flex-shrink-0 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 差异原因:</div>
                                    <input type="text" id="reason-s1-i1" class="flex-1 text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 2. 全麦吐司 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">全麦吐司</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 20</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i2', -1)">-</button>
                                    <input type="number" id="qty-s1-i2" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="20" onchange="checkDiff('s1-i2', 20)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i2', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i2')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i2" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i2" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 3. 肉松小贝 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">肉松小贝</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 50</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i3', -1)">-</button>
                                    <input type="number" id="qty-s1-i3" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="50" onchange="checkDiff('s1-i3', 50)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i3', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i3')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i3" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i3" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 4. 菠萝包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">菠萝包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 40</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i4', -1)">-</button>
                                    <input type="number" id="qty-s1-i4" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="40" onchange="checkDiff('s1-i4', 40)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i4', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i4')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i4" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i4" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 5. 红豆餐包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">红豆餐包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 35</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i5', -1)">-</button>
                                    <input type="number" id="qty-s1-i5" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="35" onchange="checkDiff('s1-i5', 35)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i5', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i5')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i5" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i5" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 6. 提拉米苏 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">提拉米苏</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 15</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i6', -1)">-</button>
                                    <input type="number" id="qty-s1-i6" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="15" onchange="checkDiff('s1-i6', 15)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i6', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i6')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i6" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i6" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 7. 草莓慕斯 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">草莓慕斯</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 12</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i7', -1)">-</button>
                                    <input type="number" id="qty-s1-i7" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="12" onchange="checkDiff('s1-i7', 12)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i7', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i7')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i7" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i7" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 8. 法棍 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">法棍</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 10</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i8', -1)">-</button>
                                    <input type="number" id="qty-s1-i8" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="10" onchange="checkDiff('s1-i8', 10)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i8', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i8')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i8" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i8" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 9. 甜甜圈 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">甜甜圈</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 45</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i9', -1)">-</button>
                                    <input type="number" id="qty-s1-i9" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="45" onchange="checkDiff('s1-i9', 45)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i9', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i9')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i9" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i9" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 10. 葡式蛋挞 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">葡式蛋挞</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 60</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i10', -1)">-</button>
                                    <input type="number" id="qty-s1-i10" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="60" onchange="checkDiff('s1-i10', 60)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i10', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i10')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i10" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i10" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 11. 芝士蛋糕 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">芝士蛋糕</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 8</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i11', -1)">-</button>
                                    <input type="number" id="qty-s1-i11" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="8" onchange="checkDiff('s1-i11', 8)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i11', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i11')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i11" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i11" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 12. 抹茶卷 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">抹茶卷</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 16</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i12', -1)">-</button>
                                    <input type="number" id="qty-s1-i12" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="16" onchange="checkDiff('s1-i12', 16)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i12', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i12')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i12" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i12" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 13. 巧克力麦芬 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">巧克力麦芬</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 24</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i13', -1)">-</button>
                                    <input type="number" id="qty-s1-i13" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="24" onchange="checkDiff('s1-i13', 24)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i13', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i13')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i13" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i13" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 14. 黄油曲奇 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">黄油曲奇</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 50</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i14', -1)">-</button>
                                    <input type="number" id="qty-s1-i14" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="50" onchange="checkDiff('s1-i14', 50)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i14', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i14')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i14" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i14" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 15. 酸种面包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">酸种面包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 6</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i15', -1)">-</button>
                                    <input type="number" id="qty-s1-i15" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="6" onchange="checkDiff('s1-i15', 6)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i15', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i15')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i15" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i15" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 16. 碱水结 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">碱水结</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 18</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i16', -1)">-</button>
                                    <input type="number" id="qty-s1-i16" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="18" onchange="checkDiff('s1-i16', 18)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i16', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i16')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i16" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i16" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 17. 马卡龙 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">马卡龙</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 100</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i17', -1)">-</button>
                                    <input type="number" id="qty-s1-i17" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="100" onchange="checkDiff('s1-i17', 100)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i17', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i17')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i17" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i17" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 18. 泡芙 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">泡芙</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 40</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i18', -1)">-</button>
                                    <input type="number" id="qty-s1-i18" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="40" onchange="checkDiff('s1-i18', 40)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i18', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i18')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i18" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i18" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 19. 水果塔 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">水果塔</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 20</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i19', -1)">-</button>
                                    <input type="number" id="qty-s1-i19" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="20" onchange="checkDiff('s1-i19', 20)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i19', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i19')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i19" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i19" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- 20. 蒜香面包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">蒜香面包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 15</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i20', -1)">-</button>
                                    <input type="number" id="qty-s1-i20" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="15" onchange="checkDiff('s1-i20', 15)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s1-i20', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's1-i20')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s1-i20" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s1-i20" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2 mt-3">
                    <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                        <i class="fas fa-file-alt mr-1"></i> 查看配方
                    </button>
                    <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-md active:scale-95 transition-transform"
                            onclick="submitProduction(this)">
                        <i class="fas fa-check-double mr-1"></i> 确认提交生产单
                    </button>
                </div>
            </div>

            <!-- Pending Confirmation Task (from Mixing) -->
            <div id="pending-confirmation-p1" class="hidden card p-4 mb-3 border-l-4 border-l-yellow-400">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm">
                            <i class="fas fa-croissant"></i>
                        </div>
                        <div>
                            <div class="font-bold text-gray-800">法式牛角包面团</div>
                            <div class="text-xs text-gray-500">计划: 50 | 待最终确认</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill bg-yellow-100 text-yellow-700 mb-1">待确认</span>
                    </div>
                </div>
                
                <div id="confirm-details-p1" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 mt-2 max-h-48 overflow-y-auto">
                    <div class="p-3">
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">法式牛角包面团</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 50</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-sm font-bold">50</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2 mt-3">
                    <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                        <i class="fas fa-file-alt mr-1"></i> 查看配方
                    </button>
                    <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-md active:scale-95 transition-transform" onclick="submitProduction(this)">
                        <i class="fas fa-check-double mr-1"></i> 确认提交生产单
                    </button>
                </div>
            </div>

            <!-- Store 2: Tech Park Branch (Completed/Ready for Check) -->
            <div class="card p-4 mb-3 border-l-4 border-l-green-500">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">科技园分店 (二号店)</div>
                            <div class="text-xs text-gray-500">20个品项 | 09:30 截单</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-done mb-1">生产完成</span>
                        <button onclick="toggleStoreCard('store-details-2', this)" class="text-xs text-gray-500 hover:text-green-600 flex items-center gap-1">
                            <span>展开</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                
                <div id="store-details-2" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
                    <div class="flex justify-between items-center px-3 py-2 bg-gray-100 border-b border-gray-200">
                        <span class="text-xs font-bold text-gray-500">生产明细 (20)</span>
                        <span class="text-xs text-green-600 font-bold">100% (20/20)</span>
                    </div>
                    <div class="divide-y divide-gray-100 bg-white max-h-48 overflow-y-auto">
                        <!-- 1. 菠萝包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">菠萝包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 40</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i1', -1)">-</button>
                                    <input type="number" id="qty-s2-i1" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="40" onchange="checkDiff('s2-i1', 40)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i1', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i1')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i1" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100 flex items-center gap-2">
                                    <div class="text-[10px] text-orange-600 flex-shrink-0 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 差异原因:</div>
                                    <input type="text" id="reason-s2-i1" class="flex-1 text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 2. 红豆餐包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">红豆餐包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 30</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i2', -1)">-</button>
                                    <input type="number" id="qty-s2-i2" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="30" onchange="checkDiff('s2-i2', 30)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i2', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i2')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i2" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i2" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 3. 法式牛角包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">法式牛角包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 30</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i3', -1)">-</button>
                                    <input type="number" id="qty-s2-i3" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="30" onchange="checkDiff('s2-i3', 30)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i3', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i3')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i3" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i3" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 4. 全麦吐司 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">全麦吐司</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 20</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i4', -1)">-</button>
                                    <input type="number" id="qty-s2-i4" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="20" onchange="checkDiff('s2-i4', 20)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i4', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i4')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i4" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i4" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 5. 肉松小贝 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">肉松小贝</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 50</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i5', -1)">-</button>
                                    <input type="number" id="qty-s2-i5" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="50" onchange="checkDiff('s2-i5', 50)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i5', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i5')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i5" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i5" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 6. 提拉米苏 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">提拉米苏</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 15</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i6', -1)">-</button>
                                    <input type="number" id="qty-s2-i6" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="15" onchange="checkDiff('s2-i6', 15)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i6', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i6')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i6" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i6" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 7. 草莓慕斯 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">草莓慕斯</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 12</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i7', -1)">-</button>
                                    <input type="number" id="qty-s2-i7" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="12" onchange="checkDiff('s2-i7', 12)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i7', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i7')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i7" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i7" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 8. 法棍 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">法棍</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 10</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i8', -1)">-</button>
                                    <input type="number" id="qty-s2-i8" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="10" onchange="checkDiff('s2-i8', 10)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i8', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i8')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i8" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i8" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 9. 甜甜圈 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">甜甜圈</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 45</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i9', -1)">-</button>
                                    <input type="number" id="qty-s2-i9" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="45" onchange="checkDiff('s2-i9', 45)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i9', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i9')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i9" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i9" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 10. 葡式蛋挞 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">葡式蛋挞</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 60</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i10', -1)">-</button>
                                    <input type="number" id="qty-s2-i10" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="60" onchange="checkDiff('s2-i10', 60)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i10', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i10')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i10" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i10" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 11. 芝士蛋糕 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">芝士蛋糕</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 8</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i11', -1)">-</button>
                                    <input type="number" id="qty-s2-i11" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="8" onchange="checkDiff('s2-i11', 8)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i11', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i11')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i11" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i11" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 12. 抹茶卷 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">抹茶卷</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 16</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i12', -1)">-</button>
                                    <input type="number" id="qty-s2-i12" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="16" onchange="checkDiff('s2-i12', 16)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i12', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i12')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i12" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i12" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 13. 巧克力麦芬 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">巧克力麦芬</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 24</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i13', -1)">-</button>
                                    <input type="number" id="qty-s2-i13" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="24" onchange="checkDiff('s2-i13', 24)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i13', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i13')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i13" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i13" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 14. 黄油曲奇 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">黄油曲奇</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 50</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i14', -1)">-</button>
                                    <input type="number" id="qty-s2-i14" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="50" onchange="checkDiff('s2-i14', 50)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i14', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i14')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i14" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i14" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 15. 酸种面包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">酸种面包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 6</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i15', -1)">-</button>
                                    <input type="number" id="qty-s2-i15" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="6" onchange="checkDiff('s2-i15', 6)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i15', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i15')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i15" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i15" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 16. 碱水结 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">碱水结</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 18</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i16', -1)">-</button>
                                    <input type="number" id="qty-s2-i16" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="18" onchange="checkDiff('s2-i16', 18)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i16', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i16')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i16" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i16" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 17. 马卡龙 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">马卡龙</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 100</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i17', -1)">-</button>
                                    <input type="number" id="qty-s2-i17" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="100" onchange="checkDiff('s2-i17', 100)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i17', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i17')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i17" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i17" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 18. 泡芙 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">泡芙</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 40</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i18', -1)">-</button>
                                    <input type="number" id="qty-s2-i18" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="40" onchange="checkDiff('s2-i18', 40)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i18', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i18')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i18" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i18" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 19. 水果塔 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">水果塔</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 20</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i19', -1)">-</button>
                                    <input type="number" id="qty-s2-i19" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="20" onchange="checkDiff('s2-i19', 20)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i19', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i19')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i19" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i19" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>

                        <!-- 20. 蒜香面包 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">蒜香面包</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 15</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i20', -1)">-</button>
                                    <input type="number" id="qty-s2-i20" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="15" onchange="checkDiff('s2-i20', 15)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('s2-i20', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 's2-i20')">确认</button>
                                </div>
                            </div>
                            <div id="diff-s2-i20" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-s2-i20" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <div class="flex gap-2 mt-3">
                <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                    <i class="fas fa-file-alt mr-1"></i> 查看配方
                </button>
                <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-md active:scale-95 transition-transform"
                        onclick="submitProduction(this)">
                    <i class="fas fa-check-double mr-1"></i> 确认提交生产单
                </button>
            </div>
            </div>

            <!-- Test Store 1: 2 items -->
            <div class="card p-4 mb-3 border-l-4 border-l-gray-400">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">测试门店 (2条数据)</div>
                            <div class="text-xs text-gray-500">2个品项 | 测试数据</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-done mb-1">生产完成</span>
                    </div>
                </div>
                
                <div id="store-details-test-1" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
                    <div class="flex justify-between items-center px-3 py-2 bg-gray-100 border-b border-gray-200">
                        <span class="text-xs font-bold text-gray-500">生产明细 (2)</span>
                        <span class="text-xs text-green-600 font-bold">100%</span>
                    </div>
                    <div class="divide-y divide-gray-100 bg-white max-h-48 overflow-y-auto">
                        <!-- Item 1 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">测试商品 A</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 10</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('t1-i1', -1)">-</button>
                                    <input type="number" id="qty-t1-i1" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="10" onchange="checkDiff('t1-i1', 10)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('t1-i1', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 't1-i1')">确认</button>
                                </div>
                            </div>
                            <div id="diff-t1-i1" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-t1-i1" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">测试商品 B</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 5</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('t1-i2', -1)">-</button>
                                    <input type="number" id="qty-t1-i2" class="w-10 h-7 text-center border-none bg-transparent text-sm font-bold focus:ring-0 p-0" value="5" onchange="checkDiff('t1-i2', 5)">
                                    <button class="w-7 h-7 flex items-center justify-center bg-gray-50 rounded text-gray-600 hover:bg-gray-200 active:bg-gray-300 transition-colors" onclick="updateQty('t1-i2', 1)">+</button>
                                    <button class="ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors" onclick="confirmSingleItem(this, 't1-i2')">确认</button>
                                </div>
                            </div>
                            <div id="diff-t1-i2" class="hidden px-2 pb-1">
                                <div class="bg-orange-50 rounded p-1.5 border border-orange-100">
                                    <div class="text-[10px] text-orange-600 mb-0.5 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> 数量差异原因</div>
                                    <input type="text" id="reason-t1-i2" class="w-full text-[10px] border border-gray-200 rounded px-1.5 py-0.5 bg-white h-6" placeholder="输入具体原因...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-2 mt-3">
                    <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                        <i class="fas fa-file-alt mr-1"></i> 查看配方
                    </button>
                    <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-sm font-bold shadow-md shadow-orange-200 active:scale-95 transition-transform"
                        onclick="submitProduction(this)">
                    <i class="fas fa-check-double mr-1"></i> 确认提交生产单
                </button>
                </div>
            </div>

            <!-- Test Store 2: 1 item -->
            <div class="card p-4 mb-3 border-l-4 border-l-gray-400">
                <div class="flex justify-between items-start mb-3 border-b border-gray-100 pb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-bold text-sm"><i class="fas fa-store"></i></div>
                        <div>
                            <div class="font-bold text-gray-800">测试门店 (1条数据)</div>
                            <div class="text-xs text-gray-500">1个品项 | 测试数据</div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="status-pill status-done mb-1">生产完成</span>
                    </div>
                </div>
                
                <div id="store-details-test-2" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
                    <div class="flex justify-between items-center px-3 py-2 bg-gray-100 border-b border-gray-200">
                        <span class="text-xs font-bold text-gray-500">生产明细 (1)</span>
                        <span class="text-xs text-green-600 font-bold">100%</span>
                    </div>
                    <div class="divide-y divide-gray-100 bg-white max-h-48 overflow-y-auto">
                        <!-- Item 1 -->
                        <div class="group">
                            <div class="flex justify-between items-center p-2 hover:bg-gray-50 transition-colors">
                                <div class="flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-800 leading-tight">测试商品 C</span>
                                    <span class="text-[10px] text-gray-400 mt-0.5">计划: 8</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-sm font-bold">8</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-2 mt-3">
                    <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                        <i class="fas fa-file-alt mr-1"></i> 查看配方
                    </button>
                    <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-md active:scale-95 transition-transform"
                        onclick="submitProduction(this)">
                    <i class="fas fa-check-double mr-1"></i> 确认提交生产单
                </button>
                </div>
            </div>

            <!-- Success View (Hidden by default) -->
            <div id="production-submit-success" class="hidden flex flex-col items-center justify-center py-10">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4 animate-bounce">
                    <i class="fas fa-check text-4xl text-green-500"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">生产单提交成功！</h3>
                <p class="text-gray-500 text-sm mb-8 text-center px-8">
                    生产数据已确认，系统已自动生成<br>配送单和上架任务。
                </p>
                
                <div class="w-full space-y-3">
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center justify-between" onclick="window.location.href='../../peisong/peisong-fenpei.html'">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-500">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="text-left">
                                <div class="font-bold text-gray-800 text-sm">去配送分配</div>
                                <div class="text-xs text-gray-400">查看智能配送路线</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-300"></i>
                    </div>
                    
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center justify-between" onclick="window.location.href='../shangjia/shangjia-zhuye.html'">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-500">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="text-left">
                                <div class="font-bold text-gray-800 text-sm">去上架管理</div>
                                <div class="text-xs text-gray-400">打印价签/上架确认</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-300"></i>
                    </div>
                </div>
                
                <button onclick="resetProductionView()" class="mt-8 text-gray-400 text-sm hover:text-gray-600">
                    返回生产列表
                </button>
            </div>
        </div>

        <!-- Tab 2: Production Plan (生产计划) - Default View -->
        <div id="view-planning" class="hidden space-y-4">
            <!-- Category Group: Bread -->
            <div class="mb-6" data-category="bread">
                <!-- Category Content (Always Visible, Cards handle collapse) -->
                <div>
                <!-- Combined Production Task (New Feature) -->
                <div class="card p-4 mb-3 border-l-4 border-l-orange-400" id="card-combined-task">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm"><i class="fas fa-layer-group"></i></div>
                            <div>
                                <div class="font-bold text-gray-800">基础甜面团 (共用)</div>
                                <div class="text-xs text-gray-500">80kg | 包含3种产品</div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <span class="status-pill status-mixing mb-1">进行中</span>
                        </div>
                    </div>
                    
                    <div id="combined-task-details" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 mt-2">
                        <div class="scroll-content p-3 pb-0 max-h-32 overflow-hidden">
                            <div class="text-xs text-gray-500 mb-2">包含产品 (共3种)</div>
                            <div class="space-y-2 mb-3">
                                <div class="flex justify-between items-center text-sm border-b border-gray-100 pb-1">
                                    <span class="text-gray-700">菠萝包</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p0-i1">x 50 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p0', 'i1', '菠萝包', 50)">调整</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-sm border-b border-gray-100 pb-1">
                                    <span class="text-gray-700">肉松面包</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p0-i2">x 30 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p0', 'i2', '肉松面包', 30)">调整</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-700">红豆餐包</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p0-i3">x 20 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p0', 'i3', '红豆餐包', 20)">调整</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress (with ID for hiding) - REMOVED -->
                            <!-- <div class="mb-3" id="combined-progress-section">...</div> -->
                        </div>

                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <div class="flex gap-2" id="combined-action-area">
                                <button class="flex-1 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform" onclick="window.location.href='shengchan-jihua-xiangqing.html?status=in_progress'">
                                    <i class="fas fa-eye mr-1"></i> 查看详情
                                </button>
                                <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-zhixing.html'">
                                    <i class="fas fa-play mr-1"></i> 进行中
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Card 1 -->
                <div class="card p-4 mb-3 border-l-4 border-l-orange-400 relative overflow-hidden">
                    <!-- Header Info -->
                    <div class="flex justify-between items-start mb-2 relative z-10">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm">
                                <i class="fas fa-bread-slice"></i>
                            </div>
                            <div>
                                <div class="font-bold text-gray-800">法式牛角包面团</div>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <span>计划: <span id="plan-qty-p1" class="font-bold text-gray-800">50</span></span>
                                    <span class="text-gray-300">|</span>
                                    <span>规格: 65g/个</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <span class="status-pill status-mixing mb-1">进行中</span>
                        </div>
                    </div>

                    <div id="p1-details" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 mt-2">
                        <div class="scroll-content p-3 pb-0 max-h-32 overflow-hidden">
                            <div class="text-xs text-gray-500 mb-2">包含产品 (共2种)</div>
                            <div class="space-y-2 mb-3">
                                <div class="flex justify-between items-center text-sm border-b border-gray-100 pb-1">
                                    <span class="text-gray-700">法式牛角包</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p1-i1">x 35 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p1', 'i1', '法式牛角包', 35)">调整</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-700">杏仁牛角包</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p1-i2">x 15 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p1', 'i2', '杏仁牛角包', 15)">调整</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Picking Status (Factory Mode Only) -->
                        <!-- Removed: Moved to Picking Details Page -->

                        <!-- Actions -->
                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <div class="flex gap-2" id="action-area-p1">
                                <button class="flex-1 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform" onclick="window.location.href='shengchan-jihua-xiangqing.html?status=in_progress'">
                                    <i class="fas fa-eye mr-1"></i> 查看详情
                                </button>
                                <button id="btn-start-p1" class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-zhixing.html?id=p1'">
                                    <i class="fas fa-play mr-1"></i> 进行中
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Card 2 (Simple Example) -->
                <div class="card p-4">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm">C</div>
                            <div>
                                <div class="font-bold text-gray-800">全麦吐司面团</div>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <span>计划: <span id="plan-qty-p2" class="font-bold text-gray-800">30</span></span>
                                    <span class="text-gray-300">|</span>
                                    <span>规格: 450g/个</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <span class="status-pill status-waiting mb-1">未开始</span>
                        </div>
                    </div>

                    <div id="p2-details" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 mt-2">
                        <div class="scroll-content p-3 pb-0 max-h-32 overflow-hidden">
                            <div class="text-xs text-gray-500 mb-2">包含产品 (共2种)</div>
                            <div class="space-y-2 mb-3">
                                <div class="flex justify-between items-center text-sm border-b border-gray-100 pb-1">
                                    <span class="text-gray-700">全麦吐司 (450g)</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p2-i1">x 20 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p2', 'i1', '全麦吐司 (450g)', 20)">调整</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-700">坚果全麦吐司</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p2-i2">x 10 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p2', 'i2', '坚果全麦吐司', 10)">调整</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress - REMOVED -->
                            <!-- <div class="mb-3">...</div> -->
                        </div>

                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <div class="flex gap-2">
                                <button class="flex-1 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform" onclick="window.location.href='shengchan-jihua-xiangqing.html?status=not_started'">
                                    <i class="fas fa-eye mr-1"></i> 查看详情
                                </button>
                                <button class="flex-1 py-2.5 bg-orange-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="alert('正在校验原料库存... 库存充足'); window.location.href='shengchan-zhixing.html'">
                                    <i class="fas fa-play mr-1"></i> 开始生产
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                </div>
            </div>

            <!-- Category Group: Cake -->
            <div class="mb-20" data-category="cake">
                <!-- Category Content -->
                <div class="card p-4 mb-3 border-l-4 border-l-pink-400">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-pink-100 flex items-center justify-center text-pink-500 font-bold text-sm">D</div>
                            <div>
                                <div class="font-bold text-gray-800">草莓慕斯</div>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <span>计划: <span id="plan-qty-p3" class="font-bold text-gray-800">20</span></span>
                                    <span class="text-gray-300">|</span>
                                    <span>规格: 4寸</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                             <span class="status-pill status-done mb-1">生产完成</span>
                        </div>
                    </div>
                    
                    <!-- Details Container -->
                    <div id="cake-details" class="bg-gray-50 rounded-lg overflow-hidden border border-gray-200 mt-2">
                        <div class="scroll-content p-3 pb-0 max-h-32 overflow-hidden">
                            <div class="text-xs text-gray-500 mb-2">包含产品 (共1种)</div>
                            <div class="space-y-2 mb-3">
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-700">草莓慕斯</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium" id="sub-qty-p3-i1">x 20 个</span>
                                        <button class="text-blue-500 text-[10px] bg-blue-50 px-1.5 py-0.5 rounded" onclick="openSubItemAdjustModal('p3', 'i1', '草莓慕斯', 20)">调整</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-3 bg-gray-50 border-t border-gray-200">
                            <div class="flex gap-2">
                                <button class="flex-1 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform" onclick="window.location.href='shengchan-jihua-xiangqing.html?status=completed'">
                                    <i class="fas fa-eye mr-1"></i> 查看详情
                                </button>
                                <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                                    <i class="fas fa-file-alt mr-1"></i> 查看配方
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: Picking List (领料单) -->
        <div id="view-picking" class="hidden space-y-4">
            <!-- Category Pills - REMOVED -->

            <!-- Section: Cold Storage (Priority) -->
            <div class="picking-section" data-category="cold">
                <h3 class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-2 pl-1">
                    <i class="fas fa-snowflake text-blue-400"></i> 冷藏/冷冻原料
                </h3>
                
                <!-- Item: Butter (Warning) -->
                <div class="card p-4 mb-3 border-l-4 border-l-red-400">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-yellow-50 flex items-center justify-center text-yellow-600 font-bold text-lg">
                                <i class="fas fa-cheese"></i>
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">总统发酵黄油块</div>
                                <div class="text-xs text-red-500 font-medium flex items-center gap-1">
                                    <i class="fas fa-exclamation-circle"></i> 库存不足 (剩 20kg)
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">25.0 kg</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('butter', -0.5)">-</button>
                            <input type="number" id="qty-butter" class="w-20 h-8 text-center bg-white border border-red-300 rounded-lg text-sm font-bold text-red-600 qty-input" value="20.0">
                            <span class="text-xs text-gray-500">kg</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('butter', 0.5)">+</button>
                        </div>
                    </div>
                </div>

                <!-- Item: Cream -->
                <div class="card p-4 mb-3 border-l-4 border-l-blue-400">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500 font-bold text-lg">
                                <i class="fas fa-wine-bottle"></i>
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">铁塔淡奶油</div>
                                <div class="text-xs text-green-600 font-medium">库存充足</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">12.0 L</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('cream', -1)">-</button>
                            <input type="number" id="qty-cream" class="w-20 h-8 text-center bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-800 qty-input" value="12.0">
                            <span class="text-xs text-gray-500">L</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('cream', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section: Dry Goods -->
            <div class="picking-section" data-category="dry">
                <h3 class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-2 pl-1">
                    <i class="fas fa-cubes text-orange-400"></i> 常温/干货原料
                </h3>
                
                <!-- Item: Flour T55 -->
                <div class="card p-4 mb-3 border-l-4 border-l-orange-400">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center text-orange-600 font-bold text-lg">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">王后T55法式面粉</div>
                                <div class="text-xs text-green-600 font-medium">库存充足</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">80.0 kg</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('flour', -5)">-</button>
                            <input type="number" id="qty-flour" class="w-20 h-8 text-center bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-800 qty-input" value="80.0">
                            <span class="text-xs text-gray-500">kg</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('flour', 5)">+</button>
                        </div>
                    </div>
                </div>
                 <!-- Item: Sugar -->
                <div class="card p-4 mb-3 border-l-4 border-l-orange-400">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center text-gray-600 font-bold text-lg">
                                <i class="fas fa-cube"></i>
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">太古细砂糖</div>
                                <div class="text-xs text-green-600 font-medium">库存充足</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">15.0 kg</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('sugar', -1)">-</button>
                            <input type="number" id="qty-sugar" class="w-20 h-8 text-center bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-800 qty-input" value="15.0">
                            <span class="text-xs text-gray-500">kg</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('sugar', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section: Packaging -->
            <div class="picking-section" data-category="package">
                <h3 class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-2 pl-1">
                    <i class="fas fa-box text-blue-500"></i> 包装耗材
                </h3>
                
                <div class="card p-3 mb-3">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500 font-bold text-xl">
                                🎁
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">4寸透明蛋糕盒</div>
                                <div class="text-xs text-gray-500 font-medium">配套底托 + 丝带</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">50 套</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('box', -5)">-</button>
                            <input type="number" id="qty-box" class="w-20 h-8 text-center bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-800 qty-input" value="50">
                            <span class="text-xs text-gray-500">套</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('box', 5)">+</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section: Tools -->
            <div class="picking-section" data-category="tools">
                <h3 class="text-xs font-bold text-gray-500 mb-2 flex items-center gap-2 pl-1">
                    <i class="fas fa-tools text-purple-500"></i> 工具/模具 (需归还)
                </h3>
                
                <div class="card p-3 mb-3">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center text-purple-500 font-bold text-xl">
                                🔧
                            </div>
                            <div>
                                <div class="font-bold text-gray-800 text-sm">4寸圆形活底模具</div>
                                <div class="text-xs text-purple-600 font-medium">当前可用: 45个</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">理论需求</div>
                            <div class="text-sm font-bold text-gray-800">20 个</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-2 flex items-center justify-between gap-3">
                        <span class="text-xs font-bold text-gray-600">实领量:</span>
                        <div class="flex items-center gap-2 flex-1 justify-end">
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('tool', -1)">-</button>
                            <input type="number" id="qty-tool" class="w-20 h-8 text-center bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-800 qty-input" value="20">
                            <span class="text-xs text-gray-500">个</span>
                            <button class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-500 active:scale-95" onclick="adjustPickingQty('tool', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Actions -->
            <div class="flex gap-3 mt-4 pb-4">
                <button class="flex-1 py-3 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold shadow-sm active:scale-95 transition-transform flex items-center justify-center gap-2">
                    <i class="fas fa-print"></i> 打印清单
                </button>
                <button class="flex-[2] py-3 bg-orange-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform flex items-center justify-center gap-2" onclick="showPickingConfirmModal()">
                    <i class="fas fa-check-circle"></i> 确认领料并出库
                </button>
            </div>
        </div>

    </div>

    <!-- Floating Action Button (Add Plan) -->
    <div class="fixed bottom-6 right-6 z-40">
        <button class="w-14 h-14 bg-gray-900 text-white rounded-full shadow-xl flex items-center justify-center text-xl hover:scale-105 transition-transform" onclick="showAddModal()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Progress Update Modal -->
    <div id="progressModal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">更新生产进度</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-600 mb-2">本次完成数量</label>
                <div class="flex items-center gap-3">
                    <button class="w-10 h-10 rounded-lg border border-gray-200 flex items-center justify-center text-gray-600" onclick="adjustModalQty(-5)">-5</button>
                    <input type="number" id="modalQty" class="flex-1 h-10 border border-gray-200 rounded-lg text-center font-bold text-lg" value="10">
                    <button class="w-10 h-10 rounded-lg border border-gray-200 flex items-center justify-center text-gray-600" onclick="adjustModalQty(5)">+5</button>
                </div>
            </div>

            <div class="flex gap-3">
                <button class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-medium" onclick="closeProgressModal()">取消</button>
                <button class="flex-1 py-3 rounded-xl bg-orange-500 text-white font-bold" onclick="saveProgress()">确认</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="submitConfirmModal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-[320px] rounded-2xl p-6 animate-slide-up text-center">
            <div class="w-14 h-14 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-exclamation text-2xl text-orange-500"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-800 mb-2">确认提交生产单？</h3>
            <p class="text-sm text-gray-500 mb-6 leading-relaxed">
                请确认生产数量无误。<br>提交后将自动转入<span class="text-orange-600 font-bold">配送分配</span>环节。
            </p>
            <div class="flex gap-3">
                <button class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200 transition-colors" onclick="closeSubmitModal()">
                    再核对
                </button>
                <button class="flex-1 py-3 rounded-xl bg-orange-500 text-white font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="confirmSubmitModal()">
                    确认提交
                </button>
            </div>
        </div>
    </div>

    <!-- Sub-item Adjustment Modal -->
    <div id="subItemAdjustModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 animate-slide-up">
            <h3 class="text-lg font-bold text-gray-800 mb-1">调整产品数量</h3>
            <p id="sub-adjust-item-name" class="text-sm text-gray-500 mb-4">调整对象...</p>
            
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-600 mb-2 uppercase">计划生产数量</label>
                <div class="flex items-center gap-3">
                    <button class="w-12 h-12 rounded-xl bg-gray-100 border border-gray-200 flex items-center justify-center text-gray-600 active:scale-95 transition-transform" onclick="adjustSubModalValue(-1)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="sub-adjust-qty-input" class="flex-1 h-12 border-2 border-orange-100 focus:border-orange-500 rounded-xl text-center font-bold text-2xl text-orange-600 outline-none transition-colors" value="50">
                    <button class="w-12 h-12 rounded-xl bg-gray-100 border border-gray-200 flex items-center justify-center text-gray-600 active:scale-95 transition-transform" onclick="adjustSubModalValue(1)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="text-center mt-2 text-xs text-blue-500">
                    <i class="fas fa-info-circle"></i> 此调整将同步更新总面团需求量
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-600 mb-2 uppercase">调整原因 (必填)</label>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setSubAdjustReason('客户加单')">客户加单</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setSubAdjustReason('客户减单')">客户减单</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setSubAdjustReason('原料不足')">原料不足</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setSubAdjustReason('其他')">其他</button>
                </div>
                <textarea id="sub-adjust-reason" class="w-full h-20 p-3 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-orange-100 outline-none resize-none" placeholder="请输入具体调整原因..."></textarea>
            </div>

            <div class="flex gap-3">
                <button class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200 transition-colors" onclick="closeSubItemAdjustModal()">
                    取消
                </button>
                <button class="flex-1 py-3 rounded-xl bg-orange-500 text-white font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="saveSubAdjustPlan()">
                    确认调整
                </button>
            </div>
        </div>
    </div>

    <!-- Plan Adjustment Modal -->
    <div id="adjustModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 animate-slide-up">
            <h3 class="text-lg font-bold text-gray-800 mb-1">调整生产计划</h3>
            <p id="adjust-item-name" class="text-sm text-gray-500 mb-4">调整对象...</p>
            
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-600 mb-2 uppercase">计划生产数量</label>
                <div class="flex items-center gap-3">
                    <button class="w-12 h-12 rounded-xl bg-gray-100 border border-gray-200 flex items-center justify-center text-gray-600 active:scale-95 transition-transform" onclick="adjustModalValue(-5)">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" id="adjust-qty-input" class="flex-1 h-12 border-2 border-orange-100 focus:border-orange-500 rounded-xl text-center font-bold text-2xl text-orange-600 outline-none transition-colors" value="50">
                    <button class="w-12 h-12 rounded-xl bg-gray-100 border border-gray-200 flex items-center justify-center text-gray-600 active:scale-95 transition-transform" onclick="adjustModalValue(5)">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="text-center mt-2 text-xs text-orange-500 hidden" id="qty-change-hint">
                    <i class="fas fa-sync-alt"></i> 领料单将同步调整
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-600 mb-2 uppercase">调整原因 (必填)</label>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setAdjustReason('原料不足')">原料不足</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setAdjustReason('设备限制')">设备限制</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setAdjustReason('订单变更')">订单变更</button>
                    <button class="py-2 px-3 rounded-lg border border-gray-200 text-xs text-gray-600 hover:border-orange-500 hover:text-orange-600 transition-colors" onclick="setAdjustReason('其他')">其他</button>
                </div>
                <textarea id="adjust-reason" class="w-full h-20 p-3 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-orange-100 outline-none resize-none" placeholder="请输入具体调整原因..."></textarea>
            </div>

            <div class="flex gap-3">
                <button class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200 transition-colors" onclick="closeAdjustModal()">
                    取消
                </button>
                <button class="flex-1 py-3 rounded-xl bg-orange-500 text-white font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="saveAdjustPlan()">
                    确认调整
                </button>
            </div>
        </div>
    </div>

    <!-- Picking Confirmation Modal -->
    <div id="pickingConfirmModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-[320px] rounded-2xl p-6 animate-slide-up text-center">
            <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-warehouse text-2xl text-green-500"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-800 mb-2">确认库存出库？</h3>
            <p class="text-sm text-gray-500 mb-6 leading-relaxed">
                系统将根据<span class="text-orange-600 font-bold">实领量</span>扣减库存。<br>
                <span class="text-xs text-gray-400">(黄油缺口将生成补货提醒)</span>
            </p>
            <div class="flex gap-3">
                <button class="flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold active:bg-gray-200 transition-colors" onclick="closePickingConfirmModal()">
                    再核对
                </button>
                <button class="flex-1 py-3 rounded-xl bg-orange-500 text-white font-bold shadow-lg shadow-orange-200 active:scale-95 transition-transform" onclick="completePicking()">
                    确认出库
                </button>
            </div>
        </div>
    </div>

    <script>
        // 检查来自执行页面的任务完成状态
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('task_completed') === 'true') {
                updateTaskToCompleted();
            }
        });

        function updateTaskToCompleted() {
            // Update Combined Task Status
            const progressSection = document.getElementById('combined-progress-section');
            const actionArea = document.getElementById('combined-action-area');
            const card = document.getElementById('card-combined-task');

            // Hide Progress Section
            if (progressSection) {
                progressSection.style.display = 'none';
            }

            // Update Action Area
            if (actionArea) {
                actionArea.innerHTML = `
                    <button class="flex-1 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform" onclick="window.location.href='shengchan-jihua-xiangqing.html?status=completed'">
                        <i class="fas fa-eye mr-1"></i> 查看详情
                    </button>
                    <button class="flex-1 py-2.5 bg-green-50 text-green-600 rounded-xl text-xs font-bold border border-green-100 active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html?status=completed'">
                        <i class="fas fa-file-alt mr-1"></i> 查看配方
                    </button>
                `;
            }
            
            // Change border color to indicate success
            if (card) {
                card.classList.remove('border-l-orange-400');
                card.classList.add('border-l-green-500');
            }

            // Show Toast
            showToast('✅ 生产任务已完成，库存已扣除');
        }

        // 简单的 Toast 提示函数
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-gray-900/90 backdrop-blur text-white px-4 py-3 rounded-xl shadow-xl z-[110] text-sm font-medium transition-all duration-300 transform translate-y-0 opacity-0 flex items-center gap-2';
            toast.innerHTML = message;
            document.body.appendChild(toast);
            
            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('translate-y-2');
            });

            setTimeout(() => {
                toast.classList.remove('translate-y-2');
                toast.classList.add('opacity-0', '-translate-y-2');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // 标签页切换
        function switchTab(tabName, btn) {
            if (!btn) {
                btn = document.getElementById('tab-btn-' + tabName);
            }
            if (!btn) return;

            document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            ['pending', 'producing', 'planning', 'picking'].forEach((view) => {
                const el = document.getElementById('view-' + view);
                if (view === tabName) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
        }

        // 从 URL 初始化标签页
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            if (tab) {
                switchTab(tab);
            }
            
            // Initialize production confirmation cards
            // Check quantity differences on page load
            setTimeout(() => {
                checkQuantityDifference('1', 50);
                checkQuantityDifference('2', 30);
                checkQuantityDifference('3', 20);
                
                // Initialize default state as collapsed (show only first 3 items)
                initializeCollapsedState('store-details-1');
                initializeCollapsedState('store-details-2');
                initializeCollapsedState('pending-details-1');
                initializeCollapsedState('pending-details-2');
                initializeCollapsedState('pending-details-3');
                initializeCollapsedState('store-details-test-1');
                initializeCollapsedState('store-details-test-2');
                
                // Initialize Production Plan cards
                initializeCollapsedState('combined-task-details');
                initializeCollapsedState('p1-details');
                initializeCollapsedState('p2-details');
                initializeCollapsedState('cake-details');
            }, 100);
        });

        // 初始化折叠状态
        function initializeCollapsedState(detailsId) {
            const details = document.getElementById(detailsId);
            if (!details) return;
            
            // Find the list container
            // Priority: .scroll-content -> .divide-y -> details itself
            let listContainer = details.querySelector('.scroll-content');
            if (!listContainer) {
                listContainer = details.querySelector('.divide-y');
            }
            
            // Fallback for Production Plan style
            if (!listContainer) {
                listContainer = details;
            }
            
            // Count items logic
            let itemCount = 0;
            // Count actual product items based on common class
            const productItems = listContainer.querySelectorAll('.flex.justify-between.items-center.text-sm');
            if (productItems.length > 0) {
                itemCount = productItems.length;
            } else {
                // Fallback: Count children if specific class not found
                itemCount = listContainer.children.length;
            }

            // Find the toggle button
            const card = details.closest('.card');
            let btn = null;
            if (card) {
                btn = card.querySelector('button[onclick^="toggleStoreCard"]');
            }

            // Logic: Only show collapse/expand if items > 6
            if (itemCount > 6) {
                // Default: Collapsed (limited height)
                listContainer.classList.add('max-h-48', 'overflow-y-auto');
                
                if (btn) {
                    btn.classList.remove('hidden');
                    const text = btn.querySelector('span');
                    const icon = btn.querySelector('i');
                    if (text) text.textContent = '展开';
                    if (icon) icon.className = 'fas fa-chevron-down';
                }
            } else {
                // Default: Expanded (full height), hide button
                listContainer.classList.remove('max-h-48', 'overflow-y-auto');
                
                if (btn) {
                    btn.classList.add('hidden');
                }
            }
        }

        // 切换生产确认中的门店卡片
        function toggleStoreCard(detailsId, btn) {
            const details = document.getElementById(detailsId);
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            if (details) {
                // Find the list container
                // Priority: .scroll-content -> .divide-y -> details itself
                let listContainer = details.querySelector('.scroll-content');
                if (!listContainer) {
                    listContainer = details.querySelector('.divide-y');
                }
                
                // Fallback for Production Plan style
                if (!listContainer) {
                    listContainer = details;
                }

                // Check current state based on button text
                // If text is "展开" (Expand), it means it is currently collapsed
                const isCurrentlyCollapsed = text.textContent.trim() === '展开';
                
                if (isCurrentlyCollapsed) {
                    // Action: Expand (Show All - Remove height limit)
                    listContainer.classList.remove('max-h-48', 'overflow-y-auto');
                    text.textContent = '收起';
                    icon.className = 'fas fa-chevron-up';
                } else {
                    // Action: Collapse (Show limited height)
                    listContainer.classList.add('max-h-48', 'overflow-y-auto');
                    listContainer.scrollTop = 0; // Scroll to top
                    text.textContent = '展开';
                    icon.className = 'fas fa-chevron-down';
                }
            }
        }

        // 切换产品详情
        function toggleProductDetails(productId, btn) {
            const summary = document.getElementById('source-summary-' + productId);
            const details = document.getElementById('source-details-' + productId);
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            if (details && summary) {
                if (details.classList.contains('hidden')) {
                    details.classList.remove('hidden');
                    summary.classList.add('hidden');
                    icon.classList.add('rotate-180');
                    text.textContent = '收起详情';
                    btn.classList.add('bg-orange-50', 'text-orange-600');
                    btn.classList.remove('bg-gray-50', 'text-gray-500');
                } else {
                    details.classList.add('hidden');
                    summary.classList.remove('hidden');
                    icon.classList.remove('rotate-180');
                    text.textContent = '展开详情';
                    btn.classList.remove('bg-orange-50', 'text-orange-600');
                    btn.classList.add('bg-gray-50', 'text-gray-500');
                }
            }
        }

        // Category Expand/Collapse Functions
        function toggleCategoryExpand(categoryId, btn) {
            const categoryGroup = document.querySelector(`[data-category="${categoryId}"]`);
            const content = categoryGroup.querySelector('.category-content');
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            const isExpanded = btn.getAttribute('data-expanded') === 'true';
            
            if (isExpanded) {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
                text.textContent = '展开';
                btn.setAttribute('data-expanded', 'false');
            } else {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
                text.textContent = '收起';
                btn.setAttribute('data-expanded', 'true');
            }
        }

        function toggleAllCategories() {
            const allExpanded = Array.from(document.querySelectorAll('.category-toggle-btn')).every(
                btn => btn.getAttribute('data-expanded') === 'true'
            );
            
            const expandAllIcon = document.getElementById('expandAllIcon');
            const expandAllText = document.getElementById('expandAllText');
            
            document.querySelectorAll('.category-toggle-btn').forEach(btn => {
                const categoryId = btn.closest('.category-group').getAttribute('data-category');
                const isCurrentlyExpanded = btn.getAttribute('data-expanded') === 'true';
                
                if (allExpanded) {
                    // 全部收起
                    if (isCurrentlyExpanded) {
                        toggleCategoryExpand(categoryId, btn);
                    }
                } else {
                    // 全部展开
                    if (!isCurrentlyExpanded) {
                        toggleCategoryExpand(categoryId, btn);
                    }
                }
            });
            
            // 更新全局按钮状态
            if (allExpanded) {
                expandAllIcon.classList.remove('rotate-180');
                expandAllText.textContent = '展开全部';
            } else {
                expandAllIcon.classList.add('rotate-180');
                expandAllText.textContent = '收起全部';
            }
        }

        // Order Confirmation with Auto Split
        function confirmOrderWithAutoSplit(storeId) {
            if (!confirm('确认接单？系统将自动分类处理商品。')) {
                return;
            }
            
            // 模拟订单数据
            const orderData = {
                storeId: storeId,
                items: [
                    { name: '法式牛角包', quantity: 30, type: 'production' },
                    { name: '全麦吐司', quantity: 20, type: 'production' },
                    { name: '肉松小贝', quantity: 50, type: 'production' },
                    { name: '包装盒 (4寸)', quantity: 50, type: 'packaging' },
                    { name: '蛋糕模具 (4寸)', quantity: 2, type: 'tool' }
                ]
            };
            
            // 分离商品类型
            const productionItems = orderData.items.filter(item => item.type === 'production');
            const packagingItems = orderData.items.filter(item => item.type === 'packaging');
            const toolItems = orderData.items.filter(item => item.type === 'tool');
            
            // 显示处理结果提示
            showAutoSplitModal(productionItems.length, packagingItems.length, toolItems.length, () => {
                // 跳转到订单详情页
                window.location.href = 'shengchan-dingdan-xiangqing.html';
            });
        }

        function showAutoSplitModal(productionCount, packagingCount, toolCount, callback) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm';
            modal.innerHTML = `
                <div class="bg-white w-full max-w-sm rounded-2xl p-6 animate-slide-up">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">自动分类处理</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start gap-2">
                            <i class="fas fa-info-circle text-blue-600 mt-0.5"></i>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-blue-800 mb-2">接单成功，已自动分类处理</div>
                                <div class="text-xs text-blue-700 space-y-1">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-check-circle"></i>
                                        <span>${productionCount} 项需生产商品 → 已加入生产计划</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-check-circle"></i>
                                        <span>${packagingCount} 项包装材料 → 已加入领料单</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-check-circle"></i>
                                        <span>${toolCount} 项工具设备 → 已加入领料单</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="this.closest('.fixed').remove(); switchTab('planning');" 
                                class="flex-1 py-2.5 bg-white border border-gray-200 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-50">
                            查看生产计划
                        </button>
                        <button onclick="this.closest('.fixed').remove(); switchTab('picking');" 
                                class="flex-1 py-2.5 bg-orange-500 text-white rounded-lg text-xs font-bold shadow-md shadow-orange-200">
                            查看领料单
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // 添加动画样式
            if (!document.getElementById('slideUpAnimation')) {
                const style = document.createElement('style');
                style.id = 'slideUpAnimation';
                style.textContent = `
                    @keyframes slide-up {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .animate-slide-up {
                        animation: slide-up 0.3s ease-out;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        // Production Confirmation Logic (Added for Store-based View)
        function updateQty(id, delta) {
            const input = document.getElementById('qty-' + id);
            if (!input) return;
            let val = parseInt(input.value) || 0;
            val = Math.max(0, val + delta);
            input.value = val;
            input.dispatchEvent(new Event('change'));
        }

        function checkDiff(id, planQty) {
            const input = document.getElementById('qty-' + id);
            const val = parseInt(input.value) || 0;
            const diffDiv = document.getElementById('diff-' + id);
            
            if (!input || !diffDiv) return;

            if (val !== planQty) {
                diffDiv.classList.remove('hidden');
                // Inject Quick Buttons if not present
                if (!diffDiv.querySelector('.quick-reasons')) {
                    const innerDiv = diffDiv.querySelector('.bg-orange-50');
                    if (innerDiv) {
                        const buttonsHtml = `
                            <div class="flex gap-1 mb-1 quick-reasons">
                                <button class="px-1.5 py-0.5 bg-white border border-orange-200 rounded text-[10px] text-orange-600" onclick="setReason('${id}', '烤糊了')">烤糊</button>
                                <button class="px-1.5 py-0.5 bg-white border border-orange-200 rounded text-[10px] text-orange-600" onclick="setReason('${id}', '掉地上了')">掉地</button>
                                <button class="px-1.5 py-0.5 bg-white border border-orange-200 rounded text-[10px] text-orange-600" onclick="setReason('${id}', '原料不足')">缺料</button>
                            </div>
                        `;
                        const inputEl = document.getElementById('reason-' + id);
                        if (inputEl) {
                            inputEl.insertAdjacentHTML('beforebegin', buttonsHtml);
                        }
                    }
                }
            } else {
                diffDiv.classList.add('hidden');
            }
        }

        function setReason(id, text) {
            const input = document.getElementById('reason-' + id);
            if (input) input.value = text;
        }

        // Plan Adjustment Logic
        let currentAdjustId = null;
        let originalQty = 0;

        function openAdjustModal(id, name, qty) {
            currentAdjustId = id;
            originalQty = parseInt(document.getElementById('plan-qty-' + id).innerText); // Get current displayed qty
            
            document.getElementById('adjust-item-name').textContent = name;
            document.getElementById('adjust-qty-input').value = originalQty;
            document.getElementById('adjust-reason').value = '';
            document.getElementById('adjustModal').classList.remove('hidden');
            
            // Check for change immediately
            checkQtyChange();
        }

        function closeAdjustModal() {
            document.getElementById('adjustModal').classList.add('hidden');
        }

        function adjustModalValue(delta) {
            const input = document.getElementById('adjust-qty-input');
            let val = parseInt(input.value) || 0;
            val = Math.max(0, val + delta);
            input.value = val;
            checkQtyChange();
        }
        
        // Listen for input changes
        document.getElementById('adjust-qty-input').addEventListener('input', checkQtyChange);

        function checkQtyChange() {
            const input = document.getElementById('adjust-qty-input');
            const hint = document.getElementById('qty-change-hint');
            const val = parseInt(input.value) || 0;
            
            if (val !== originalQty) {
                hint.classList.remove('hidden');
            } else {
                hint.classList.add('hidden');
            }
        }

        function setAdjustReason(text) {
            document.getElementById('adjust-reason').value = text;
        }

        function saveAdjustPlan() {
            const newQty = parseInt(document.getElementById('adjust-qty-input').value) || 0;
            const reason = document.getElementById('adjust-reason').value;

            if (!reason) {
                alert('请填写调整原因');
                return;
            }

            // 1. Update Production Plan Display
            if (currentAdjustId) {
                const qtyDisplay = document.getElementById('plan-qty-' + currentAdjustId);
                if (qtyDisplay) {
                    qtyDisplay.textContent = newQty;
                    qtyDisplay.classList.add('text-orange-600'); // Highlight change
                }
            }

            // 2. Sync Picking List (Simulation)
            // Calculate ratio
            const ratio = newQty / originalQty;
            
            if (currentAdjustId === 'p1') { // French Croissant Dough
                // Update Butter (qty-butter)
                updatePickingItem('butter', ratio);
                // Update Flour (qty-flour)
                updatePickingItem('flour', ratio);
                // Update Sugar (qty-sugar)
                updatePickingItem('sugar', ratio);
            }

            // 3. Close Modal & Show Success
            closeAdjustModal();
            showToast(`✅ 计划已调整: ${originalQty} → ${newQty}`);
        }

        function updatePickingItem(itemId, ratio) {
            const input = document.getElementById('qty-' + itemId);
            if (input) {
                let currentVal = parseFloat(input.value);
                let newVal = currentVal * ratio;
                
                // Format logic
                if (itemId === 'box' || itemId === 'tool') {
                    newVal = Math.round(newVal);
                } else {
                    newVal = parseFloat(newVal.toFixed(1));
                }
                
                input.value = newVal;
                
                // Visual feedback in picking list
                const card = input.closest('.card');
                if (card) {
                    // Add a "Changed" badge if not exists
                    if (!card.querySelector('.sync-badge')) {
                        const badge = document.createElement('div');
                        badge.className = 'sync-badge absolute top-2 right-2 px-2 py-0.5 bg-orange-100 text-orange-600 text-[10px] font-bold rounded-full animate-pulse';
                        badge.innerHTML = '<i class="fas fa-sync"></i> 已同步';
                        card.style.position = 'relative';
                        card.appendChild(badge);
                    }
                }
            }
        }

        // Picking List Functions - REMOVED

        function adjustPickingQty(id, delta) {
            const input = document.getElementById('qty-' + id);
            let val = parseFloat(input.value) || 0;
            
            // Logic for integer vs float
            if (id === 'box' || id === 'tool') {
                val = parseInt(val) + delta;
            } else {
                val = parseFloat((val + delta).toFixed(1));
            }

            if (val < 0) val = 0;
            input.value = val;
        }

        function showPickingConfirmModal() {
            document.getElementById('pickingConfirmModal').classList.remove('hidden');
        }

        function closePickingConfirmModal() {
            document.getElementById('pickingConfirmModal').classList.add('hidden');
        }

        function completePicking() {
            closePickingConfirmModal();
            showToast('✅ 出库成功，库存已更新');
            // Optional: Switch to another tab or refresh
        }

        // Single Item Confirmation Logic
        function confirmSingleItem(btn, itemId) {
            // Check if already confirmed
            if (btn.dataset.confirmed === 'true') return;

            // Mark as confirmed
            btn.dataset.confirmed = 'true';

            // Visual feedback for Confirm Button
            btn.innerHTML = '<i class="fas fa-check"></i>';
            btn.classList.remove('bg-green-50', 'text-green-600', 'border-green-100', 'hover:bg-green-100');
            btn.classList.add('bg-green-500', 'text-white', 'border-green-500', 'cursor-default');

            // Disable quantity inputs for this item
            const qtyInput = document.getElementById('qty-' + itemId);
            if (qtyInput) {
                qtyInput.disabled = true;
                qtyInput.classList.add('text-gray-400');
            }
            
            // Disable +/- buttons
            const parent = btn.parentElement;
            const buttons = parent.querySelectorAll('button:not([onclick^="confirmSingleItem"])');
            buttons.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-50', 'cursor-not-allowed');
            });

            // Create Revoke Button BEFORE stepper
            const revokeBtn = document.createElement('button');
            revokeBtn.className = 'mr-1 px-2 py-1 bg-yellow-500 text-white text-[10px] font-bold rounded border border-yellow-500 hover:bg-yellow-600 transition-colors animate-pulse';
            let timeLeft = 60;
            revokeBtn.innerHTML = `<i class="fas fa-undo"></i> 撤销 (${timeLeft})`;
            
            // Insert before the first child
            parent.insertBefore(revokeBtn, parent.firstChild);

            // Timer
            const intervalId = setInterval(() => {
                timeLeft--;
                if (timeLeft > 0) {
                    revokeBtn.innerHTML = `<i class="fas fa-undo"></i> 撤销 (${timeLeft})`;
                } else {
                    clearInterval(intervalId);
                    revokeBtn.remove(); // Remove button after timeout
                }
            }, 1000);

            // Undo Action
            revokeBtn.onclick = () => {
                clearInterval(intervalId);
                
                // Revert Confirm Button
                btn.dataset.confirmed = 'false';
                btn.innerHTML = '确认';
                btn.className = 'ml-1 px-2 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded border border-green-100 hover:bg-green-100 transition-colors';
                
                // Revert Inputs
                if (qtyInput) {
                    qtyInput.disabled = false;
                    qtyInput.classList.remove('text-gray-400');
                }
                buttons.forEach(b => {
                    b.disabled = false;
                    b.classList.remove('opacity-50', 'cursor-not-allowed');
                });

                // Remove Self
                revokeBtn.remove();
            };

            // Show toast
            showToast('单项确认成功');
        }
        // Picking Status Check
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const p1Status = localStorage.getItem('production_status_p1');

            // Logic for 'In Progress' (Started but not Finished)
            if (p1Status === 'in_progress' && !urlParams.get('status')) {
                 const statusPill = document.querySelector('#p1-details').closest('.card').querySelector('.status-pill');
                if (statusPill) {
                    statusPill.className = 'status-pill bg-blue-100 text-blue-700 mb-1';
                    statusPill.textContent = '生产中';
                }

                const btnStart = document.getElementById('btn-start-p1');
                if (btnStart) {
                    btnStart.className = 'flex-1 py-2.5 bg-blue-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-blue-200 active:scale-95 transition-transform';
                    btnStart.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> 生产中...';
                }
            }

            if (urlParams.get('picking_complete') === 'true') {
                const statusEl = document.getElementById('picking-status-p1');
                const btnStart = document.getElementById('btn-start-p1');
                
                if (statusEl) {
                    statusEl.textContent = '已领料 (5/5) - 准备就绪';
                    statusEl.classList.remove('text-blue-600');
                    statusEl.classList.add('text-green-600', 'font-bold');
                }
                
                if (btnStart) {
                    btnStart.disabled = false;
                    btnStart.classList.remove('bg-gray-300', 'shadow-none', 'cursor-not-allowed');
                    btnStart.classList.add('bg-gray-900', 'shadow-lg', 'shadow-gray-200');
                    btnStart.innerHTML = '<i class="fas fa-play mr-1"></i> 开始生产';
                }
            }

            // Check if mixing is complete (returned from execution)
            if (urlParams.get('status') === 'mixed' && urlParams.get('id') === 'p1') {
                const statusPill = document.querySelector('#p1-details').closest('.card').querySelector('.status-pill');
                if (statusPill) {
                    statusPill.className = 'status-pill bg-yellow-100 text-yellow-700 mb-1';
                    statusPill.textContent = '待确认';
                }
                
                const actionArea = document.getElementById('action-area-p1');
                if (actionArea) {
                    actionArea.innerHTML = `
                        <button class="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold active:scale-95 transition-transform" onclick="window.location.href='shengchan-chakan.html'">
                                    <i class="fas fa-eye mr-1"></i> 查看配方
                                </button>
                        <button class="flex-1 py-2.5 bg-yellow-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-yellow-200 active:scale-95 transition-transform" onclick="switchTab('producing')">
                            <i class="fas fa-arrow-right mr-1"></i> 去确认
                        </button>
                    `;
                }

                // Also ensure it appears in the confirmation tab (simulated)
                // In a real app, data would be synced. Here we might want to highlight it or just assume user knows.
                const pendingConfirmCard = document.getElementById('pending-confirmation-p1');
                if (pendingConfirmCard) {
                    pendingConfirmCard.classList.remove('hidden');
                }
            }
        });

        // Submit Production Logic
        let currentSubmitBtn = null;

        function submitProduction(btn) {
            if (!btn) return; // Safety check

            // Check if already in undo mode
            if (btn.dataset.undo === 'true') {
                clearInterval(parseInt(btn.dataset.intervalId));
                
                // Revert
                btn.innerHTML = '<i class="fas fa-check-double mr-1"></i> 确认提交生产单';
                btn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                btn.classList.add('bg-orange-500');
                btn.dataset.undo = 'false';
                return;
            }

            // Show confirmation modal
            currentSubmitBtn = btn;
            const modal = document.getElementById('submitConfirmModal');
            if (modal) {
                modal.classList.remove('hidden');
            } else {
                // Fallback if modal doesn't exist (though it should)
                if (confirm('确认提交生产单？')) {
                    startSubmitCountdown(btn);
                }
            }
        }

        function closeSubmitModal() {
            const modal = document.getElementById('submitConfirmModal');
            if (modal) modal.classList.add('hidden');
            currentSubmitBtn = null;
        }

        function confirmSubmitModal() {
            const btn = currentSubmitBtn;
            closeSubmitModal();
            if (btn) {
                startSubmitCountdown(btn);
            }
        }

        function startSubmitCountdown(btn) {
            // Start Undo Mode - No confirm dialog, direct undo action
            btn.dataset.undo = 'true';
            let timeLeft = 120;
            
            // Change style
            btn.classList.remove('bg-orange-500');
            btn.classList.add('bg-yellow-500', 'hover:bg-yellow-600'); // Warning color
            
            const updateBtn = () => {
                btn.innerHTML = `<i class="fas fa-undo mr-1"></i> 撤销提交 (${timeLeft}s)`;
            };
            updateBtn();

            const intervalId = setInterval(() => {
                timeLeft--;
                if (timeLeft > 0) {
                    updateBtn();
                } else {
                    clearInterval(intervalId);
                    finalizeProductionSubmit(btn);
                }
            }, 1000);
            
            btn.dataset.intervalId = intervalId;
        }

        function finalizeProductionSubmit(btn) {
            // Visual feedback
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> 处理中...';
            btn.disabled = true;
            btn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
            btn.classList.add('bg-orange-500');
            
            setTimeout(() => {
                // --- 1. Ledger Generation Logic Start ---
                const now = new Date();
                const batchNo = 'BATCH' + now.getFullYear() + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0') + Math.floor(Math.random() * 1000);
                
                // Fetch Presets
                const env = JSON.parse(localStorage.getItem('preset_env') || '{"temperature": "22", "humidity": "65"}');
                const equip = JSON.parse(localStorage.getItem('preset_equipment') || '[{"name": "和面机 A-01"}, {"name": "层炉 B-02"}]');
                const usageRecords = JSON.parse(localStorage.getItem('usage_records') || '[]');
                
                // Aggregate Materials Used
                const usedMaterials = usageRecords.slice(0, 5).map(r => `${r.materialName}(${r.batchNo})`).join(', ');

                // Generate Production Ledger Record
                const ledgerEntry = {
                    productionOrderId: 'PO' + now.getFullYear() + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0') + Math.floor(Math.random() * 1000),
                    batchNumber: batchNo,
                    productionDate: now.toISOString().split('T')[0],
                    productName: '法式牛角包等 (混合批次)',
                    plannedQuantity: 100,
                    actualQuantity: 100, // Mock: same as planned
                    differenceReason: '无',
                    operator: {
                        name: '张师傅',
                        id: 'EMP001'
                    },
                    equipment: equip,
                    environment: env,
                    materials: usageRecords.slice(0, 5).map(r => ({
                        name: r.materialName,
                        batchNumber: r.batchNo,
                        quantity: r.quantity + r.unit
                    })),
                    qualityInspection: {
                        finishedInspection: {
                            status: '合格',
                            actualQuantity: 100,
                            unqualifiedQuantity: 0,
                            unqualifiedReason: '无'
                        }
                    },
                    cost: {
                        materialCost: '¥1250.00',
                        laborCost: '¥500.00',
                        totalCost: '¥1750.00'
                    },
                    createdAt: now.toISOString(),
                    // Compatible fields
                    id: 'PL' + Date.now(),
                    batchNo: batchNo,
                    quantity: 100, 
                    varianceReason: '无', 
                    personnel: '张师傅', 
                    environment: `温度:${env.temperature}°C, 湿度:${env.humidity}%`,
                    materialTrace: usedMaterials || '未关联原料',
                    qcStatus: '合格'
                };

                // Save to Ledger (New Key)
                const prodLedgers = JSON.parse(localStorage.getItem('productionLedgers') || '[]');
                prodLedgers.unshift(ledgerEntry);
                localStorage.setItem('productionLedgers', JSON.stringify(prodLedgers));
                
                // Save to Ledger (Old Key for compatibility)
                const prodLedger = JSON.parse(localStorage.getItem('production_ledger') || '[]');
                prodLedger.unshift(ledgerEntry);
                localStorage.setItem('production_ledger', JSON.stringify(prodLedger));

                // Generate Finished Product Inspection Record
                const inspectionRecord = {
                    inspectionId: "INSP" + now.getFullYear() + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0') + Math.floor(Math.random() * 1000),
                    inspectionType: "成品检验",
                    productionBatchNumber: batchNo,
                    productName: ledgerEntry.productName,
                    inspectionDate: now.toISOString().split('T')[0],
                    inspectionResult: ledgerEntry.qualityInspection.finishedInspection.status,
                    actualQuantity: ledgerEntry.actualQuantity,
                    unqualifiedQuantity: 0,
                    unqualifiedReason: '无',
                    inspector: ledgerEntry.operator.name,
                    createdAt: now.toISOString()
                };
                const inspectionRecords = JSON.parse(localStorage.getItem('finishedInspectionRecords') || '[]');
                inspectionRecords.unshift(inspectionRecord);
                localStorage.setItem('finishedInspectionRecords', JSON.stringify(inspectionRecords));
                // --- Ledger Generation Logic End ---

                showToast('生产单已提交');
                setTimeout(() => {
                    showToast('已生成配送单', 'info');
                }, 800);
                setTimeout(() => {
                    showToast('已生成上架单', 'info');
                    // Alert for Ledger Generation
                    alert('生产台账已自动生成！\n\n批次号: ' + batchNo + '\n已关联原料追溯记录');

                    // Reset or redirect
                    const card = btn.closest('.card');
                    if (card) {
                        card.classList.remove('border-l-yellow-400', 'border-l-blue-500');
                        card.classList.add('border-l-green-500');
                        const statusPill = card.querySelector('.status-pill');
                        if (statusPill) {
                            statusPill.className = 'status-pill status-done mb-1';
                            statusPill.textContent = '已完成';
                        }
                        // Remove buttons and show completed text
                        const btnContainer = btn.parentElement;
                        if (btnContainer) {
                            btnContainer.innerHTML = '<div class="w-full py-2 bg-green-50 text-green-600 rounded-lg text-xs font-bold text-center border border-green-100"><i class="fas fa-check-circle mr-1"></i> 生产已确认完成</div>';
                        }
                    }
                }, 1600);
            }, 1000);
        }

        // --- Sub-item Adjustment Logic ---
        let currentSubAdjustParentId = null;
        let currentSubAdjustItemId = null;
        let originalSubQty = 0;

        function openSubItemAdjustModal(parentId, itemId, itemName, qty) {
            currentSubAdjustParentId = parentId;
            currentSubAdjustItemId = itemId;
            
            // Try to get current displayed quantity if possible, otherwise use passed qty
            const displayEl = document.getElementById(`sub-qty-${parentId}-${itemId}`);
            if (displayEl) {
                // Extract number from "x 50 个"
                const match = displayEl.textContent.match(/x\s*(\d+)/);
                if (match) {
                    originalSubQty = parseInt(match[1]);
                } else {
                    originalSubQty = qty;
                }
            } else {
                originalSubQty = qty;
            }

            document.getElementById('sub-adjust-item-name').textContent = itemName;
            document.getElementById('sub-adjust-qty-input').value = originalSubQty;
            document.getElementById('sub-adjust-reason').value = '';
            
            document.getElementById('subItemAdjustModal').classList.remove('hidden');
        }

        function closeSubItemAdjustModal() {
            document.getElementById('subItemAdjustModal').classList.add('hidden');
        }

        function adjustSubModalValue(delta) {
            const input = document.getElementById('sub-adjust-qty-input');
            let val = parseInt(input.value) || 0;
            val = Math.max(0, val + delta);
            input.value = val;
        }

        function setSubAdjustReason(reason) {
            const textarea = document.getElementById('sub-adjust-reason');
            if (textarea) {
                textarea.value = reason;
                // Auto-fill quantity to 0 if reason is "原料不足" (Insufficient materials)
                if (reason === '原料不足') {
                    const input = document.getElementById('sub-adjust-qty-input');
                    if (input) input.value = 0;
                }
            }
        }

        function saveSubAdjustPlan() {
            const newQty = parseInt(document.getElementById('sub-adjust-qty-input').value) || 0;
            const reason = document.getElementById('sub-adjust-reason').value;

            if (!reason && newQty !== originalSubQty) {
                alert('调整数量必须填写原因');
                return;
            }

            // Update UI
            if (currentSubAdjustParentId && currentSubAdjustItemId) {
                const displayId = `sub-qty-${currentSubAdjustParentId}-${currentSubAdjustItemId}`;
                const displayEl = document.getElementById(displayId);
                
                if (displayEl) {
                    displayEl.textContent = `x ${newQty} 个`;
                    
                    // Visual feedback for change
                    displayEl.classList.add('text-orange-600', 'font-bold');
                    
                    // If quantity is 0 and reason is "原料不足", style it
                    const row = displayEl.closest('.flex.justify-between');
                    if (newQty === 0 && reason.includes('原料不足')) {
                        if (row) {
                            row.classList.add('bg-red-50');
                            const nameSpan = row.querySelector('span.text-gray-700');
                            if (nameSpan) {
                                nameSpan.classList.add('text-red-500', 'line-through');
                                nameSpan.classList.remove('text-gray-700');
                            }
                            // Add reason badge
                            if (!row.querySelector('.reason-badge')) {
                                const badge = document.createElement('span');
                                badge.className = 'reason-badge text-[10px] bg-red-100 text-red-600 px-1 py-0.5 rounded ml-2';
                                badge.textContent = '缺料取消';
                                row.querySelector('.flex.items-center.gap-2').prepend(badge);
                            }
                        }
                    } else {
                        // Reset style if changed back (simplified)
                        const row = displayEl.closest('.flex.justify-between');
                        if (row) {
                            row.classList.remove('bg-red-50');
                            const nameSpan = row.querySelector('span.text-red-500');
                            if (nameSpan) {
                                nameSpan.classList.remove('text-red-500', 'line-through');
                                nameSpan.classList.add('text-gray-700');
                            }
                            const badge = row.querySelector('.reason-badge');
                            if (badge) badge.remove();
                        }
                    }
                }
            }

            // Simulate updating parent dough (just a toast message for now as we don't have the full formula logic here)
            // In a real app, this would recalculate the 80kg total.
            showToast(`✅ 已调整: ${originalSubQty} → ${newQty} (面团需求已自动更新)`);
            
            closeSubItemAdjustModal();
        }

     </script>
 </body>
 </html>