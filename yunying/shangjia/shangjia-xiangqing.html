<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上架详情 - 烘匠 BakeManager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-orange: #ff9f43;
            --primary-dark: #ff8c00;
            --text-main: #333333;
            --text-sub: #8b8b8b;
            --bg-light: #f7f7f5;
            --bg-white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }

        .card {
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.03);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-[#f7f7f5] h-screen flex flex-col">

    <!-- Header -->
    <div class="bg-white px-4 py-3 shadow-sm border-b border-gray-100 z-30 flex-shrink-0">
        <div class="flex items-center space-x-3">
            <a href="shangjia-zhuye.html" class="w-9 h-9 flex items-center justify-center rounded-full bg-gray-50 hover:bg-gray-100 transition-all text-gray-600">
                <i class="fas fa-chevron-left"></i>
            </a>
            <div>
                <h1 class="text-lg font-bold text-gray-800">生产单详情</h1>
                <div class="text-xs text-gray-500" id="orderIdDisplay">PROD-20231026-001</div>
            </div>
        </div>
    </div>

    <!-- Info Card -->
    <div class="p-4 pb-0">
        <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <span class="text-xs text-gray-500 block mb-1">生产来源</span>
                    <span class="font-bold text-gray-800"><i class="fas fa-industry text-orange-500 mr-1"></i> 烘焙车间 A组</span>
                </div>
                <div class="text-right">
                    <span class="text-xs text-gray-500 block mb-1">完工时间</span>
                    <span class="font-bold text-gray-800">10:30</span>
                </div>
            </div>
            <div class="border-t border-gray-100 mt-2 pt-2 flex justify-between items-center">
                <span class="text-xs text-gray-500">状态</span>
                <span class="bg-orange-50 text-orange-600 text-xs px-2 py-1 rounded font-bold">待处理</span>
            </div>
        </div>
    </div>

    <!-- Content List -->
    <div class="flex-1 overflow-y-auto p-4 custom-scrollbar space-y-4 pb-24">
        
        <!-- Item 1 -->
        <div class="card p-4 animate-slide-up" id="item-1">
            <div class="flex items-start gap-4 mb-3">
                <div class="w-16 h-16 rounded-lg bg-gray-100 flex-shrink-0 overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=200&h=200&fit=crop" class="w-full h-full object-cover">
                </div>
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800 text-base mb-1">法式牛角包</h4>
                    <div class="text-xs text-gray-400">规格: 65g/个</div>
                </div>
            </div>

            <!-- Data Grid -->
            <div class="grid grid-cols-4 gap-2 mb-4 bg-gray-50 rounded-xl p-2">
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">原计划</div>
                    <div class="font-bold text-gray-800 plan-qty">50</div>
                </div>
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">实产</div>
                    <input type="number" class="w-full bg-transparent text-center font-bold text-blue-600 text-lg actual-qty focus:outline-none focus:border-b focus:border-blue-300" value="50" onchange="updateDifference(1)">
                </div>
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">差异</div>
                    <div class="font-bold text-gray-400 diff-qty" id="diff-1">-</div>
                </div>
                <div class="text-center">
                    <div class="text-[10px] text-gray-400 mb-1">不合格</div>
                    <input type="number" class="w-full bg-white border border-gray-200 rounded text-center text-red-500 font-bold text-sm h-6 focus:outline-none focus:border-red-300" value="0" min="0">
                </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2">
                <button class="flex-1 py-2 bg-orange-500 text-white rounded-lg font-bold text-sm shadow-md shadow-orange-200 active:scale-95 transition-all" onclick="processItem(1, 'store')">
                    <i class="fas fa-store mr-1"></i> 上架销售
                </button>
                <button class="flex-1 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg font-bold text-sm hover:bg-gray-50 active:scale-95 transition-all" onclick="processItem(1, 'warehouse')">
                    <i class="fas fa-warehouse mr-1"></i> 入库存储
                </button>
            </div>
        </div>

        <!-- Item 2 (With Variance) -->
        <div class="card p-4 animate-slide-up" style="animation-delay: 0.1s;" id="item-2">
            <div class="flex items-start gap-4 mb-3">
                <div class="w-16 h-16 rounded-lg bg-gray-100 flex-shrink-0 overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1509440159596-0249088772ff?w=200&h=200&fit=crop" class="w-full h-full object-cover">
                </div>
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800 text-base mb-1">全麦吐司</h4>
                    <div class="text-xs text-gray-400">规格: 450g/袋</div>
                </div>
            </div>

            <div class="grid grid-cols-4 gap-2 mb-4 bg-gray-50 rounded-xl p-2">
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">原计划</div>
                    <div class="font-bold text-gray-800 plan-qty">30</div>
                </div>
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">实产</div>
                    <input type="number" class="w-full bg-transparent text-center font-bold text-orange-600 text-lg actual-qty focus:outline-none focus:border-b focus:border-orange-300" value="28" onchange="updateDifference(2)">
                </div>
                <div class="text-center border-r border-gray-200">
                    <div class="text-[10px] text-gray-400 mb-1">差异</div>
                    <div class="font-bold text-red-500 diff-qty" id="diff-2">-2</div>
                </div>
                <div class="text-center">
                    <div class="text-[10px] text-gray-400 mb-1">不合格</div>
                    <input type="number" class="w-full bg-white border border-gray-200 rounded text-center text-red-500 font-bold text-sm h-6 focus:outline-none focus:border-red-300" value="0" min="0">
                </div>
            </div>

            <div class="flex gap-2">
                <button class="flex-1 py-2 bg-orange-500 text-white rounded-lg font-bold text-sm shadow-md shadow-orange-200 active:scale-95 transition-all" onclick="processItem(2, 'store')">
                    <i class="fas fa-store mr-1"></i> 上架销售
                </button>
                <button class="flex-1 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg font-bold text-sm hover:bg-gray-50 active:scale-95 transition-all" onclick="processItem(2, 'warehouse')">
                    <i class="fas fa-warehouse mr-1"></i> 入库存储
                </button>
            </div>
        </div>

    </div>

    <!-- Batch Action Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 z-40">
        <button class="w-full py-3 bg-gray-900 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-all" onclick="batchProcess()">
            一键全部上架
        </button>
    </div>

    <script>
        // Parse URL params
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('id') || 'PROD-20231026-001';
        document.getElementById('orderIdDisplay').textContent = orderId;

        // Initialize calculations
        document.addEventListener('DOMContentLoaded', () => {
            updateDifference(1);
            updateDifference(2);
        });

        function updateDifference(id) {
            const card = document.getElementById('item-' + id);
            const plan = parseInt(card.querySelector('.plan-qty').textContent) || 0;
            const actualInput = card.querySelector('.actual-qty');
            const actual = parseInt(actualInput.value) || 0;
            const diffEl = document.getElementById('diff-' + id);
            
            const diff = actual - plan;
            
            if (diff === 0) {
                diffEl.textContent = '-';
                diffEl.className = 'font-bold text-gray-400 diff-qty';
            } else if (diff > 0) {
                diffEl.textContent = '+' + diff;
                diffEl.className = 'font-bold text-green-500 diff-qty';
            } else {
                diffEl.textContent = diff;
                diffEl.className = 'font-bold text-red-500 diff-qty';
            }
        }

        function processItem(id, type) {
            const card = document.getElementById('item-' + id);
            const productName = card.querySelector('h4').textContent;
            const actualQty = card.querySelector('.actual-qty').value;
            const unqualified = card.querySelector('input[type="number"]:last-child').value; // Last input is unqualified
            
            let actionText = type === 'store' ? '上架销售' : '入库存储';
            let confirmMsg = `确认将 ${actualQty} 个 ${productName} ${actionText}？`;
            
            if (unqualified > 0) {
                confirmMsg += `\n(包含 ${unqualified} 个不合格品记录)`;
            }

            if(confirm(confirmMsg)) {
                // Animation
                card.style.transition = 'all 0.5s ease';
                card.style.transform = 'translateY(-20px)';
                card.style.opacity = '0';
                
                setTimeout(() => {
                    card.style.display = 'none';
                    checkEmpty();
                }, 500);
                
                // Route logic
                if (type === 'warehouse') {
                    // In a real app, this would make an API call. 
                    // For prototype, we can assume it goes to the warehouse module.
                    console.log(`Sent ${productName} to Warehouse`);
                } else {
                    console.log(`Sent ${productName} to Store Shelf`);
                }
            }
        }

        function batchProcess() {
            if(confirm('确认将剩余所有商品直接上架销售？')) {
                alert('处理完成！所有商品已上架。');
                window.location.href = 'shangjia-zhuye.html';
            }
        }

        function checkEmpty() {
            const visibleCards = document.querySelectorAll('.card:not([style*="display: none"])');
            if (visibleCards.length === 0) {
                alert('本单处理完成！');
                window.location.href = 'shangjia-zhuye.html';
            }
        }
    </script>
</body>
</html>