<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP - 烘焙助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 基础主题样式 */
        html, body { 
            background: #F8FAFC; 
            transition: all 0.3s ease;
            overflow: hidden; /* 防止整体页面滚动 */
            height: 100%;
            width: 100%;
            position: fixed; /* 固定页面，防止iOS弹性滚动 */
        }
        .dark html, .dark body { 
            background: #0F172A; 
        }
        
        /* 卡片样式 */
        .card { 
            border-radius: 20px; 
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08); 
            background: #FFFFFF; 
            border: 1px solid #E2E8F0; 
            transition: all 0.3s ease;
        }
        .dark .card { 
            background: #1E293B; 
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25); 
            border: 1px solid #334155; 
        }

        /* 主题切换按钮 */
        .theme-switch {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.625rem;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dark .theme-switch {
            background: #334155;
            border-color: #475569;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .theme-switch:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .dark .theme-switch:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* 文本颜色 */
        .text-primary {
            color: #1E293B;
            transition: color 0.3s ease;
        }
        .dark .text-primary {
            color: #F1F5F9;
        }
        
        /* 输入框样式 */
        input, textarea {
            transition: all 0.3s ease;
        }
        .dark input, .dark textarea {
            background: #1E293B;
            color: #F1F5F9;
            border-color: #475569;
        }
        
        /* 按钮样式 */
        .btn-primary {
            transition: all 0.3s ease;
        }
        .dark .btn-primary {
            background: #3B82F6;
            color: #F1F5F9;
        }
        .input-shadow:focus { 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
            border-color: #3B82F6; 
        }
        .tab-active { color: #3B82F6 !important; }
        .tab-inactive { color: #64748B !important; }
        .tab-bg-active { 
            background: #EFF6FF !important; 
            border: 1px solid #BFDBFE; 
        }
        .tab-bg-inactive { 
            background: #FFFFFF !important; 
            border: 1px solid #E2E8F0; 
        }
        .dark .tab-bg-active { 
            background: #1E3A8A !important; 
            border: 1px solid #3B82F6; 
        }
        .dark .tab-bg-inactive { 
            background: #1E293B !important; 
            border: 1px solid #334155; 
        }
        .transition-all { 
            transition: all 0.2s cubic-bezier(.4,0,.2,1); 
        }
        .main-container {
            max-width: 100%;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #F8FAFC;
            padding-top: 70px; /* 为顶部导航留出空间 */
        }
        .dark .main-container {
            background: #0F172A;
        }
        .content-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
            padding: 1rem;
            gap: 0.5rem;
        }
        
                    /* 左侧面板：包含类别和配方列表 */
            .left-panel {
                width: 100%; /* 占满整个内容区域宽度 */
                display: flex;
                gap: 0; /* 移除间距 */
                min-width: 180px; /* 确保最小宽度能显示配方列表内容 */
                justify-content: flex-start; /* 从左侧开始排列 */
                flex-wrap: nowrap; /* 防止换行 */
                height: 66.7%; /* 将高度调整为原来的三分之二 */
                transition: all 0.3s ease; /* 添加所有属性过渡动画 */
                padding-right: 0; /* 移除右内边距 */
            }
        
                    .category-sidebar {
                width: 6rem; /* 保持类别栏宽度不变 */
                background: white;
                border-radius: 1rem;
                padding: 1rem 0.5rem 1.5rem 0.5rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
                border: 1px solid #E2E8F0;
                flex-shrink: 0; /* 防止收缩 */
                height: 100%; /* 保持类别栏高度不变 */
                overflow-y: auto; /* 允许类别栏垂直滚动 */
                scrollbar-width: thin; /* 细滚动条 */
                -webkit-overflow-scrolling: touch; /* 平滑滚动 */
                margin-left: 0.5rem; /* 添加左边距 */
                flex: 0; /* 不参与flex布局的伸缩，保持固定宽度 */
            }
        .dark .category-sidebar {
            background: #1E293B;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
            border: 1px solid #334155;
        }
        
                    /* 配方列表面板 */
            .recipe-list-panel {
                flex: 1; /* 恢复宽度占比 */
                display: flex;
                flex-direction: column;
                overflow: hidden;
                background: white;
                border-radius: 1rem;
                padding: 0.5rem 0.25rem 0.5rem 0.5rem; /* 进一步减少内边距，确保内容显示 */
                box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
                border: 1px solid #E2E8F0;
                min-width: 0; /* 允许收缩 */
                margin-left: 0.5rem; /* 添加左边距，与类别栏保持一定距离 */
                margin-right: 0; /* 移除右边距 */
                height: 66.7%; /* 将高度调整为原来的三分之二 */
                max-height: 66.7%; /* 确保高度不超过三分之二 */
            }
        .dark .recipe-list-panel {
            background: #1E293B;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
            border: 1px solid #334155;
        }
        
                    /* iPad 分屏布局 */
                    @media (min-width: 768px) {
                .main-container {
                    flex-direction: column; /* 改为垂直布局 */
                    overflow: hidden; /* 确保容器不滚动 */
                    position: fixed; /* 固定主容器 */
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    padding-top: 70px; /* 为顶部导航留出空间 */
                }
                
                .content-wrapper {
                    width: 100%; /* 占满整个宽度 */
                    height: 100%;
                    flex-direction: row; /* 改为水平布局 */
                    border-right: none; /* 移除边框 */
                    min-width: 200px; /* 保持最小宽度 */
                    padding: 0.25rem; /* 保持内边距 */
                    overflow: hidden; /* 防止内容溢出 */
                    display: flex; /* 显示面板 */
                    position: relative; /* 添加相对定位，用于新建配方iframe的定位 */
                }
            
            /* 移除当右侧有内容时的特殊布局，使用固定比例 */
            
                    /* 左侧面板的布局调整 */
                        .left-panel {
                        flex-direction: row; /* 确保在水平方向排列 */
                        width: 40%; /* 默认占40%宽度，新建配方时会变窄 */
                        min-width: 180px; /* 确保最小宽度能显示配方列表内容 */
                        overflow: hidden; /* 防止内容溢出 */
                        height: 66.7%; /* 将高度调整为原来的三分之二 */
                        gap: 0; /* 移除间隙 */
                        justify-content: flex-start; /* 从左侧开始排列，消除间隙 */
                        align-self: flex-start; /* 从顶部开始排列 */
                        transition: width 0.3s ease; /* 添加宽度过渡动画 */
                    }
            
            .compact-mode .category-item.active {
                font-size: 0.75rem;
                padding: 0.5rem 0.25rem;
                box-shadow: 0 2px 6px rgba(37, 99, 235, 0.2);
            }
            
            /* 压缩模式下为类别添加首字母大写显示 */
            .compact-mode .category-item:not(.active)::first-letter {
                font-size: 1rem;
                font-weight: bold;
                color: #3B82F6;
            }
            
            .dark .compact-mode .category-item:not(.active)::first-letter {
                color: #60A5FA;
            }
            
            /* 压缩模式下类别管理按钮的样式 */
            .compact-mode .category-manage-btn {
                min-height: 40px;
                min-width: 40px;
                padding: 0.25rem;
            }
            
            .compact-mode .category-manage-btn span {
                display: none;
            }
            
            /* 压缩模式下配方列表面板的样式 */
            .compact-mode .recipe-list-panel {
                padding: 0.5rem;
                flex: 1;
                min-width: 0; /* 允许收缩 */
            }
            
            /* 压缩模式下配方卡片的样式 */
            .compact-mode .recipe-card {
                padding: 0.5rem;
            }
            
            .compact-mode .recipe-image {
                width: 2rem;
                height: 2rem;
                margin-right: 0.5rem;
            }
            
            .compact-mode .recipe-card .font-semibold {
                font-size: 0.75rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 80px;
            }
            
            .compact-mode .recipe-card .text-xs {
                display: none;
            }
            
            .compact-mode .category-badge {
                display: none;
            }
            
            /* 压缩模式下搜索输入框的样式 */
            .compact-mode .search-input {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
            
            /* 压缩模式下配方列表标题栏的样式 */
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 {
                margin-bottom: 0.5rem;
                flex-wrap: wrap;
            }
            
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 > div:first-child {
                width: 100%;
                margin-bottom: 0.25rem;
            }
            
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 > div:last-child {
                width: 100%;
                justify-content: space-between;
                display: flex;
            }
            
            .compact-mode .recipe-list-panel .w-8.h-8 {
                width: 1.5rem;
                height: 1.5rem;
            }
            
            .compact-mode .recipe-list-panel .font-semibold.text-lg {
                font-size: 0.875rem;
            }
            
            .compact-mode .recipe-list-panel .bg-blue-50 {
                display: none;
            }
            
            .compact-mode .add-recipe-btn-small {
                width: 1.5rem;
                height: 1.5rem;
            }
            
            .compact-mode .category-manage-btn span {
                display: none;
            }
            
            .compact-mode .left-panel {
                gap: 0.25rem; /* 减少间距 */
            }
            
            /* 压缩模式下配方列表面板的样式 */
            .compact-mode .recipe-list-panel {
                padding: 0.5rem;
                flex: 1;
                min-width: 0; /* 允许收缩 */
            }
            
            /* 压缩模式下配方列表标题栏的样式 */
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 {
                margin-bottom: 0.5rem;
                flex-wrap: wrap;
            }
            
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 > div:first-child {
                width: 100%;
                margin-bottom: 0.25rem;
            }
            
            .compact-mode .recipe-list-panel .flex.items-center.justify-between.mb-3 > div:last-child {
                width: 100%;
                justify-content: space-between;
                display: flex;
            }
            
            .dark .content-wrapper {
                border-right-color: #334155;
            }
            
            /* 左侧面板在iPad上的调整 */
            .left-panel {
                width: 100%; /* 占满content-wrapper */
                min-width: auto;
                overflow: hidden; /* 防止内容溢出 */
                height: 100%; /* 确保高度填满 */
                transition: width 0.3s ease; /* 添加过渡动画，使宽度变化平滑 */
            }
            
            /* iPad模式下类别栏底部间距调整 */
            .category-sidebar {
                padding-bottom: 1.5rem; /* 减少内部底部填充 */
                height: 100%; /* 填满高度 */
            }
             
             /* iPad横屏优化 */
             @media (min-width: 1024px) and (orientation: landscape) {
                 .new-recipe-container {
                     max-width: 600px;
                 }
                 
                 .recipe-list {
                     display: grid;
                     grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                     gap: 1rem;
                 }
             }
            
            .recipe-detail-panel {
                display: none; /* 隐藏右侧面板 */
            }
            
            /* 在iPad视图中调整新建按钮位置 */
            .add-recipe-btn {
                bottom: 1.5rem;
                right: 1.5rem; /* 调整到右下角 */
                left: auto;
                z-index: 50;
            }
        }
        
        .recipe-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.25rem;
            -webkit-overflow-scrolling: touch; /* 平滑滚动 */
            scrollbar-width: thin; /* 细滚动条 */
        }
        
        /* 配方列表在左侧面板中的样式优化 */
        .recipe-list-panel .recipe-list {
            margin-top: 0.5rem;
            width: 100%; /* 确保列表占满面板宽度 */
        }
        .tabbar {
            display: none; /* 隐藏底部导航栏 */
        }
        .dark .tabbar {
            background: #1E293B;
            border-top: 1px solid #334155;
            box-shadow: 0 -4px 20px 0 rgba(0,0,0,0.25);
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: #a1a1aa;
            text-decoration: none;
            font-size: 0.9rem; /* 增大字体 */
            padding: 0.75rem 0.5rem; /* 增加内边距 */
            transition: all 0.2s;
        }
        .tab-item i {
            font-size: 1.5rem; /* 稍微增大图标 */
            margin-bottom: 0.25rem; /* 增加图标与文字间距 */
        }
        .tab-item.active {
            color: #3B82F6;
            font-weight: 600;
        }
        .tab-item:hover {
            color: #3B82F6;
        }
        .category-item {
            width: 100%;
            padding: 0.5rem 0.25rem; /* 恢复合理的内边距 */
            border-radius: 0.5rem;
            margin-bottom: 0.4rem; /* 恢复合理的间距 */
            cursor: pointer;
            color: #64748B;
            font-size: 0.85rem; /* 恢复合理的字体大小 */
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            background: transparent;
            text-align: center;
        }
        .category-item.active {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: #fff;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.25);
            font-size: 0.75rem; /* 稍微增大活动状态的字体 */
        }
        .category-item:hover {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: #fff;
            transform: translateY(-1px);
        }
        .recipe-card {
            background: #fff;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
            border: 1px solid #E2E8F0;
            border-radius: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(.4,0,.2,1);
            position: relative;
            overflow: hidden;
            user-select: none; /* 防止长按选择文本 */
        }
        .dark .recipe-card {
            background: #1E293B;
            border-color: #334155;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
        }
        .recipe-card:hover {
            transform: translateY(-2px) translateX(2px);
            box-shadow: 0 8px 25px 0 rgba(37,99,235,0.15);
            border-color: #BFDBFE;
        }
        
        .dark .recipe-card:hover {
            border-color: #3B82F6;
            box-shadow: 0 8px 25px 0 rgba(37,99,235,0.3);
        }
        
        /* 左滑操作区域 */
        .recipe-card-actions {
            position: absolute;
            top: 0;
            right: -160px; /* 初始隐藏在右侧 */
            height: 100%;
            width: 160px;
            display: flex;
            transition: transform 0.3s ease;
        }
        
        .recipe-card.swiped .recipe-card-actions {
            transform: translateX(-160px);
        }
        
        .recipe-card-action {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            flex: 1;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            transition: all 0.2s;
        }
        
        .action-share {
            background: #3B82F6;
        }
        
        .action-share:hover {
            background: #2563EB;
        }
        
        .action-edit {
            background: #10B981;
        }
        
        .action-edit:hover {
            background: #059669;
        }
        
        .action-delete {
            background: #EF4444;
        }
        
        .action-delete:hover {
            background: #DC2626;
        }
        
        .recipe-card-content {
            width: 100%;
            display: flex;
            align-items: center;
            background: inherit;
            transition: transform 0.3s ease;
        }
        
        .recipe-card.swiped .recipe-card-content {
            transform: translateX(-160px);
        }
        
        /* 多选模式样式 */
        .recipe-checkbox {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid #E2E8F0;
            margin-right: 0.75rem;
            display: none;
            flex-shrink: 0;
            position: relative;
            transition: all 0.2s;
        }
        
        .dark .recipe-checkbox {
            border-color: #334155;
        }
        
        .recipe-checkbox.checked {
            background: #3B82F6;
            border-color: #3B82F6;
        }
        
        .recipe-checkbox.checked::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 6px;
            width: 6px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .selection-mode .recipe-checkbox {
            display: block;
        }
        
        .selection-mode .recipe-card-content {
            transform: none !important;
        }
        
        .selection-mode .recipe-card {
            transform: none !important;
        }
        .recipe-image {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            object-fit: cover;
            margin-right: 0.75rem;
            border: 2px solid #E2E8F0;
            transition: all 0.2s ease;
        }
        .dark .recipe-image {
            border-color: #334155;
        }
        
        .recipe-card:hover .recipe-image {
            transform: scale(1.05);
            border-color: #BFDBFE;
        }
        
        .dark .recipe-card:hover .recipe-image {
            border-color: #3B82F6;
        }
        .category-badge {
            background: #EFF6FF;
            color: #3B82F6;
            font-size: 0.75rem;
            padding: 0.375rem 0.875rem;
            border-radius: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #BFDBFE;
        }
        .dark .category-badge {
            background: #1E3A8A;
            color: #60A5FA;
            border-color: #3B82F6;
        }
        .category-badge:hover {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        .add-recipe-btn {
            position: fixed;
            bottom: 2rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.35);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(.4,0,.2,1);
            border: none;
            z-index: 50; /* 确保在上层 */
        }
        .add-recipe-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: linear-gradient(135deg, #2563EB, #1D4ED8);
            box-shadow: 0 12px 35px rgba(37, 99, 235, 0.45);
        }
        .add-recipe-btn:active {
            transform: scale(0.95);
        }
        .add-recipe-btn[disabled] {
            background: #e5e7eb;
            color: #a1a1aa;
            cursor: not-allowed;
            box-shadow: none;
        }
        .add-recipe-btn[disabled]:hover {
            transform: none;
        }
        
                    /* 在iPad视图中显示新建按钮 */
            @media (min-width: 768px) {
                .add-recipe-btn {
                    bottom: 2rem;
                    right: 2rem;
                    display: flex; /* 在iPad上显示 */
                }
            }

                    /* iframe样式 */
            #new-recipe-iframe-container, #recipe-detail-iframe-container {
                box-shadow: none; /* 移除阴影，使界面更加无缝 */
                border-left: 1px solid #E2E8F0;
                overflow: hidden;
            }
            
            .dark #new-recipe-iframe-container, .dark #recipe-detail-iframe-container {
                box-shadow: none;
                border-left: 1px solid #334155;
            }
        
        #new-recipe-iframe {
            background: white;
            border: none;
        }
        
        .dark #new-recipe-iframe {
            background: #0F172A;
        }
        
        /* 扩展模式下iframe的样式 */
        .expanded-mode #new-recipe-iframe {
            height: calc(100vh - 70px); /* 减去顶部导航栏的高度 */
            width: 100%; /* 使用100%宽度 */
        }
        
        .limit-tip {
            position: fixed;
            bottom: 6rem;
            right: 1.5rem;
            background: #fef2f2;
            color: #ef4444;
            padding: 0.75rem 1.25rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.15);
            display: none;
            border: 1px solid #fecaca;
        }
        .limit-tip.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .search-input {
            width: 100%;
            padding: 0.4rem 0.6rem;
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            background: white;
            transition: all 0.2s;
            font-size: 0.875rem; /* 恢复原来的字体大小 */
        }
        .dark .search-input {
            background: #1E293B;
            border-color: #334155;
            color: #F1F5F9;
        }
        .search-input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        .modal-overlay {
            backdrop-filter: blur(8px);
        }
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .category-manage-btn {
            transition: all 0.2s;
            cursor: pointer !important;
            pointer-events: auto !important;
            z-index: 100 !important;
            position: relative !important;
            user-select: none;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            min-height: 60px;
            min-width: 60px;
            background: transparent;
            border: none;
            outline: none;
        }
        .category-manage-btn:hover {
            transform: scale(1.1);
            background-color: rgba(59, 130, 246, 0.1) !important;
        }
        .category-manage-btn:active {
            transform: scale(0.95);
            background-color: rgba(59, 130, 246, 0.2) !important;
        }
        .category-manage-btn * {
            pointer-events: none !important;
        }
        .info-badge {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }
        
        /* 新建配方弹窗样式 */
        .new-recipe-modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .new-recipe-container {
            width: 90%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            background: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        /* iPad专用新建配方容器样式 */
        @media (min-width: 768px) {
            .new-recipe-container {
                max-width: 650px;
                max-height: 85vh;
            }
            
                                     #new-recipe-iframe-container {
                width: calc(100% - 180px) !important; /* 使用calc确保左侧面板始终有最小宽度 */
                max-width: none;
                left: auto; /* 不固定左侧位置，根据左侧面板宽度自动调整 */
                right: 0; /* 固定在右侧 */
            }
            
            #new-recipe-iframe {
                width: 100%;
                height: 100%;
                border: none;
            }
            
            /* 调整iframe内容样式，使输入框更宽 */
            #new-recipe-iframe {
                transform: scale(1); /* 确保内容正常显示 */
                transform-origin: 0 0; /* 从左上角开始变换 */
            }
            
            /* 增强返回按钮的样式 */
            .return-btn {
                position: fixed;
                top: 80px;
                left: 10px;
                z-index: 9999;
                width: 50px;
                height: 50px;
                background-color: #3B82F6;
                color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .return-btn:hover {
                background-color: #2563EB;
                transform: scale(1.1);
            }
            
            .return-btn:active {
                transform: scale(0.95);
            }
            
            /* 增强关闭按钮样式 */
            .close-btn {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                width: 40px;
                height: 40px;
                background-color: #EF4444;
                color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .close-btn:hover {
                background-color: #DC2626;
                transform: scale(1.1);
            }
            
            .close-btn:active {
                transform: scale(0.95);
            }
            
            /* 新建配方页面容器样式 */
            .new-recipe-content {
                overflow: visible !important; /* 确保宽度增加的输入框不被裁剪 */
            }
        }
        
        .dark .new-recipe-container {
            background: #1E293B;
            border: 1px solid #334155;
        }
        
        .new-recipe-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E2E8F0;
            position: sticky;
            top: 0;
            background: inherit;
            border-radius: 24px 24px 0 0;
            z-index: 10;
        }
        
        .dark .new-recipe-header {
            border-color: #334155;
        }
        
        .new-recipe-content {
            padding: 1.5rem;
        }
        
        .new-recipe-footer {
            padding: 1.5rem;
            border-top: 1px solid #E2E8F0;
            display: flex;
            justify-content: space-between;
            position: sticky;
            bottom: 0;
            background: inherit;
            border-radius: 0 0 24px 24px;
        }
        
        .dark .new-recipe-footer {
            border-color: #334155;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        /* iPad专用表单组样式 */
        @media (min-width: 768px) {
            .form-group {
                margin-bottom: 2rem;
            }
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1E293B;
        }
        
        .dark .form-label {
            color: #F1F5F9;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #E2E8F0;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            transition: all 0.2s;
            background: white;
        }
        
        /* iPad新建配方页面输入框样式 */
        @media (min-width: 768px) {
            iframe#new-recipe-iframe .form-input,
            iframe#new-recipe-iframe input[type="text"],
            iframe#new-recipe-iframe input[type="number"],
            iframe#new-recipe-iframe input[type="password"],
            iframe#new-recipe-iframe select,
            iframe#new-recipe-iframe textarea {
                width: 133.33%; /* 输入框宽度增加三分之一 */
                max-width: 133.33%;
            }
        }
        
        .dark .form-input {
            background: #0F172A;
            border-color: #334155;
            color: #F1F5F9;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        /* iPad专用输入框样式 */
        @media (min-width: 768px) {
            .form-input {
                padding: 1.25rem 1.5rem;
                font-size: 1.15rem;
                border-radius: 1rem;
                width: 133.33%; /* 输入框宽度增加三分之一 */
                max-width: 133.33%;
            }
            
            .form-textarea {
                min-height: 200px;
                padding: 1.25rem 1.5rem;
                font-size: 1.15rem;
                border-radius: 1rem;
                width: 133.33%; /* 输入框宽度增加三分之一 */
                max-width: 133.33%;
            }
            
            .form-select {
                height: 3.75rem;
                font-size: 1.15rem;
                width: 133.33%; /* 输入框宽度增加三分之一 */
                max-width: 133.33%;
            }
            
            .form-label {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
                width: 133.33%; /* 标签宽度也相应增加 */
            }
            
            /* 确保表单组也能容纳更宽的输入框 */
            .form-group {
                width: 100%;
                overflow: visible;
                position: relative;
            }
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748B'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        /* iPad专用按钮样式 */
        @media (min-width: 768px) {
            .btn {
                padding: 1rem 2rem;
                border-radius: 1rem;
                font-size: 1rem;
                font-weight: 700;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB, #1D4ED8);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }
        
        .btn-secondary {
            background: #F1F5F9;
            color: #64748B;
            border: none;
        }
        
        .dark .btn-secondary {
            background: #334155;
            color: #CBD5E1;
        }
        
        .btn-secondary:hover {
            background: #E2E8F0;
            color: #475569;
        }
        
        .dark .btn-secondary:hover {
            background: #475569;
            color: #F1F5F9;
        }
        
        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #F1F5F9;
            color: #64748B;
            border: none;
            transition: all 0.2s;
        }
        
        .dark .btn-icon {
            background: #334155;
            color: #CBD5E1;
        }
        
        .btn-icon:hover {
            background: #E2E8F0;
            color: #475569;
            transform: rotate(90deg);
        }
        
        .dark .btn-icon:hover {
            background: #475569;
            color: #F1F5F9;
        }
        
        .image-upload {
            width: 100%;
            height: 180px;
            border: 2px dashed #E2E8F0;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #F8FAFC;
            overflow: hidden;
            position: relative;
        }
        
        .dark .image-upload {
            border-color: #334155;
            background: #0F172A;
        }
        
        .image-upload:hover {
            border-color: #3B82F6;
            background: #EFF6FF;
        }
        
        .dark .image-upload:hover {
            border-color: #3B82F6;
            background: #1E3A8A;
        }
        
        .image-upload-icon {
            font-size: 2rem;
            color: #64748B;
            margin-bottom: 0.5rem;
        }
        
        .dark .image-upload-icon {
            color: #94A3B8;
        }
        
        .image-upload-text {
            font-size: 0.875rem;
            color: #64748B;
        }
        
        .dark .image-upload-text {
            color: #94A3B8;
        }
        
        .image-preview {
            position: absolute;
            inset: 0;
            object-fit: cover;
            width: 100%;
            height: 100%;
        }
        
        .image-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 2rem;
            height: 2rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .dark .image-remove {
            background: rgba(15, 23, 42, 0.8);
        }
        
        .image-upload:hover .image-remove {
            opacity: 1;
        }
        
        .tab-group {
            display: flex;
            border-bottom: 2px solid #E2E8F0;
            margin-bottom: 1.5rem;
        }
        
        .dark .tab-group {
            border-color: #334155;
        }
        
        .tab-item-form {
            padding: 0.75rem 1rem;
            font-weight: 600;
            color: #64748B;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .dark .tab-item-form {
            color: #94A3B8;
        }
        
        .tab-item-form.active {
            color: #3B82F6;
        }
        
        .tab-item-form.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #3B82F6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .hidden {
            display: none;
        }
        
        /* 类别管理模态框样式优化 */
        .category-list-container {
            max-height: 60vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0.5rem;
            margin: -0.5rem;
        }
        
        .drag-handle {
            touch-action: none;
            cursor: move;
            user-select: none;
            width: 2.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            margin: -0.5rem 0;
            margin-right: 0.5rem;
        }
        
        .category-item-dragging {
            background-color: #EFF6FF !important;
            border: 2px solid #3B82F6 !important;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2) !important;
            opacity: 0.9;
            position: relative;
            z-index: 10;
        }
        
        .dark .category-item-dragging {
            background-color: #1E3A8A !important;
            border-color: #3B82F6 !important;
        }
        
        .category-item-ghost {
            opacity: 0.3;
            border: 2px dashed #3B82F6;
        }
        
        .sortable-ghost {
            opacity: 0.3;
            background-color: rgba(59, 130, 246, 0.1) !important;
            border: 2px dashed #3B82F6 !important;
        }
        
        .sortable-chosen {
            background-color: #EFF6FF !important;
            border: 2px solid #3B82F6 !important;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2) !important;
        }
        
        .dark .sortable-chosen {
            background-color: #1E3A8A !important;
        }
        
        .sortable-drag {
            opacity: 0.9;
        }
        
        .category-manage-list-item {
            transition: background-color 0.2s ease, border-color 0.2s ease;
            margin-bottom: 0.5rem;
            cursor: move;
        }
        
        /* 顶部导航栏样式 */
        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .dark .top-navbar {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid #334155;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            color: #64748B;
            font-weight: 500;
            transition: all 0.2s;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
        }
        
        .dark .back-button {
            color: #94A3B8;
        }
        
        .back-button:hover {
            background: #EFF6FF;
            color: #3B82F6;
        }
        
        .dark .back-button:hover {
            background: #1E3A8A;
            color: #60A5FA;
        }
        
        .back-button i {
            margin-right: 0.5rem;
        }
        
        .page-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1E293B;
        }
        
        .dark .page-title {
            color: #F1F5F9;
        }
        
        /* 移除面板切换按钮相关样式 */
        
        /* 固定布局下类别栏的样式 */
        .category-sidebar {
            width: 100px; /* 保持类别栏宽度不变 */
            min-width: 100px;
            padding: 0.25rem 0.15rem;
            margin-right: 0; /* 移除右侧间距，消除间隙 */
            overflow-y: auto;
            flex-shrink: 0; /* 防止收缩 */
            font-size: 0.85rem; /* 保持字体大小不变 */
            border: 1px solid #E2E8F0; /* 添加边框 */
            border-radius: 0.75rem; /* 保持圆角 */
            background-color: white; /* 添加背景色 */
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* 保持阴影 */
        }
        
        .dark .category-sidebar {
            border-color: #334155;
            background-color: #1E293B;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* 固定布局下配方列表面板的样式 */
        .recipe-list-panel {
            padding: 0.25rem;
            flex: 0.6; /* 减少宽度占比 */
            min-width: 0; /* 允许收缩 */
            width: calc(60% - 105px); /* 缩小宽度，与类别栏搭配 */
            min-width: 80px; /* 减少最小宽度 */
            max-width: none; /* 移除最大宽度限制 */
            border: 1px solid #E2E8F0; /* 添加边框 */
            border-radius: 0.75rem; /* 保持圆角 */
            background-color: white; /* 添加背景色 */
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* 保持阴影 */
        }
        
        .dark .recipe-list-panel {
            border-color: #334155;
            background-color: #1E293B;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* 移除新建配方iframe样式，不再需要 */
        
        /* 配方卡片样式优化 - 恢复正常显示 */
        .recipe-card {
            padding: 0.5rem; /* 恢复内边距 */
            margin-bottom: 0.35rem; /* 恢复下方间距 */
            border: 1px solid #E2E8F0; /* 添加边框 */
            border-radius: 0.75rem; /* 保持圆角 */
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); /* 减小阴影 */
        }
        
        .dark .recipe-card {
            border-color: #334155;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .recipe-image {
            width: 2.25rem; /* 稍微减小图片尺寸 */
            height: 2.25rem;
            margin-right: 0.25rem; /* 减少右侧间距 */
            border-radius: 0.5rem; /* 保持图片圆角 */
        }
        
                    .recipe-card .font-semibold {
            font-size: 0.8rem; /* 减小字体大小 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80px; /* 进一步减少最大宽度，确保在最小宽度下仍能显示 */
        }
        
        .recipe-card .text-xs {
            display: block; /* 显示更新时间 */
            font-size: 0.75rem;
            color: #64748B;
        }
        
        .category-badge {
            display: none; /* 隐藏类别标签，节省空间 */
        }
        
        .dark .content-wrapper {
            border-right-color: #334155;
        }
    </style>
</head>
<body class="min-h-screen bg-[#F8FAFC] dark:bg-[#0F172A] text-[#1E293B] dark:text-slate-100">
    <!-- 顶部导航栏 -->
    <div class="top-navbar">
        <div class="flex items-center">
            <button id="back-btn" class="back-button" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i>
                <span>返回</span>
            </button>
            <h1 class="page-title ml-4">配方管理</h1>
        </div>
        <div class="flex items-center gap-3">
            <span class="info-badge flex items-center">
                <span class="used-count font-bold">30</span>
                <span class="mx-1">/</span>
                <span class="total-count">50</span>
            </span>
            <button id="themeSwitch" class="theme-switch ml-2">
                <i class="fas fa-moon text-[#64748B] dark:text-slate-300"></i>
            </button>
        </div>
    </div>

    <div class="main-container">
        
        <!-- 内容区 -->
        <div class="content-wrapper">
            <!-- 左侧区域：类别和配方列表 -->
            <div class="left-panel">
                <!-- 类别栏 -->
                <aside class="category-sidebar">
                    <button class="category-item active">All</button>
                    <button class="category-item">Bread</button>
                    <button class="category-item">Cake</button>
                    <button class="category-item">Cookie</button>
                    <button class="category-item">Mousse</button>
                    <button class="category-item">Toast</button>
                    <button class="category-item">Pastry</button>
                    <button class="category-manage-btn mt-auto text-xs text-[#64748B] hover:text-[#3B82F6] dark:text-slate-400 dark:hover:text-[#60A5FA] flex flex-col items-center justify-center p-2 rounded-lg hover:bg-[#EFF6FF] dark:hover:bg-[#1E3A8A] transition-all" title="管理类别" onclick="window.showCategoryModal()">
                        <i class="fas fa-cog text-lg mb-1"></i>
                        <span>管理</span>
                    </button>
                </aside>
                
                <!-- 配方列表区域 -->
                <div class="recipe-list-panel">
                    <!-- 配方列表标题 -->
                    <div class="flex items-center justify-between mb-3 bg-[#F8FAFC] dark:bg-[#0F172A] p-3 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-[#3B82F6] to-[#2563EB] rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-book text-white text-sm"></i>
                            </div>
                            <h2 class="font-semibold text-lg text-[#1E293B] dark:text-slate-100">配方列表</h2>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-50 dark:bg-blue-900/20 px-3 py-1 rounded-lg flex items-center">
                                <span class="text-blue-600 dark:text-blue-400 text-sm font-medium">
                                    <span class="used-count">30</span>/<span class="total-count">50</span>
                                </span>
                            </div>
                            <button class="add-recipe-btn-small bg-gradient-to-r from-[#3B82F6] to-[#2563EB] text-white rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:from-[#2563EB] hover:to-[#1D4ED8] active:scale-95 transition-all" onclick="showRecipeTypeModal()" title="新建配方">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 搜索栏 -->
                    <div class="flex items-center mb-3 gap-2 relative">
                        <input type="text" class="search-input" placeholder="搜索配方名称...">
                        <i class="fas fa-search text-[#3B82F6] dark:text-[#60A5FA] absolute right-4"></i>
                    </div>
                    
                    <!-- 配方列表 -->
                    <div class="recipe-list">
                        <div class="recipe-card" data-recipe-id="1">
                            <div class="recipe-checkbox"></div>
                            <div class="recipe-card-content">
                            <img src="https://images.unsplash.com/photo-1555507036-ab1f4038808a" class="recipe-image" alt="法国老面">
                            <div class="flex-1">
                                <div class="font-semibold text-base text-[#1E293B] dark:text-slate-100">法国老面</div>
                                <div class="text-xs text-[#64748B] dark:text-slate-400">更新于 2天前</div>
                            </div>
                            <button class="category-badge" data-current="Bread">Bread</button>
                            </div>
                            <div class="recipe-card-actions">
                                <button class="recipe-card-action action-share">
                                    <i class="fas fa-share-alt mb-1"></i>
                                    <span>分享</span>
                                </button>
                                <button class="recipe-card-action action-edit">
                                    <i class="fas fa-edit mb-1"></i>
                                    <span>编辑</span>
                                </button>
                                <button class="recipe-card-action action-delete">
                                    <i class="fas fa-trash mb-1"></i>
                                    <span>删除</span>
                                </button>
                            </div>
                        </div>

                        <div class="recipe-card" data-recipe-id="2">
                            <div class="recipe-checkbox"></div>
                            <div class="recipe-card-content">
                            <img src="https://images.unsplash.com/photo-1608198093002-ad4e505484ba" class="recipe-image" alt="巧克力蛋糕">
                            <div class="flex-1">
                                <div class="font-semibold text-base text-[#1E293B] dark:text-slate-100">巧克力蛋糕</div>
                                <div class="text-xs text-[#64748B] dark:text-slate-400">更新于 1周前</div>
                            </div>
                            <button class="category-badge" data-current="Cake">Cake</button>
                            </div>
                            <div class="recipe-card-actions">
                                <button class="recipe-card-action action-share">
                                    <i class="fas fa-share-alt mb-1"></i>
                                    <span>分享</span>
                                </button>
                                <button class="recipe-card-action action-edit">
                                    <i class="fas fa-edit mb-1"></i>
                                    <span>编辑</span>
                                </button>
                                <button class="recipe-card-action action-delete">
                                    <i class="fas fa-trash mb-1"></i>
                                    <span>删除</span>
                                </button>
                            </div>
                        </div>

                        <div class="recipe-card" data-recipe-id="3">
                            <div class="recipe-checkbox"></div>
                            <div class="recipe-card-content">
                            <img src="https://images.unsplash.com/photo-1551106652-a5bcf4b29ab6" class="recipe-image" alt="黄油曲奇">
                            <div class="flex-1">
                                <div class="font-semibold text-base text-[#1E293B] dark:text-slate-100">黄油曲奇</div>
                                <div class="text-xs text-[#64748B] dark:text-slate-400">更新于 2周前</div>
                            </div>
                            <button class="category-badge" data-current="Cookie">Cookie</button>
                            </div>
                            <div class="recipe-card-actions">
                                <button class="recipe-card-action action-share">
                                    <i class="fas fa-share-alt mb-1"></i>
                                    <span>分享</span>
                                </button>
                                <button class="recipe-card-action action-edit">
                                    <i class="fas fa-edit mb-1"></i>
                                    <span>编辑</span>
                                </button>
                                <button class="recipe-card-action action-delete">
                                    <i class="fas fa-trash mb-1"></i>
                                    <span>删除</span>
                                </button>
                            </div>
                        </div>

                        <div class="recipe-card" data-recipe-id="4">
                            <div class="recipe-checkbox"></div>
                            <div class="recipe-card-content">
                            <img src="https://images.unsplash.com/photo-1551024506-0bccd828d307" class="recipe-image" alt="法式马卡龙">
                            <div class="flex-1">
                                <div class="font-semibold text-base text-[#1E293B] dark:text-slate-100">法式马卡龙</div>
                                <div class="text-xs text-[#64748B] dark:text-slate-400">更新于 3周前</div>
                            </div>
                            <button class="category-badge" data-current="Pastry">Pastry</button>
                            </div>
                            <div class="recipe-card-actions">
                                <button class="recipe-card-action action-share">
                                    <i class="fas fa-share-alt mb-1"></i>
                                    <span>分享</span>
                                </button>
                                <button class="recipe-card-action action-edit">
                                    <i class="fas fa-edit mb-1"></i>
                                    <span>编辑</span>
                                </button>
                                <button class="recipe-card-action action-delete">
                                    <i class="fas fa-trash mb-1"></i>
                                    <span>删除</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- 移除右侧详情面板 -->

        <!-- 新建配方按钮（在所有设备上显示） -->
        <button class="add-recipe-btn" title="新建配方" onclick="showRecipeTypeModal()">
            <i class="fas fa-plus"></i>
        </button>
        <div class="limit-tip">已达免费版配方上限</div>

        <!-- 移除底部导航栏 -->
    </div>

    <!-- 类别管理弹窗 -->
    <div id="category-manage-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[200] hidden modal-overlay">
        <div class="bg-white dark:bg-[#1E293B] rounded-2xl shadow-2xl p-6 w-11/12 max-w-md modal-content card" style="max-height: 90vh; overflow: hidden;">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white dark:bg-[#1E293B] z-10 py-2">
                <h3 class="text-lg font-bold text-[#1E293B] dark:text-slate-100">类别管理</h3>
                <div class="flex items-center">
                    <span class="text-sm text-[#64748B] dark:text-slate-400 mr-3">拖动排序</span>
                    <button id="category-manage-close" class="text-[#64748B] dark:text-slate-400 hover:text-[#1E293B] dark:hover:text-slate-100 text-2xl transition-all hover:rotate-90">×</button>
                </div>
            </div>
            <ul id="category-manage-list" class="mb-4 pb-2"></ul>
            <div class="flex gap-2 sticky bottom-0 bg-white dark:bg-[#1E293B] z-10 py-2">
                <input id="category-new-input" type="text" placeholder="新类别名称" class="flex-1 px-3 py-2 border-2 border-[#E2E8F0] dark:border-[#334155] rounded-xl focus:outline-none focus:border-[#3B82F6] focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 bg-white dark:bg-[#0F172A] text-[#1E293B] dark:text-slate-100 transition-all">
                <button id="category-add-btn" class="px-6 py-2 bg-gradient-to-r from-[#3B82F6] to-[#2563EB] text-white rounded-xl hover:from-[#2563EB] hover:to-[#1D4ED8] transition-all font-semibold shadow-lg hover:shadow-xl active:scale-95">添加</button>
            </div>
        </div>
    </div>

    <!-- 类别选择弹窗 -->
    <div id="category-popup" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden modal-overlay">
        <div class="bg-white dark:bg-[#1E293B] rounded-2xl shadow-2xl p-4 w-48 modal-content card">
            <div class="font-semibold mb-3 text-[#1E293B] dark:text-slate-100">切换类别</div>
            <div id="category-popup-list" class="space-y-2"></div>
            <button id="category-popup-cancel" class="mt-3 w-full py-2 rounded-xl bg-[#F1F5F9] dark:bg-[#334155] text-[#64748B] dark:text-slate-300 hover:bg-[#E2E8F0] dark:hover:bg-[#475569] transition-all active:scale-95">取消</button>
        </div>
    </div>
    
    <!-- 新建配方弹窗 -->
    <div id="new-recipe-modal" class="new-recipe-modal hidden">
        <div class="new-recipe-container" style="max-width: 480px;">
            <div class="new-recipe-header flex justify-between items-center">
                <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100">🧂 新建配方</h2>
                <button id="new-recipe-close" class="btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="new-recipe-content">
                <!-- 常用类型 -->
                <div class="mb-4">
                    <h3 class="text-sm font-medium text-[#64748B] dark:text-slate-400 mb-3">常用类型</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg">
                            <div class="w-10 h-10 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mr-3">
                                <span class="text-xl">🍞</span>
                            </div>
                            <span class="font-medium text-[#1E293B] dark:text-slate-100">面包</span>
                        </div>
                        
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg">
                            <div class="w-10 h-10 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mr-3">
                                <span class="text-xl">🎂</span>
                            </div>
                            <span class="font-medium text-[#1E293B] dark:text-slate-100">蛋糕</span>
                        </div>
                        
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg">
                            <div class="w-10 h-10 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mr-3">
                                <span class="text-xl">🥜</span>
                            </div>
                            <span class="font-medium text-[#1E293B] dark:text-slate-100">馅料</span>
                        </div>
                        
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg">
                            <div class="w-10 h-10 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mr-3">
                                <span class="text-xl">🍝</span>
                            </div>
                            <span class="font-medium text-[#1E293B] dark:text-slate-100">西餐</span>
                        </div>
                    </div>
                </div>
                
                <!-- 其他类型 -->
                <div class="mb-4">
                    <h3 class="text-sm font-medium text-[#64748B] dark:text-slate-400 mb-3">其他类型</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex flex-col items-center justify-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg active:scale-95" style="height: 80px;">
                            <span class="text-2xl mb-1">☕</span>
                            <span class="font-medium text-sm text-[#1E293B] dark:text-slate-100">饮品</span>
                        </div>
                        
                        <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-3 flex flex-col items-center justify-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg active:scale-95" style="height: 80px;">
                            <span class="text-2xl mb-1">🔠</span>
                            <span class="font-medium text-sm text-[#1E293B] dark:text-slate-100">其他</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="new-recipe-footer">
                <button id="new-recipe-cancel" class="btn btn-secondary">取消</button>
                <button id="new-recipe-save" class="btn btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 新建配方类型选择弹窗 -->
    <div id="recipe-type-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[200] hidden modal-overlay">
        <div class="bg-white dark:bg-[#1E293B] rounded-2xl shadow-2xl p-6 w-11/12 max-w-xl modal-content card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-[#1E293B] dark:text-slate-100">选择配方类型</h3>
                <button id="recipe-type-close" class="text-[#64748B] dark:text-slate-400 hover:text-[#1E293B] dark:hover:text-slate-100 text-2xl transition-all hover:rotate-90" onclick="closeRecipeTypeModal()">×</button>
            </div>
            
            <div class="mb-6">
                <!-- 常用类型 -->
                <h4 class="text-sm font-medium text-[#64748B] dark:text-slate-400 mb-3">常用类型</h4>
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('bread')">
                        <div class="w-16 h-16 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mb-3">
                            <span class="text-3xl">🍞</span>
                        </div>
                        <span class="font-medium text-[#1E293B] dark:text-slate-100 text-lg">面包</span>
                    </div>
                    
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('cake')">
                        <div class="w-16 h-16 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mb-3">
                            <span class="text-3xl">🎂</span>
                        </div>
                        <span class="font-medium text-[#1E293B] dark:text-slate-100 text-lg">蛋糕</span>
                    </div>
                    
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('cookie')">
                        <div class="w-16 h-16 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mb-3">
                            <span class="text-3xl">🍪</span>
                        </div>
                        <span class="font-medium text-[#1E293B] dark:text-slate-100 text-lg">饼干</span>
                    </div>

                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('filling')">
                        <div class="w-16 h-16 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mb-3">
                            <span class="text-3xl">🥜</span>
                        </div>
                        <span class="font-medium text-[#1E293B] dark:text-slate-100 text-lg">馅料</span>
                    </div>
                    
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('western')">
                        <div class="w-16 h-16 rounded-full bg-[#EFF6FF] dark:bg-[#1E3A8A] flex items-center justify-center mb-3">
                            <span class="text-3xl">🍝</span>
                        </div>
                        <span class="font-medium text-[#1E293B] dark:text-slate-100 text-lg">西餐</span>
                    </div>
                </div>

                <!-- 其他类型 -->
                <h4 class="text-sm font-medium text-[#64748B] dark:text-slate-400 mb-3">其他类型</h4>
                <div class="grid grid-cols-4 gap-4">
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center justify-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('beverage')" style="height: 100px;">
                        <span class="text-3xl mb-2">☕</span>
                        <span class="font-medium text-sm text-[#1E293B] dark:text-slate-100">饮品</span>
                    </div>
                    
                    <div class="recipe-type-card bg-white dark:bg-[#1E293B] rounded-xl p-4 flex flex-col items-center justify-center border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all cursor-pointer hover:shadow-lg" onclick="selectRecipeType('other')" style="height: 100px;">
                        <span class="text-3xl mb-2">🔠</span>
                        <span class="font-medium text-sm text-[#1E293B] dark:text-slate-100">其他</span>
                    </div>
                </div>
            </div>
            
            <button class="w-full py-3 text-[#64748B] dark:text-slate-400 bg-[#F1F5F9] dark:bg-[#334155] rounded-xl hover:bg-[#E2E8F0] dark:hover:bg-[#475569] transition-all" onclick="closeRecipeTypeModal()">
                取消
            </button>
        </div>
    </div>

    <!-- 还原主题切换按钮 -->
    <button id="themeSwitch" class="theme-switch">
        <i class="fas fa-moon text-[#64748B] dark:text-slate-300"></i>
    </button>
    
    <!-- 分享弹窗 -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] hidden">
        <div class="bg-white dark:bg-[#1E293B] rounded-2xl p-6 max-w-md mx-4 w-[90%] shadow-2xl">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-lg font-bold text-[#1E293B] dark:text-slate-100">分享配方</h3>
                <button id="share-close-btn" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 text-xl hover:rotate-90 transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p class="text-slate-600 dark:text-slate-400 text-sm mb-6" id="share-description">选择要分享到的平台</p>
            
            <div class="grid grid-cols-4 gap-4 mb-6">
                <!-- 社交平台 -->
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="wechat">
                    <div class="w-14 h-14 bg-green-500 rounded-full flex items-center justify-center text-white">
                        <i class="fab fa-weixin text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">微信</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="xiaoHongShu">
                    <div class="w-14 h-14 bg-red-500 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-bookmark text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">小红书</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="douyin">
                    <div class="w-14 h-14 bg-black rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-music text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">抖音</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="weibo">
                    <div class="w-14 h-14 bg-red-600 rounded-full flex items-center justify-center text-white">
                        <i class="fab fa-weibo text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">微博</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="qq">
                    <div class="w-14 h-14 bg-blue-500 rounded-full flex items-center justify-center text-white">
                        <i class="fab fa-qq text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">QQ</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="bilibili">
                    <div class="w-14 h-14 bg-pink-500 rounded-full flex items-center justify-center text-white">
                        <i class="fab fa-bilibili text-xl">B</i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">哔哩哔哩</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="link">
                    <div class="w-14 h-14 bg-gray-500 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-link text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">复制链接</span>
                </div>
                
                <div class="social-platform flex flex-col items-center gap-1 cursor-pointer hover:scale-110 transition-all" data-platform="more">
                    <div class="w-14 h-14 bg-purple-500 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-ellipsis-h text-xl"></i>
                    </div>
                    <span class="text-xs text-slate-600 dark:text-slate-400">更多</span>
                </div>
            </div>
            
            <!-- 分享到应用商店评分 -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-xl mb-4 cursor-pointer" onclick="shareToAppStore()">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-star text-white"></i>
                    </div>
                    <div>
                        <div class="font-medium text-blue-800 dark:text-blue-300">去应用商店评分</div>
                        <div class="text-xs text-blue-600 dark:text-blue-400">喜欢这个App？给我们5星好评吧！</div>
                    </div>
                    <i class="fas fa-chevron-right ml-auto text-blue-500 dark:text-blue-400"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- 多选操作栏 -->
    <div id="selection-toolbar" class="fixed bottom-20 left-0 right-0 px-4 mx-auto w-full max-w-md hidden">
        <div class="bg-white dark:bg-[#1E293B] rounded-xl shadow-xl p-4 flex items-center justify-between">
            <div>
                <span id="selection-count" class="font-semibold text-[#1E293B] dark:text-slate-100">已选择 0 项</span>
            </div>
            <div class="flex gap-3">
                <button id="selection-share" class="px-4 py-2 rounded-lg bg-[#3B82F6] text-white flex items-center gap-1">
                    <i class="fas fa-share-alt"></i>
                    <span>分享</span>
                </button>
                <button id="selection-delete" class="px-4 py-2 rounded-lg bg-[#EF4444] text-white flex items-center gap-1">
                    <i class="fas fa-trash"></i>
                    <span>删除</span>
                </button>
                <button id="selection-cancel" class="px-3 py-2 rounded-lg bg-[#F1F5F9] dark:bg-[#334155] text-[#64748B] dark:text-slate-300">
                    取消
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        // 全局错误处理
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('捕获到错误:', message);
            console.error('错误来源:', source);
            console.error('行号:', lineno, '列号:', colno);
            console.error('错误对象:', error);
            return false;
        };

        // 全局变量，用于分享功能
        let currentShareTitle = '';
        let currentBatchShare = false;
        let currentBatchCount = 0;
        let currentBatchTitles = [];
        
        // 确保DOM完全加载后再执行脚本
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            
            // 添加调试信息
            console.log('初始化应用程序...');
            console.log('查找面包类型卡片:', document.querySelectorAll('.recipe-type-card').length);
            
            // 初始化iPad布局
            if (window.innerWidth >= 768) {
                // 显示右侧面板
                const detailPanel = document.querySelector('.recipe-detail-panel');
                if (detailPanel) {
                    detailPanel.classList.remove('hidden');
                    detailPanel.classList.add('md:flex');
                }
                
                // 默认显示空状态
                document.getElementById('empty-state').classList.remove('hidden');
                document.getElementById('recipe-detail-content').classList.add('hidden');
                document.getElementById('new-recipe-form').classList.add('hidden');
                
                // 隐藏面板切换按钮
                document.getElementById('panel-toggle-btn').classList.add('hidden');
            }
            
            // 主题切换
            const themeSwitch = document.getElementById('themeSwitch');
            const themeIcon = themeSwitch.querySelector('i');
            
            // 初始化主题
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeSwitch.addEventListener('click', () => {
                const html = document.documentElement;
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                }
            });

            // 配方数量管理
            const used = 30;
            const total = 50;
            const addBtn = document.querySelector('.add-recipe-btn');
            const usedCount = document.querySelector('.used-count');
            const totalCount = document.querySelector('.total-count');
            const limitTip = document.querySelector('.limit-tip');

            function updateLimitStatus() {
                usedCount.textContent = used;
                totalCount.textContent = total;
                if (used >= total) {
                    addBtn.disabled = true;
                    limitTip.classList.add('show');
                }
            }
            updateLimitStatus();

            // 类别切换
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('类别点击:', item.textContent);
                    
                    // 移除所有类别的active状态
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    
                    // 为当前点击的类别添加active状态
                    item.classList.add('active');
                    
                    // 根据类别执行相应操作
                    const categoryText = item.textContent.trim();
                    
                    // 筛选配方列表
                    filterRecipesByCategory(categoryText);
                    
                    if (categoryText === 'Bread') {
                        console.log('面包类别被点击，但不自动跳转');
                        // 不再自动跳转，而是筛选显示
                    } else {
                        // 其他类别筛选配方
                        console.log('筛选类别:', categoryText);
                    }
                });
            });
            
            // 添加配方筛选功能
            function filterRecipesByCategory(category) {
                const recipeCards = document.querySelectorAll('.recipe-card');
                
                // 如果是"All"类别，显示所有配方
                if (category === 'All') {
                    recipeCards.forEach(card => {
                        card.style.display = 'flex';
                    });
                    return;
                }
                
                // 否则根据类别筛选
                recipeCards.forEach(card => {
                    const cardCategory = card.querySelector('.category-badge').dataset.current;
                    if (cardCategory === category) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            // 配方类别切换
            const allCategories = ["Bread", "Cake", "Cookie", "Mousse", "Toast", "Pastry"];
            const popup = document.getElementById('category-popup');
            const popupList = document.getElementById('category-popup-list');
            const popupCancel = document.getElementById('category-popup-cancel');
            let currentSwitchBtn = null;

            document.querySelectorAll('.category-badge').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡，防止触发卡片的点击事件
                    currentSwitchBtn = btn;
                    popupList.innerHTML = '';
                    allCategories.forEach(cat => {
                        const option = document.createElement('button');
                        option.className = 'w-full text-left px-3 py-2 rounded-xl hover:bg-[#EFF6FF] dark:hover:bg-[#1E3A8A] text-[#1E293B] dark:text-slate-100 transition-all';
                        option.textContent = cat;
                        if(cat === btn.dataset.current) {
                            option.classList.add('bg-[#EFF6FF]', 'dark:bg-[#1E3A8A]', 'font-bold', 'text-[#3B82F6]', 'dark:text-[#60A5FA]');
                        }
                        option.onclick = (e) => {
                            e.stopPropagation(); // 阻止事件冒泡
                            const oldCategory = btn.dataset.current;
                            btn.textContent = cat;
                            btn.dataset.current = cat;
                            popup.classList.add('hidden');
                            
                            // 更新卡片的类别并触发类别筛选
                            const recipeCard = btn.closest('.recipe-card');
                            if (recipeCard) {
                                // 如果当前正在筛选某个类别，并且卡片类别改变了，可能需要隐藏该卡片
                                const activeCategory = document.querySelector('.category-item.active').textContent.trim();
                                if (activeCategory !== 'All' && activeCategory !== cat) {
                                    recipeCard.style.display = 'none';
                                }
                            }
                            
                            // 不再自动跳转
                            if(cat === 'Bread') {
                                console.log('配方类型改为面包，但不自动跳转');
                            }
                        };
                        popupList.appendChild(option);
                    });
                    popup.classList.remove('hidden');
                });
            });

            popupCancel.onclick = () => popup.classList.add('hidden');
            popup.onclick = e => { if(e.target === popup) popup.classList.add('hidden'); };

            // 类别管理
            const categoryManageModal = document.getElementById('category-manage-modal');
            const categoryManageList = document.getElementById('category-manage-list');
            const categoryManageClose = document.getElementById('category-manage-close');
            const categoryAddBtn = document.getElementById('category-add-btn');
            const categoryNewInput = document.getElementById('category-new-input');
            let categories = ["All", "Bread", "Cake", "Cookie", "Mousse", "Toast", "Pastry"];
            
            // 更新左侧类别栏显示
            function updateCategorySidebar() {
                const categorySidebar = document.querySelector('.category-sidebar');
                const manageBtn = categorySidebar.querySelector('.category-manage-btn');
                
                // 清除现有的类别按钮（保留管理按钮）
                const categoryItems = categorySidebar.querySelectorAll('.category-item');
                categoryItems.forEach(item => item.remove());
                
                // 重新添加类别按钮
                categories.forEach((cat, idx) => {
                    const button = document.createElement('button');
                    button.className = 'category-item';
                    button.textContent = cat;
                    if (idx === 0) button.classList.add('active'); // 默认激活第一个
                    
                    // 为新创建的按钮添加点击事件
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('类别点击:', button.textContent);
                        
                        // 移除所有类别的active状态
                        document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                        
                        // 为当前点击的类别添加active状态
                        button.classList.add('active');
                        
                        // 根据类别执行相应操作
                        const categoryText = button.textContent.trim();
                        
                        // 筛选配方列表
                        filterRecipesByCategory(categoryText);
                        
                        if (categoryText === 'Bread') {
                            console.log('面包类别被点击，但不自动跳转');
                            // 不再自动跳转，而是筛选显示
                        } else {
                            // 其他类别筛选配方
                            console.log('筛选类别:', categoryText);
                        }
                    });
                    
                    // 插入到管理按钮之前
                    categorySidebar.insertBefore(button, manageBtn);
                });
                
                // 重新初始化类别管理按钮事件（确保新创建的DOM元素有事件绑定）
                initCategoryManageEvents();
            }

            // 声明一次全局变量，避免重复声明
            let draggedElement = null;
            let draggedIndex = null;
            let touchStartY = 0;
            let touchStartX = 0;
            let isDragging = false;
            let longPressTimer = null;
            let sortableInstance = null;
            
            function renderCategoryManageList() {
                categoryManageList.innerHTML = '';
                
                // 创建一个容器用于滚动
                const listContainer = document.createElement('div');
                listContainer.className = 'category-list-container';
                categoryManageList.appendChild(listContainer);
                
                categories.forEach((cat, idx) => {
                    const li = document.createElement('li');
                    li.className = 'category-manage-list-item flex items-center bg-[#F8FAFC] dark:bg-[#0F172A] rounded-xl px-3 py-2 border border-[#E2E8F0] dark:border-[#334155] hover:border-[#3B82F6] dark:hover:border-[#3B82F6] transition-all';
                    li.dataset.index = idx;
                    li.dataset.id = `category-${idx}`;
                    
                    // 拖拽手柄
                    const dragHandle = document.createElement('div');
                    dragHandle.className = 'drag-handle text-[#64748B] dark:text-slate-400';
                    dragHandle.innerHTML = '<i class="fas fa-grip-vertical text-lg"></i>';
                    li.appendChild(dragHandle);
                    
                    const input = document.createElement('input');
                    input.className = 'flex-1 bg-transparent border-none outline-none text-[#1E293B] dark:text-slate-100';
                    input.value = cat;
                    input.readOnly = (cat === 'All');
                    li.appendChild(input);

                    if (cat !== 'All') {
                        const delBtn = document.createElement('button');
                        delBtn.className = 'ml-3 text-red-500 hover:text-red-700 transition-all hover:scale-110 p-1';
                        delBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        delBtn.title = '删除';
                        delBtn.onclick = (e) => {
                            e.stopPropagation();
                            categories.splice(idx, 1);
                            renderCategoryManageList();
                            updateCategorySidebar();
                        };
                        li.appendChild(delBtn);
                    }
                    
                    listContainer.appendChild(li);
                });
                
                // 使用Sortable.js初始化拖拽排序
                if (sortableInstance) {
                    sortableInstance.destroy();
                }
                
                const sortableContainer = categoryManageList.querySelector('.category-list-container');
                sortableInstance = new Sortable(sortableContainer, {
                    animation: 150,
                    handle: '.drag-handle',
                    ghostClass: 'sortable-ghost',
                    chosenClass: 'sortable-chosen',
                    dragClass: 'sortable-drag',
                    forceFallback: true, // 强制使用回退方案，在移动设备上表现更好
                    fallbackClass: 'category-item-dragging',
                    fallbackOnBody: true,
                    scroll: true, // 允许自动滚动
                    scrollSensitivity: 80, // 滚动敏感度
                    scrollSpeed: 15, // 滚动速度
                    onEnd: function(evt) {
                        // 获取新旧位置
                        const oldIndex = evt.oldIndex;
                        const newIndex = evt.newIndex;
                        
                        if (oldIndex !== newIndex) {
                            // 更新数据
                            const movedItem = categories.splice(oldIndex, 1)[0];
                            categories.splice(newIndex, 0, movedItem);
                            
                            // 触觉反馈
                            if (navigator.vibrate) {
                                navigator.vibrate(100);
                            }
                            
                            // 更新侧边栏
                            updateCategorySidebar();
                        }
                    }
                });
            }

            // 类别管理按钮点击事件处理函数
            function handleCategoryManageClick(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('类别管理按钮被点击 - 详细日志');
                
                // 重新获取模态框元素以确保最新状态
                const modal = document.getElementById('category-manage-modal');
                console.log('模态框元素:', modal);
                
                if (modal) {
                    renderCategoryManageList();
                    modal.classList.remove('hidden');
                    console.log('类别管理模态框已显示');
                    
                    // 添加模态框点击外部关闭功能
                    modal.addEventListener('click', function(event) {
                        if (event.target === modal) {
                            modal.classList.add('hidden');
                        }
                    });
                    
                    // 确保模态框在iPad上居中显示
                    setTimeout(() => {
                        const modalContent = modal.querySelector('.modal-content');
                        if (modalContent) {
                            modalContent.style.opacity = '1';
                            modalContent.style.transform = 'translateY(0)';
                        }
                    }, 10);
                } else {
                    console.error('类别管理模态框元素不存在');
                }
            }
            
            // 增强的事件委托系统
            function initCategoryManageEvents() {
                // 移除可能存在的旧事件监听器
                document.removeEventListener('click', globalCategoryManageHandler);
                document.removeEventListener('touchend', globalCategoryManageHandler);
                
                // 添加多种事件类型支持
                document.addEventListener('click', globalCategoryManageHandler, true);
                document.addEventListener('touchend', globalCategoryManageHandler, true);
                
                // 直接绑定到按钮元素（双重保险）
                const manageBtns = document.querySelectorAll('.category-manage-btn');
                console.log('找到类别管理按钮数量:', manageBtns.length);
                
                manageBtns.forEach(btn => {
                    // 移除可能存在的旧事件
                    btn.removeEventListener('click', handleCategoryManageClick);
                    btn.removeEventListener('touchend', handleCategoryManageClick);
                    
                    // 添加新事件
                    btn.addEventListener('click', handleCategoryManageClick, { passive: false });
                    btn.addEventListener('touchend', handleCategoryManageClick, { passive: false });
                    
                    // 添加直接的内联事件处理（三重保险）
                    btn.onclick = handleCategoryManageClick;
                    
                    console.log('已为按钮添加事件监听:', btn);
                });
                
                console.log('类别管理按钮事件系统初始化完成');
            }
            
            // 全局事件处理器（增强版）
            function globalCategoryManageHandler(e) {
                const manageBtn = e.target.closest('.category-manage-btn');
                if (manageBtn) {
                    console.log('通过事件委托检测到类别管理按钮点击');
                    handleCategoryManageClick(e);
                }
            }
            
            // 调试工具函数已移除，减少生产环境代码冗余
            
            // DOM加载完成后的初始化
            function initializeApp() {
                // 初始化类别管理事件系统
                initCategoryManageEvents();
                
                // 确保模态框关闭按钮事件正常工作
                const closeBtn = document.getElementById('category-manage-close');
                if (closeBtn) {
                    closeBtn.onclick = () => {
                        const modal = document.getElementById('category-manage-modal');
                        if (modal) {
                            modal.classList.add('hidden');
                        }
                    };
                }
                
                // 绑定类别添加按钮事件
                const addBtn = document.getElementById('category-add-btn');
                const newInput = document.getElementById('category-new-input');
                if (addBtn && newInput) {
                    addBtn.onclick = () => {
                        const val = newInput.value.trim();
                        if (val && !categories.includes(val)) {
                            categories.push(val);
                            newInput.value = '';
                            renderCategoryManageList();
                            updateCategorySidebar();
                        }
                    };
                }
                
                // 调试功能已移除，避免生产环境中的控制台输出
                
                console.log('应用初始化完成');
                
                // 添加全局测试函数（可在控制台调用）
                window.testCategoryManageButton = function() {
                    console.log('手动测试类别管理按钮...');
                    const btn = document.querySelector('.category-manage-btn');
                    if (btn) {
                        handleCategoryManageClick({ preventDefault: () => {}, stopPropagation: () => {} });
                    } else {
                        console.error('找不到类别管理按钮');
                    }
                };
                
                window.showCategoryModal = function() {
                    console.log('直接显示类别管理模态框...');
                    const modal = document.getElementById('category-manage-modal');
                    if (modal) {
                        renderCategoryManageList();
                        modal.classList.remove('hidden');
                        console.log('模态框已显示');
                    } else {
                        console.error('找不到类别管理模态框');
                    }
                };
            }
            
            // 如果DOM已加载完成，立即初始化；否则等待加载完成
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                initializeApp();
            }

            // 在页面加载完成后，延迟1秒执行测试函数
            setTimeout(function() {
                console.log('自动测试类别管理按钮点击事件...');
                const manageBtn = document.querySelector('.category-manage-btn');
                if (manageBtn) {
                    console.log('找到类别管理按钮:', manageBtn);
                    console.log('尝试触发点击事件...');
                    // 模拟点击
                    manageBtn.click();
                } else {
                    console.error('找不到类别管理按钮!');
                }
            }, 1000);

            // 事件绑定已在initializeApp函数中处理，避免重复绑定

            // 新建配方
            document.querySelector('.add-recipe-btn').addEventListener('click', () => {
                if (!addBtn.disabled) {
                    // 显示新建配方弹窗
                    document.getElementById('new-recipe-modal').classList.remove('hidden');
                }
            });
            
            // 关闭新建配方弹窗
            document.getElementById('new-recipe-close').addEventListener('click', () => {
                document.getElementById('new-recipe-modal').classList.add('hidden');
            });
            
            document.getElementById('new-recipe-cancel').addEventListener('click', () => {
                document.getElementById('new-recipe-modal').classList.add('hidden');
            });
            
            // 保存新建配方
            document.getElementById('new-recipe-save').addEventListener('click', () => {
                // 这里可以添加保存配方的逻辑
                alert('配方保存功能待实现');
                document.getElementById('new-recipe-modal').classList.add('hidden');
            });
            
            // 选项卡切换
            document.querySelectorAll('.tab-item-form').forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有选项卡的激活状态
                    document.querySelectorAll('.tab-item-form').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // 激活当前选项卡
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
            
            // 配方图片上传预览
            const imageUpload = document.querySelector('.image-upload');
            const imageRemove = document.querySelector('.image-remove');
            
            if(imageUpload && imageRemove) {
                imageUpload.addEventListener('click', () => {
                    // 模拟上传图片
                    if (!imageUpload.querySelector('.image-preview')) {
                        const img = document.createElement('img');
                        img.src = 'https://images.unsplash.com/photo-1608198093002-ad4e505484ba';
                        img.className = 'image-preview';
                        imageUpload.appendChild(img);
                        imageRemove.classList.remove('hidden');
                        imageUpload.querySelector('.image-upload-icon').style.display = 'none';
                        imageUpload.querySelector('.image-upload-text').style.display = 'none';
                    }
                });
                
                imageRemove.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const preview = imageUpload.querySelector('.image-preview');
                    if (preview) {
                        preview.remove();
                        imageRemove.classList.add('hidden');
                        imageUpload.querySelector('.image-upload-icon').style.display = 'block';
                        imageUpload.querySelector('.image-upload-text').style.display = 'block';
                    }
                });
            }

            // 配方类型卡片点击效果
            console.log('查找配方类型卡片...');
            const recipeTypeCards = document.querySelectorAll('.recipe-type-card');
            console.log('找到配方类型卡片数量:', recipeTypeCards.length);
            
            recipeTypeCards.forEach((card, index) => {
                console.log(`绑定点击事件到卡片 ${index+1}:`, card.querySelector('span:last-child').textContent);
                
                card.addEventListener('click', function() {
                    console.log('配方类型卡片被点击');
                    // 添加点击动画效果
                    this.classList.add('scale-95', 'border-[#3B82F6]');
                    
                    // 获取类型名称
                    const typeName = this.querySelector('span:last-child').textContent;
                    console.log('选择的配方类型:', typeName);
                    
                    // 延迟执行，让用户看到点击效果
                    setTimeout(() => {
                        document.getElementById('new-recipe-modal').classList.add('hidden');
                        
                        // 如果是面包类型，跳转到新建页面
                        if (typeName === '面包') {
                            console.log('面包类型被选择，准备跳转...');
                            window.location.href = encodeURI('xin jian ye.html');
                        } else {
                            alert('您选择了' + typeName + '配方类型，跳转到配方创建页面');
                            // 其他类型的跳转逻辑可以在这里添加
                        }
                    }, 200);
                });
            });

            // 配方卡片操作
            console.log('查找配方卡片...');
            const recipeCards = document.querySelectorAll('.recipe-card');
            const selectionToolbar = document.getElementById('selection-toolbar');
            const selectionCount = document.getElementById('selection-count');
            const selectionShare = document.getElementById('selection-share');
            const selectionDelete = document.getElementById('selection-delete');
            const selectionCancel = document.getElementById('selection-cancel');
            
            console.log('找到配方卡片数量:', recipeCards.length);
            
            // 为分享弹窗添加事件处理
            const shareModal = document.getElementById('share-modal');
            const shareCloseBtn = document.getElementById('share-close-btn');
            const shareDescription = document.getElementById('share-description');
            const socialPlatforms = document.querySelectorAll('.social-platform');
            
            // 关闭分享弹窗
            shareCloseBtn.addEventListener('click', function() {
                shareModal.classList.add('hidden');
            });
            
            // 点击空白区域关闭
            shareModal.addEventListener('click', function(e) {
                if (e.target === shareModal) {
                    shareModal.classList.add('hidden');
                }
            });
            
            // 社交平台点击事件
            socialPlatforms.forEach(platform => {
                platform.addEventListener('click', function() {
                    const platformName = this.getAttribute('data-platform');
                    handleShareToPlatform(platformName, currentShareTitle, currentBatchShare, currentBatchCount);
                });
            });
            
            // 左滑功能实现
            let initialX = 0;
            let currentX = 0;
            let isSelectionMode = false;
            let selectedCount = 0;
            // 不再重复声明longPressTimer
            const threshold = 50; // 滑动阈值
            
            function updateSelectionCount() {
                selectedCount = document.querySelectorAll('.recipe-checkbox.checked').length;
                selectionCount.textContent = `已选择 ${selectedCount} 项`;
            }
            
            function enterSelectionMode() {
                isSelectionMode = true;
                document.body.classList.add('selection-mode');
                selectionToolbar.classList.remove('hidden');
                
                // 添加类到配方列表
                document.querySelector('.recipe-list').classList.add('selection-mode');
                
                // 重置所有卡片状态
                recipeCards.forEach(card => {
                    card.classList.remove('swiped');
                });
            }
            
            function exitSelectionMode() {
                isSelectionMode = false;
                document.body.classList.remove('selection-mode');
                selectionToolbar.classList.add('hidden');
                
                // 移除类到配方列表
                document.querySelector('.recipe-list').classList.remove('selection-mode');
                
                // 重置所有选择状态
                document.querySelectorAll('.recipe-checkbox').forEach(checkbox => {
                    checkbox.classList.remove('checked');
                });
                
                selectedCount = 0;
                updateSelectionCount();
            }
            
            // 为每张卡片绑定手势和点击事件
            recipeCards.forEach((card, index) => {
                const cardContent = card.querySelector('.recipe-card-content');
                const checkbox = card.querySelector('.recipe-checkbox');
                const title = card.querySelector('.font-semibold').textContent;
                const category = card.querySelector('.category-badge').getAttribute('data-current');
                
                console.log(`绑定事件到卡片 ${index+1}: ${title} (${category})`);
                
                // 触摸事件 - 开始
                card.addEventListener('touchstart', function(e) {
                    initialX = e.touches[0].clientX;
                    currentX = initialX;
                    
                    // 设置长按定时器
                    longPressTimer = setTimeout(() => {
                        // 长按进入多选模式
                        if (!isSelectionMode) {
                            enterSelectionMode();
                            checkbox.classList.add('checked');
                            updateSelectionCount();
                        }
                        longPressTimer = null;
                    }, 600);
                });
                
                // 触摸事件 - 移动
                card.addEventListener('touchmove', function(e) {
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                    
                    if (isSelectionMode) return;
                    
                    currentX = e.touches[0].clientX;
                    const diffX = currentX - initialX;
                    
                    if (diffX < -threshold && !card.classList.contains('swiped')) {
                        card.classList.add('swiped');
                    } else if (diffX > threshold && card.classList.contains('swiped')) {
                        card.classList.remove('swiped');
                    }
                });
                
                // 触摸事件 - 结束
                card.addEventListener('touchend', function() {
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                });
                
                // 点击事件
                card.addEventListener('click', function(e) {
                    // 如果点击的是操作按钮，不做处理
                    if (e.target.closest('.recipe-card-action') || 
                        e.target.closest('.recipe-card-actions')) {
                        return;
                    }
                    
                    // 如果是多选模式
                    if (isSelectionMode) {
                        checkbox.classList.toggle('checked');
                        updateSelectionCount();
                        return;
                    }
                    
                    // 常规点击 - 查看配方详情
                    if (!card.classList.contains('swiped')) {
                        console.log('配方卡片被点击:', title);
                        
                        // 在iPad模式下，显示右侧详情面板
                        if (window.innerWidth >= 768) {
                            // 隐藏空状态
                            document.getElementById('empty-state').classList.add('hidden');
                            
                            // 显示详情内容
                            const detailContent = document.getElementById('recipe-detail-content');
                            detailContent.classList.remove('hidden');
                            
                            // 这里可以添加加载详情内容的逻辑
                            detailContent.innerHTML = `
                                <div class="p-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="text-2xl font-bold text-[#1E293B] dark:text-slate-100">${title}</h2>
                                        <span class="category-badge">${category}</span>
                                    </div>
                                    <img src="${card.querySelector('.recipe-image').src}" class="w-full h-48 object-cover rounded-xl mb-6" alt="${title}">
                                    <div class="space-y-4">
                                        <p class="text-[#64748B] dark:text-slate-400">这里是${title}的详细描述和配方内容...</p>
                                        <p class="text-[#64748B] dark:text-slate-400">点击左侧编辑按钮可以修改配方内容。</p>
                                    </div>
                                </div>
                            `;
                        } else {
                            // 移动端跳转到详情页
                            alert('查看配方详情: ' + title);
                        }
                    }
                });
                
                // 绑定操作按钮事件
                const shareBtn = card.querySelector('.action-share');
                const editBtn = card.querySelector('.action-edit');
                const deleteBtn = card.querySelector('.action-delete');
                
                shareBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showShareOptions(title);
                    card.classList.remove('swiped');
            });
                
                editBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    alert(`编辑配方：${title}`);
                    card.classList.remove('swiped');
                });
                
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (confirm(`确定要删除配方"${title}"吗？`)) {
                        alert(`已删除配方：${title}`);
                    }
                    card.classList.remove('swiped');
                });
            });
            
            // 批量操作按钮
            selectionShare.addEventListener('click', function() {
                const selectedItems = document.querySelectorAll('.recipe-checkbox.checked');
                const titles = Array.from(selectedItems).map(checkbox => 
                    checkbox.closest('.recipe-card').querySelector('.font-semibold').textContent
                );
                showBatchShareOptions(titles, selectedCount);
            });
            
            selectionDelete.addEventListener('click', function() {
                const selectedItems = document.querySelectorAll('.recipe-checkbox.checked');
                if (selectedItems.length > 0 && confirm(`确定要删除 ${selectedCount} 个所选配方吗？`)) {
                    alert(`已删除 ${selectedCount} 个配方`);
                    exitSelectionMode();
                }
            });
            
            selectionCancel.addEventListener('click', exitSelectionMode);
            
            // 分享功能实现
            function showShareOptions(title) {
                currentShareTitle = title;
                currentBatchShare = false;
                shareDescription.textContent = `分享「${title}」到：`;
                shareModal.classList.remove('hidden');
            }
            
            function showBatchShareOptions(titles, count) {
                currentBatchShare = true;
                currentBatchCount = count;
                currentBatchTitles = titles;
                shareDescription.textContent = `分享 ${count} 个配方到：`;
                shareModal.classList.remove('hidden');
            }
            
            function handleShareToPlatform(platform, title, isBatch, count) {
                shareModal.classList.add('hidden');
                
                let message = '';
                const appName = '烘焙助手';
                
                if (isBatch) {
                    switch(platform) {
                        case 'wechat':
                            message = `已准备分享 ${count} 个配方到微信`;
                            break;
                        case 'xiaoHongShu':
                            message = `已准备分享 ${count} 个精品配方到小红书，让更多人看到您的烘焙作品！`;
                            break;
                        case 'douyin':
                            message = `已准备分享 ${count} 个配方到抖音，与粉丝分享您的烘焙技巧！`;
                            break;
                        case 'weibo':
                            message = `已准备分享 ${count} 个配方到微博`;
                            break;
                        case 'qq':
                            message = `已准备分享 ${count} 个配方到QQ`;
                            break;
                        case 'bilibili':
                            message = `已准备分享 ${count} 个配方到哔哩哔哩，制作精美教程视频吧！`;
                            break;
                        case 'link':
                            // 模拟复制链接
                            copyToClipboard(`${count}个配方的批量分享链接 - ${appName}`);
                            message = `${count} 个配方的链接已复制到剪贴板！`;
                            break;
                        case 'more':
                            message = `打开更多分享选项...`;
                            break;
                    }
                } else {
                    switch(platform) {
                        case 'wechat':
                            message = `已准备分享「${title}」配方到微信`;
                            break;
                        case 'xiaoHongShu':
                            message = `已准备将「${title}」配方分享到小红书，快去发布您的成品照片吧！`;
                            break;
                        case 'douyin':
                            message = `已准备将「${title}」配方分享到抖音，拍摄制作过程视频吧！`;
                            break;
                        case 'weibo':
                            message = `已准备分享「${title}」配方到微博`;
                            break;
                        case 'qq':
                            message = `已准备分享「${title}」配方到QQ`;
                            break;
                        case 'bilibili':
                            message = `已准备分享「${title}」配方到哔哩哔哩，分享您的制作教程吧！`;
                            break;
                        case 'link':
                            // 模拟复制链接
                            copyToClipboard(`${title}配方分享 - ${appName}`);
                            message = `「${title}」配方链接已复制到剪贴板！`;
                            break;
                        case 'more':
                            message = `打开更多分享选项...`;
                            break;
                    }
                }
                
                if (message) {
                    showNotification(message);
                }
                
                // 退出多选模式（如果是批量分享）
                if (isBatch) {
                    exitSelectionMode();
                }
            }
            
            function shareToAppStore() {
                shareModal.classList.add('hidden');
                showNotification('感谢您的支持！正在跳转到应用商店...');
            }
            
            function copyToClipboard(text) {
                // 创建临时元素
                const input = document.createElement('textarea');
                input.value = text;
                document.body.appendChild(input);
                
                // 选择并复制文本
                input.select();
                document.execCommand('copy');
                
                // 移除临时元素
                document.body.removeChild(input);
            }
            
            function showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-80 text-white px-4 py-3 rounded-xl z-50';
                notification.style.minWidth = '250px';
                notification.style.maxWidth = '80%';
                notification.style.textAlign = 'center';
                notification.innerHTML = message;
                
                document.body.appendChild(notification);
                
                // 添加进入动画
                notification.animate([
                    { transform: 'translate(-50%, 20px)', opacity: 0 },
                    { transform: 'translate(-50%, 0)', opacity: 1 }
                ], {
                    duration: 300,
                    easing: 'ease-out',
                    fill: 'forwards'
                });
                
                // 自动消失
                setTimeout(() => {
                    notification.animate([
                        { transform: 'translate(-50%, 0)', opacity: 1 },
                        { transform: 'translate(-50%, -20px)', opacity: 0 }
                    ], {
                        duration: 300,
                        easing: 'ease-in',
                        fill: 'forwards'
                    });
                    
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // 在页面加载完成后，初始化筛选功能
            setTimeout(function() {
                // 初始化筛选，显示所有配方
                filterRecipesByCategory('All');
                
                // 设置类别管理模态框的关闭按钮事件
                const closeBtn = document.getElementById('category-manage-close');
                if (closeBtn) {
                    closeBtn.onclick = function() {
                        const modal = document.getElementById('category-manage-modal');
                        if (modal) {
                            modal.classList.add('hidden');
                        }
                    };
                }
                
                // 加载Sortable.js库
                if (typeof Sortable === 'undefined') {
                    console.log('加载Sortable.js库...');
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js';
                    script.onload = function() {
                        console.log('Sortable.js库加载完成');
                    };
                    document.head.appendChild(script);
                }
            }, 500);
        });

        // 新建配方类型选择弹窗
        function showRecipeTypeModal() {
            // 直接跳转到面包新建页面，不显示类型选择弹窗
            selectRecipeType('bread');
        }
        
        function closeRecipeTypeModal() {
            document.getElementById('recipe-type-modal').classList.add('hidden');
        }
        
        // 修改selectRecipeType函数，显示面板切换按钮
        function selectRecipeType(type) {
            // 根据类型执行不同操作
            let url = '';
            
            if (type === 'bread') {
                url = '../mianbaoxinjian/mianbaoxinjianye.html';
            } else if (type === 'cake') {
                url = '../../dangao/dangaoxinjianye.html';
            } else if (type === 'cookie') {
                url = '../mianbaoxinjian/mianbaoxinjianye.html'; // 暂时使用面包新建页面
            } else if (type === 'filling') {
                url = '../mianbaoxinjian/mianbaoxinjianye.html'; // 暂时使用面包新建页面
            } else if (type === 'western') {
                url = '../mianbaoxinjian/mianbaoxinjianye.html'; // 暂时使用面包新建页面
            } else if (type === 'beverage') {
                url = '../mianbaoxinjian/mianbaoxinjianye.html'; // 暂时使用面包新建页面
            } else {
                // 默认使用面包新建页
                url = '../mianbaoxinjian/mianbaoxinjianye.html';
            }
            
            // 关闭类型选择弹窗
            closeRecipeTypeModal();
            
            // 在iPad竖屏模式下，使用iframe嵌入新建页面
            if (window.innerWidth >= 768) {
                // 创建新建配方的iframe容器
                const mainContainer = document.querySelector('.main-container');
                const leftPanel = document.querySelector('.left-panel');
                
                // 保存当前左侧面板宽度和样式，用于后续恢复
                // 保存当前计算样式值，确保能够正确恢复
                const computedStyle = window.getComputedStyle(leftPanel);
                const originalLeftPanelWidth = leftPanel.style.width || '';
                const originalLeftPanelStyle = computedStyle.width;
                
                // 创建iframe容器
                const iframeContainer = document.createElement('div');
                iframeContainer.id = 'new-recipe-iframe-container';
                iframeContainer.className = 'fixed top-[70px] bottom-0 bg-white dark:bg-[#0F172A] z-40 shadow-xl transition-all duration-300';
                
                // 添加自定义属性，存储原始左侧面板宽度，以便恢复时使用
                iframeContainer.dataset.originalPanelWidth = originalLeftPanelWidth || '';
                iframeContainer.dataset.originalComputedWidth = originalLeftPanelStyle || '';
                
                // 设置iframe容器宽度，确保左侧面板有最小宽度
                iframeContainer.style.width = 'calc(100% - 180px)';
                iframeContainer.style.right = '0';
                
                // 添加iPad专用样式
                if (window.innerWidth >= 768) {
                    iframeContainer.style.maxWidth = 'none';
                    iframeContainer.style.boxShadow = 'none'; // 移除阴影，使界面更加无缝
                    iframeContainer.style.left = 'auto'; // 不固定左侧位置
                    iframeContainer.style.right = '0'; // 固定右侧位置
                    iframeContainer.style.borderLeft = '1px solid #E2E8F0'; // 添加左边框
                    
                    // 调整左侧面板的右边框
                    leftPanel.style.borderRight = 'none'; // 移除右边框
                    leftPanel.style.marginRight = '0'; // 移除右边距
                    leftPanel.style.paddingRight = '0'; // 移除右内边距
                    
                    // 添加返回按钮到左侧面板顶部，并增强可见性和可点击性
                    const backBtn = document.createElement('button');
                    backBtn.className = 'return-btn';
                    backBtn.innerHTML = '<i class="fas fa-arrow-left text-xl"></i>';
                    backBtn.style.width = '50px';
                    backBtn.style.height = '50px';
                    backBtn.style.display = 'flex';
                    backBtn.style.alignItems = 'center';
                    backBtn.style.justifyContent = 'center';
                    
                    // 添加返回按钮的点击事件，确保能正确关闭iframe
                    backBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('返回按钮被点击');
                        
                        // 获取存储在iframe容器上的原始宽度值
                        const storedOriginalWidth = iframeContainer.dataset.originalPanelWidth;
                        const storedComputedWidth = iframeContainer.dataset.originalComputedWidth;
                        
                        try {
                            // 移除iframe容器
                            if (document.body.contains(iframeContainer)) {
                                document.body.removeChild(iframeContainer);
                                console.log('iframe容器已移除');
                            } else {
                                console.log('找不到iframe容器');
                            }
                            
                            // 恢复左侧面板宽度到原始状态
                            if (storedOriginalWidth) {
                                leftPanel.style.width = storedOriginalWidth;
                            } else {
                                leftPanel.style.width = storedComputedWidth || '40%';
                            }
                            console.log('左侧面板宽度已恢复');
                            
                            // 移除返回按钮
                            if (document.body.contains(backBtn)) {
                                document.body.removeChild(backBtn);
                                console.log('返回按钮已移除');
                            } else {
                                console.log('找不到返回按钮');
                            }
                        } catch (err) {
                            console.error('返回操作出错:', err);
                            
                            // 强制恢复布局
                            leftPanel.style.width = '40%';
                            
                            // 尝试移除所有可能的残留元素
                            const container = document.getElementById('new-recipe-iframe-container');
                            if (container) document.body.removeChild(container);
                            
                            // 刷新页面作为最后的解决方案
                            if (confirm('返回操作出现问题，是否刷新页面？')) {
                                window.location.reload();
                            }
                        }
                    };
                    
                    // 确保按钮被添加到DOM中
                    document.body.appendChild(backBtn);
                    console.log('返回按钮已添加到页面');
                }
                
                // 创建iframe
                const iframe = document.createElement('iframe');
                iframe.id = 'new-recipe-iframe';
                iframe.src = url;
                iframe.className = 'w-full h-full border-none';
                
                // 添加iframe加载完成后的处理，调整输入框宽度并添加返回按钮
                iframe.onload = function() {
                    try {
                        // 尝试访问iframe内容并调整输入框宽度
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const inputs = iframeDoc.querySelectorAll('input[type="text"], input[type="number"], select, textarea');
                        
                        inputs.forEach(input => {
                            // 增加输入框宽度三分之一
                            input.style.width = 'calc(100% * 1.33)';
                            input.style.maxWidth = 'calc(100% * 1.33)';
                            
                            // 调整输入框容器
                            const formGroup = input.closest('.form-group') || input.parentElement;
                            if (formGroup) {
                                formGroup.style.overflow = 'visible';
                                formGroup.style.position = 'relative';
                            }
                        });
                        
                        // 在iframe内部添加返回按钮
                        try {
                            // 检查iframe内是否有返回按钮
                            const existingBackBtn = iframeDoc.querySelector('.back-button');
                            if (existingBackBtn) {
                                // 修改iframe内部的返回按钮事件，确保能正确返回
                                existingBackBtn.addEventListener('click', function(e) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    
                                    // 触发外部返回按钮的点击事件
                                    const outerBackBtn = document.querySelector('.return-btn');
                                    if (outerBackBtn) {
                                        outerBackBtn.click();
                                    } else {
                                        // 如果找不到外部返回按钮，则直接移除iframe容器
                                        const container = document.getElementById('new-recipe-iframe-container');
                                        if (container) document.body.removeChild(container);
                                        
                                        // 恢复左侧面板宽度
                                        leftPanel.style.width = '40%';
                                    }
                                });
                                console.log('已修改iframe内部返回按钮事件');
                            }
                        } catch (err) {
                            console.error('修改iframe内部返回按钮失败:', err);
                        }
                    } catch (e) {
                        console.log('无法访问iframe内容:', e);
                    }
                };
                
                // 变量已在上方声明，这里不需要重复声明
                
                // 创建关闭按钮（在iframe内部右上角）
                const closeBtn = document.createElement('button');
                closeBtn.className = 'close-btn';
                closeBtn.style.display = 'block'; // 显示关闭按钮，增强可用性
                closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                closeBtn.style.width = '40px';
                closeBtn.style.height = '40px';
                closeBtn.style.display = 'flex';
                closeBtn.style.alignItems = 'center';
                closeBtn.style.justifyContent = 'center';
                
                // 增强关闭按钮的点击事件
                closeBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('关闭按钮被点击');
                    
                    try {
                        // 获取存储在iframe容器上的原始宽度值
                        const storedOriginalWidth = iframeContainer.dataset.originalPanelWidth;
                        const storedComputedWidth = iframeContainer.dataset.originalComputedWidth;
                        
                        // 移除iframe容器
                        if (document.body.contains(iframeContainer)) {
                            document.body.removeChild(iframeContainer);
                            console.log('iframe容器已移除');
                        }
                        
                        // 恢复左侧面板宽度到原始状态
                        if (storedOriginalWidth) {
                            leftPanel.style.width = storedOriginalWidth;
                        } else {
                            // 如果没有内联样式，则恢复到计算样式或默认值
                            leftPanel.style.width = storedComputedWidth || '40%';
                        }
                        
                        console.log('恢复左侧面板宽度到:', leftPanel.style.width, '原始值:', storedOriginalWidth, '计算值:', storedComputedWidth);
                        
                        // 移除可能存在的返回按钮
                        const backBtn = document.querySelector('.return-btn');
                        if (backBtn && document.body.contains(backBtn)) {
                            document.body.removeChild(backBtn);
                            console.log('返回按钮已移除');
                        }
                    } catch (err) {
                        console.error('关闭操作出错:', err);
                        
                        // 强制恢复布局
                        leftPanel.style.width = '40%';
                        
                        // 尝试移除所有可能的残留元素
                        const container = document.getElementById('new-recipe-iframe-container');
                        if (container) document.body.removeChild(container);
                        
                        // 刷新页面作为最后的解决方案
                        if (confirm('关闭操作出现问题，是否刷新页面？')) {
                            window.location.reload();
                        }
                    }
                };
                
                // 添加到iframe容器
                iframeContainer.appendChild(iframe);
                iframeContainer.appendChild(closeBtn);
                
                // 添加到body
                document.body.appendChild(iframeContainer);
                
                // 调整左侧面板宽度，保证配方列表最小宽度可见
                leftPanel.style.width = '25%';
                leftPanel.style.minWidth = '180px'; // 确保左侧面板有最小宽度
                
                // 添加恢复按钮点击事件的日志
                console.log('保存原始左侧面板宽度:', originalLeftPanelWidth, '计算样式宽度:', originalLeftPanelStyle);
                
                console.log('已选择配方类型:', type, '在iframe中打开:', url);
            } else {
                // 移动端直接跳转
                window.location.href = url;
                console.log('已选择配方类型:', type, '跳转到:', url);
            }
        }
        
        // 初始化时，为"创建新配方"按钮添加点击事件
        document.addEventListener('DOMContentLoaded', function() {
            const createNewBtn = document.getElementById('create-new-btn');
            if (createNewBtn) {
                createNewBtn.addEventListener('click', function() {
                    showRecipeTypeModal();
                });
            }
        });
        
        // 点击配方卡片显示详情
        document.querySelectorAll('.recipe-card').forEach(card => {
            card.addEventListener('click', function(e) {
                // 如果点击的是操作按钮，不做处理
                if (e.target.closest('.recipe-card-action') || 
                    e.target.closest('.recipe-card-actions')) {
                    return;
                }
                
                // 如果是多选模式
                if (document.body.classList.contains('selection-mode')) {
                    const checkbox = this.querySelector('.recipe-checkbox');
                    checkbox.classList.toggle('checked');
                    updateSelectionCount();
                    return;
                }
                
                // 常规点击 - 查看配方详情
                if (!this.classList.contains('swiped')) {
                    const title = this.querySelector('.font-semibold').textContent;
                    const category = this.querySelector('.category-badge').dataset.current;
                    const imageSrc = this.querySelector('.recipe-image').src;
                    
                    // 在iPad模式下，使用与新建配方相同的布局显示详情
                    if (window.innerWidth >= 768) {
                        // 保存当前左侧面板宽度和样式，用于后续恢复
                        const leftPanel = document.querySelector('.left-panel');
                        const computedStyle = window.getComputedStyle(leftPanel);
                        const originalLeftPanelWidth = leftPanel.style.width || '';
                        const originalLeftPanelStyle = computedStyle.width;
                        
                        // 创建详情iframe容器
                        const iframeContainer = document.createElement('div');
                        iframeContainer.id = 'recipe-detail-iframe-container';
                        iframeContainer.className = 'fixed top-[70px] bottom-0 bg-white dark:bg-[#0F172A] z-40 shadow-xl transition-all duration-300';
                        
                        // 添加自定义属性，存储原始左侧面板宽度，以便恢复时使用
                        iframeContainer.dataset.originalPanelWidth = originalLeftPanelWidth || '';
                        iframeContainer.dataset.originalComputedWidth = originalLeftPanelStyle || '';
                        
                        // 设置iframe容器宽度为屏幕宽度的75%，与新建配方页面一致
                        iframeContainer.style.width = '75%';
                        iframeContainer.style.right = '0';
                        
                        // 添加iPad专用样式
                        if (window.innerWidth >= 768) {
                            iframeContainer.style.maxWidth = 'none';
                            iframeContainer.style.boxShadow = 'none';
                            iframeContainer.style.left = '25%';
                            iframeContainer.style.borderLeft = '1px solid #E2E8F0';
                            
                            // 调整左侧面板的右边框
                            leftPanel.style.borderRight = 'none';
                            leftPanel.style.marginRight = '0';
                            leftPanel.style.paddingRight = '0';
                            
                            // 添加返回按钮
                            const backBtn = document.createElement('button');
                            backBtn.className = 'return-btn';
                            backBtn.innerHTML = '<i class="fas fa-arrow-left text-xl"></i>';
                            
                            // 添加返回按钮的点击事件
                            backBtn.onclick = function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                console.log('详情页返回按钮被点击');
                                
                                try {
                                    // 移除iframe容器
                                    if (document.body.contains(iframeContainer)) {
                                        document.body.removeChild(iframeContainer);
                                        console.log('详情iframe容器已移除');
                                    }
                                    
                                    // 恢复左侧面板宽度到原始状态
                                    if (originalLeftPanelWidth) {
                                        leftPanel.style.width = originalLeftPanelWidth;
                                    } else {
                                        leftPanel.style.width = originalLeftPanelStyle || '40%';
                                    }
                                    console.log('左侧面板宽度已恢复');
                                    
                                    // 移除返回按钮
                                    if (document.body.contains(backBtn)) {
                                        document.body.removeChild(backBtn);
                                    }
                                } catch (err) {
                                    console.error('返回操作出错:', err);
                                    leftPanel.style.width = '40%';
                                    
                                    // 刷新页面作为最后的解决方案
                                    if (confirm('返回操作出现问题，是否刷新页面？')) {
                                        window.location.reload();
                                    }
                                }
                            };
                            
                            document.body.appendChild(backBtn);
                        }
                        
                        // 创建详情内容容器
                        const detailContent = document.createElement('div');
                        detailContent.className = 'w-full h-full overflow-y-auto p-6 bg-white dark:bg-[#0F172A]';
                        
                        // 添加详情内容
                        detailContent.innerHTML = `
                            <div class="max-w-4xl mx-auto">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-3xl font-bold text-[#1E293B] dark:text-slate-100">${title}</h2>
                                    <span class="px-4 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full font-medium">${category}</span>
                                </div>
                                <img src="${imageSrc}" class="w-full h-64 object-cover rounded-xl mb-8 shadow-md" alt="${title}">
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                    <div>
                                        <h3 class="text-xl font-semibold mb-4 text-[#1E293B] dark:text-slate-100">配方信息</h3>
                                        <div class="space-y-4">
                                            <div class="flex justify-between border-b border-gray-100 dark:border-gray-800 pb-2">
                                                <span class="text-gray-600 dark:text-gray-400">难度</span>
                                                <span class="font-medium text-[#1E293B] dark:text-slate-100">中等</span>
                                            </div>
                                            <div class="flex justify-between border-b border-gray-100 dark:border-gray-800 pb-2">
                                                <span class="text-gray-600 dark:text-gray-400">准备时间</span>
                                                <span class="font-medium text-[#1E293B] dark:text-slate-100">30分钟</span>
                                            </div>
                                            <div class="flex justify-between border-b border-gray-100 dark:border-gray-800 pb-2">
                                                <span class="text-gray-600 dark:text-gray-400">烘焙时间</span>
                                                <span class="font-medium text-[#1E293B] dark:text-slate-100">45分钟</span>
                                            </div>
                                            <div class="flex justify-between border-b border-gray-100 dark:border-gray-800 pb-2">
                                                <span class="text-gray-600 dark:text-gray-400">总时间</span>
                                                <span class="font-medium text-[#1E293B] dark:text-slate-100">1小时15分钟</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600 dark:text-gray-400">产量</span>
                                                <span class="font-medium text-[#1E293B] dark:text-slate-100">1个${title}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h3 class="text-xl font-semibold mb-4 text-[#1E293B] dark:text-slate-100">描述</h3>
                                        <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
                                            这是一款经典的${title}配方，口感松软，香气四溢。适合各种场合享用，无论是早餐还是下午茶都是绝佳选择。
                                            制作过程简单易上手，即使是烘焙新手也能轻松完成。
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="mb-8">
                                    <h3 class="text-xl font-semibold mb-4 text-[#1E293B] dark:text-slate-100">配料</h3>
                                    <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                                        <table class="w-full">
                                            <thead>
                                                <tr class="border-b border-gray-200 dark:border-gray-800">
                                                    <th class="text-left py-2 text-gray-600 dark:text-gray-400 font-medium">材料</th>
                                                    <th class="text-right py-2 text-gray-600 dark:text-gray-400 font-medium">重量</th>
                                                    <th class="text-right py-2 text-gray-600 dark:text-gray-400 font-medium">百分比</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-b border-gray-200 dark:border-gray-800">
                                                    <td class="py-2 text-[#1E293B] dark:text-slate-100">高筋面粉</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">500g</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">100%</td>
                                                </tr>
                                                <tr class="border-b border-gray-200 dark:border-gray-800">
                                                    <td class="py-2 text-[#1E293B] dark:text-slate-100">水</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">325g</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">65%</td>
                                                </tr>
                                                <tr class="border-b border-gray-200 dark:border-gray-800">
                                                    <td class="py-2 text-[#1E293B] dark:text-slate-100">盐</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">10g</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">2%</td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 text-[#1E293B] dark:text-slate-100">酵母</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">5g</td>
                                                    <td class="py-2 text-right text-[#1E293B] dark:text-slate-100">1%</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 class="text-xl font-semibold mb-4 text-[#1E293B] dark:text-slate-100">步骤</h3>
                                    <div class="space-y-4">
                                        <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                                            <div class="flex items-center mb-2">
                                                <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mr-3">1</div>
                                                <h4 class="font-medium text-[#1E293B] dark:text-slate-100">准备材料</h4>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400 ml-11">称量所有材料，确保准确无误。</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                                            <div class="flex items-center mb-2">
                                                <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mr-3">2</div>
                                                <h4 class="font-medium text-[#1E293B] dark:text-slate-100">混合面团</h4>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400 ml-11">将所有材料混合，揉至光滑有弹性。</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                                            <div class="flex items-center mb-2">
                                                <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mr-3">3</div>
                                                <h4 class="font-medium text-[#1E293B] dark:text-slate-100">发酵</h4>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400 ml-11">室温发酵1小时，或至面团体积翻倍。</p>
                                        </div>
                                        
                                        <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4">
                                            <div class="flex items-center mb-2">
                                                <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold mr-3">4</div>
                                                <h4 class="font-medium text-[#1E293B] dark:text-slate-100">烘焙</h4>
                                            </div>
                                            <p class="text-gray-600 dark:text-gray-400 ml-11">预热烤箱至180°C，烘焙45分钟至金黄色。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // 创建关闭按钮
                        const closeBtn = document.createElement('button');
                        closeBtn.className = 'close-btn';
                        closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                        
                        // 关闭按钮点击事件
                        closeBtn.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            console.log('详情页关闭按钮被点击');
                            
                            try {
                                // 移除iframe容器
                                if (document.body.contains(iframeContainer)) {
                                    document.body.removeChild(iframeContainer);
                                }
                                
                                // 恢复左侧面板宽度到原始状态
                                if (originalLeftPanelWidth) {
                                    leftPanel.style.width = originalLeftPanelWidth;
                                } else {
                                    leftPanel.style.width = originalLeftPanelStyle || '40%';
                                }
                                
                                // 移除返回按钮
                                const backBtn = document.querySelector('.return-btn');
                                if (backBtn && document.body.contains(backBtn)) {
                                    document.body.removeChild(backBtn);
                                }
                            } catch (err) {
                                console.error('关闭操作出错:', err);
                                leftPanel.style.width = '40%';
                                
                                if (confirm('关闭操作出现问题，是否刷新页面？')) {
                                    window.location.reload();
                                }
                            }
                        };
                        
                        // 将详情内容添加到iframe容器
                        iframeContainer.appendChild(detailContent);
                        iframeContainer.appendChild(closeBtn);
                        
                        // 添加到body
                        document.body.appendChild(iframeContainer);
                        
                        // 调整左侧面板宽度，与新建配方页面一致
                        leftPanel.style.width = '25%';
                        
                    } else {
                        // 移动端跳转到详情页
                        alert('查看配方详情: ' + title);
                    }
                }
            });
        });
        
        // 恢复默认布局（当右侧内容关闭时）- 已弃用，使用新的详情显示方式
        function resetLayout() {
            // 显示空状态
            const emptyState = document.getElementById('empty-state');
            if (emptyState) emptyState.classList.remove('hidden');
            
            // 隐藏详情内容和新建表单
            const detailContent = document.getElementById('recipe-detail-content');
            if (detailContent) detailContent.classList.add('hidden');
            
            const newRecipeForm = document.getElementById('new-recipe-form');
            if (newRecipeForm) newRecipeForm.classList.add('hidden');
            
            // 检查并移除可能存在的详情iframe容器
            const detailContainer = document.getElementById('recipe-detail-iframe-container');
            if (detailContainer && document.body.contains(detailContainer)) {
                document.body.removeChild(detailContainer);
            }
            
            // 恢复左侧面板宽度
            const leftPanel = document.querySelector('.left-panel');
            if (leftPanel) {
                leftPanel.style.width = '40%';
            }
            
            // 移除可能存在的返回按钮
            const backBtn = document.querySelector('.return-btn');
            if (backBtn && document.body.contains(backBtn)) {
                document.body.removeChild(backBtn);
            }
        }
        
        // 添加关闭按钮到详情页和新建表单
        document.addEventListener('DOMContentLoaded', function() {
            // 为详情内容添加关闭按钮
            const detailContent = document.getElementById('recipe-detail-content');
            if (detailContent) {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'absolute top-4 right-4 bg-white dark:bg-[#1E293B] rounded-full p-2 shadow-md text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 transition-all';
                closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                closeBtn.onclick = resetLayout;
                detailContent.style.position = 'relative';
                detailContent.appendChild(closeBtn);
            }
            
            // 为新建表单添加关闭按钮
            const newRecipeForm = document.getElementById('new-recipe-form');
            if (newRecipeForm) {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'absolute top-4 right-4 bg-white dark:bg-[#1E293B] rounded-full p-2 shadow-md text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 transition-all z-10';
                closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                closeBtn.onclick = resetLayout;
                newRecipeForm.style.position = 'relative';
                newRecipeForm.appendChild(closeBtn);
            }
            
            // 移除面板切换按钮功能
        });
    </script>
</body>
</html>