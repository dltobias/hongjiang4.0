<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新建配方 - 烘焙助手 (PC版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css" rel="stylesheet">
    <style>
        /* 强制刷新暗黑模式的辅助类 */
        .dark-force-refresh {}
        .dark-handle {}
        
        /* 主题基础变量 */
        :root {
            /* Light Theme */
            --light-bg: #F8FAFC;
            --light-card-bg: #FFFFFF;
            --light-text: #1E293B;
            --light-border: #E2E8F0;
            --light-hover: #EFF6FF;
            
            /* Dark Theme */
            --dark-bg: #0F172A;
            --dark-card-bg: #1E293B;
            --dark-text: #F1F5F9;
            --dark-border: #334155;
            --dark-hover: #1E3A8A;
            
            /* Japanese Theme */
            --jp-bg: #F7F6F2;
            --jp-card-bg: #FFFCF7;
            --jp-text: #2C2C2C;
            --jp-border: #E5E2D9;
            --jp-accent: #D64F45;
            --jp-hover: #FFF1EC;
            
            /* Korean Theme */
            --kr-bg: #F3F7F6;
            --kr-card-bg: #FFFFFF;
            --kr-text: #363B3A;
            --kr-border: #DDE7E5;
            --kr-accent: #98C6BE;
            --kr-hover: #E8F3F1;
        }

        /* 主题切换器样式 */
        .theme-switcher {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            border-radius: 1rem;
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border: 1px solid var(--light-border);
        }

        .theme-option {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.active {
            box-shadow: 0 0 0 2px var(--light-border);
        }

        /* Light Theme */
        .theme-light {
            background: var(--light-bg);
            color: var(--light-text);
        }

        .theme-light .card {
            background: var(--light-card-bg);
            border-color: var(--light-border);
        }

        /* Dark Theme */
        .theme-dark {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        .theme-dark .card {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        /* Japanese Theme */
        .theme-jp {
            background: var(--jp-bg);
            color: var(--jp-text);
        }

        .theme-jp .card {
            background: var(--jp-card-bg);
            border-color: var(--jp-border);
        }

        .theme-jp .btn-primary {
            background: var(--jp-accent);
        }

        /* Korean Theme */
        .theme-kr {
            background: var(--kr-bg);
            color: var(--kr-text);
        }

        .theme-kr .card {
            background: var(--kr-card-bg);
            border-color: var(--kr-border);
        }

        .theme-kr .btn-primary {
            background: var(--kr-accent);
        }

        /* 基础主题样式 */
        html, body { 
            background: #F8FAFC; 
            transition: all 0.3s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .dark html, .dark body { 
            background: #0F172A; 
        }
        
        /* 卡片样式 - 调整圆角 */
        .card { 
            border-radius: 12px; 
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08); 
            background: #FFFFFF; 
            border: 1px solid #E2E8F0; 
            transition: all 0.3s ease;
        }
        .dark .card { 
            background: #1E293B; 
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25); 
            border: 1px solid #334155; 
        }

        /* 主题切换按钮 */
        .theme-switch {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 0.75rem;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dark .theme-switch {
            background: #334155;
            border-color: #475569;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .theme-switch:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .dark .theme-switch:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        /* 文本颜色 */
        .text-primary {
            color: #1E293B;
            transition: color 0.3s ease;
        }
        .dark .text-primary {
            color: #F1F5F9;
        }
        
        /* 输入框样式 - 调整圆角 */
        input, textarea, select {
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .dark input, .dark textarea, .dark select {
            background: #1E293B;
            color: #F1F5F9;
            border-color: #475569;
        }
        
        /* 按钮样式 - 调整圆角 */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB, #1D4ED8);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
        }
        
        .btn-secondary {
            background: #F1F5F9;
            color: #64748B;
            border: 1px solid #E2E8F0;
        }
        
        .dark .btn-secondary {
            background: #334155;
            color: #CBD5E1;
            border-color: #475569;
        }
        
        .btn-secondary:hover {
            background: #E2E8F0;
            color: #475569;
            transform: translateY(-1px);
        }
        
        .dark .btn-secondary:hover {
            background: #475569;
            color: #F1F5F9;
        }
        
        /* 应用容器 */
        .app-container {
            display: flex;
            min-height: 100vh;
            background: #F8FAFC;
        }
        .dark .app-container {
            background: #0F172A;
        }
        
        /* 主导航栏 */
        .main-nav {
            width: 80px;
            background: #1E293B;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 10;
        }
        .dark .main-nav {
            background: #0F172A;
            border-right: 1px solid #334155;
        }
        
        .nav-item {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748B;
            text-decoration: none;
            position: relative;
        }
        
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3B82F6;
            transform: scale(1.05);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 32px;
            background: #3B82F6;
            border-radius: 2px;
        }
        
        .nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        .nav-item span {
            font-size: 0.625rem;
            font-weight: 500;
            text-align: center;
            line-height: 1;
        }
        
        /* PC端布局 */
        .main-container {
            flex: 1;
            max-width: calc(100vw - 80px);
            min-height: 100vh;
            display: flex;
            background: #F8FAFC;
            padding: 2rem;
            gap: 2rem;
            margin-left: 80px;
        }
        .dark .main-container {
            background: #0F172A;
        }
        
        /* 左侧边栏 */
        .sidebar {
            width: 280px;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
            border: 1px solid #E2E8F0;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }
        .dark .sidebar {
            background: #1E293B;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
            border: 1px solid #334155;
        }
        
        /* 主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        /* Tab切换样式 */
        .tab-container {
            background: white;
            border-radius: 12px;
            padding: 0.5rem;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
            border: 1px solid #E2E8F0;
            display: flex;
            gap: 0.5rem;
        }
        .dark .tab-container {
            background: #1E293B;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
            border: 1px solid #334155;
        }
        
        .tab-btn {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: #64748B;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }
        
        .tab-btn:hover:not(.active) {
            background: #F1F5F9;
            color: #3B82F6;
        }
        
        .dark .tab-btn:hover:not(.active) {
            background: #334155;
            color: #60A5FA;
        }
        
        /* 类别项样式 - 调整圆角 */
        .category-item {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            color: #64748B;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            background: transparent;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .category-item.active {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: #fff;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        .category-item:hover {
            background: #F1F5F9;
            color: #3B82F6;
        }
        .dark .category-item:hover {
            background: #334155;
            color: #60A5FA;
        }
        
        /* 内容区域 */
        .content-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.08);
            border: 1px solid #E2E8F0;
            min-height: 600px;
        }
        .dark .content-section {
            background: #1E293B;
            box-shadow: 0 4px 20px 0 rgba(0,0,0,0.25);
            border: 1px solid #334155;
        }
        
        /* 分组卡片 */
        .group-card {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .dark .group-card {
            background: #0F172A;
            border-color: #334155;
        }
        
        /* 配料项 */
        .ingredient-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .dark .ingredient-item {
            background: #1E293B;
            border-color: #334155;
        }
        
        /* SOP步骤 */
        .sop-step {
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .dark .sop-step {
            background: #1E293B;
            border-color: #334155;
        }
        
        /* 步骤卡片 */
        .step-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .dark .step-card {
            background: #1E293B;
            border-color: #334155;
        }
        
        /* 图片上传区域 */
        .image-upload {
            border: 2px dashed #3B82F6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .image-upload:hover {
            border-color: #2563EB;
            background: #EFF6FF;
        }
        .dark .image-upload:hover {
            background: #1E3A8A;
        }
        
        /* 通知样式 */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        .notification.error {
            background: linear-gradient(135deg, #EF4444, #DC2626);
        }
        .notification.info {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }
        
        .input-shadow:focus { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); border-color: #3B82F6; }
        .tab-active { color: #3B82F6 !important; }
        .tab-inactive { color: #64748B !important; }
        .tab-bg-active { background: #EFF6FF !important; border: 1px solid #BFDBFE; }
        .tab-bg-inactive { background: #FFFFFF !important; border: 1px solid #E2E8F0; }
        .dark .tab-bg-active { background: #1E3A8A !important; border: 1px solid #3B82F6; }
        .dark .tab-bg-inactive { background: #1E293B !important; border: 1px solid #334155; }
        .transition-all { transition: all 0.2s cubic-bezier(.4,0,.2,1); }
        .bottom-bar { border-radius: 24px 24px 0 0; }
        .group-blue { background: #E8F0FE; }
        .group-yellow { background: #FFF7E0; }
        .group-pink { background: #FDE7EF; }
        .group-green { background: #E6F6EC; }
        .group-gray { background: #F3F4F6; }
        .dark .group-blue { background: #22304a; }
        .dark .group-yellow { background: #4a3e22; }
        .dark .group-pink { background: #4a2230; }
        .dark .group-green { background: #224a30; }
        .dark .group-gray { background: #23272f; }
        .sop-step-row { transition: all 0.2s ease; }
        .sop-step-row:hover { background: #2a2f3a !important; }
        .dark .sop-step-row:hover { background: #2a2f3a !important; }
        .sop-menu-dropdown { min-width: 100px; }
        .sop-drag-handle:active { cursor: grabbing !important; }
        .sop-type-modal { backdrop-filter: blur(8px); }
        .sop-type-grid { max-height: 60vh; }
        .sop-type-item { transition: all 0.15s ease; }
        .sop-type-item:hover { background: rgba(59, 130, 246, 0.1) !important; transform: translateY(-1px); }
        .sop-step-input { background: rgba(255,255,255,0.05) !important; }
        .sop-step-input:focus { background: rgba(255,255,255,0.1) !important; }
        .step-row { transition: all 0.3s ease; background: #FFFFFF !important; border: 1px solid #E2E8F0 !important; }
        .step-row:hover { background: #F8FAFC !important; border-color: #CBD5E1 !important; transform: translateY(-1px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .dark .step-row { background: #1E293B !important; border: 1px solid #334155 !important; }
        .dark .step-row:hover { background: #0F172A !important; border-color: #475569 !important; }
        .media-upload-area { transition: all 0.2s ease; background: #F1F5F9; border: 2px dashed #CBD5E1; }
        .media-upload-area:hover { border-color: #3B82F6 !important; background: rgba(59, 130, 246, 0.05) !important; }
        .dark .media-upload-area { background: #0F172A; border-color: #475569; }
        .media-preview { position: relative; overflow: hidden; }
        .media-preview .remove-btn { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.7); }
        .step-number { background: linear-gradient(135deg, #3B82F6, #2563EB); }
        .video-indicator { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .crop-container { max-width: 100%; max-height: 400px; }
        .crop-preview { width: 120px; height: 120px; border-radius: 12px; overflow: hidden; border: 2px solid #E2E8F0; }
        .dark .crop-preview { border-color: #334155; }
        
        /* 步骤图片横向滚动样式 */
        .snap-x {
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .snap-x::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }
        .snap-center {
            scroll-snap-align: center;
        }
        
        .drag-handle-enhanced { 
            background: linear-gradient(135deg, #E2E8F0, #CBD5E1); 
            border-radius: 8px; 
            padding: 8px; 
            cursor: grab; 
            transition: all 0.2s ease;
            border: 1px solid #94A3B8;
        }
        .drag-handle-enhanced:hover { 
            background: linear-gradient(135deg, #CBD5E1, #94A3B8); 
            transform: scale(1.05); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .drag-handle-enhanced:active { cursor: grabbing; transform: scale(0.95); }
        .dark .drag-handle-enhanced { 
            background: linear-gradient(135deg, #334155, #475569); 
            border-color: #64748B;
        }
        .dark .drag-handle-enhanced:hover { 
            background: linear-gradient(135deg, #475569, #64748B); 
        }
        .sop-step-enhanced { 
            background: #FFFFFF !important; 
            border: 1px solid #E2E8F0 !important; 
            transition: all 0.3s ease;
        }
        .sop-step-enhanced:hover { 
            background: #F8FAFC !important; 
            border-color: #CBD5E1 !important; 
            transform: translateY(-1px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .dark .sop-step-enhanced { 
            background: #1E293B !important; 
            border: 1px solid #334155 !important; 
        }
        .dark .sop-step-enhanced:hover { 
            background: #0F172A !important; 
            border-color: #475569 !important; 
        }

        /* 添加左滑删除相关样式 */
        .ingredient-item {
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
            transform: translateX(0);
            transition: transform 0.3s ease;
            width: 100%;
        }

        .ingredient-item .delete-action {
            position: absolute;
            right: -80px; /* 初始时完全在视图外 */
            top: 0;
            bottom: 0;
            width: 80px;
            background-color: #F44336;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            z-index: 10; /* 确保在其他元素之上 */
            font-size: 16px;
            text-align: center;
        }

        .ingredient-item.swiping {
            transition: none;
        }

        /* 同步状态的样式 */
        .name-input {
            transition: all 0.3s ease;
        }

        .name-input.synced {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.05);
        }

        .name-input.not-synced {
            border-color: #F44336;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            transition: all 0.3s ease;
        }

        .sync-indicator.synced {
            background-color: #4CAF50;
        }

        .sync-indicator.not-synced {
            background-color: #F44336;
        }
        
        /* 隐藏类 */
        .hidden {
            display: none !important;
        }
        
        /* 响应式 */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                padding: 1rem;
            }
            .sidebar {
                width: 100%;
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- 主题切换按钮 -->
    <button class="theme-switch" onclick="toggleTheme()">
        <i class="fas fa-moon dark:hidden"></i>
        <i class="fas fa-sun hidden dark:block"></i>
    </button>

    <!-- 应用容器 -->
    <div class="app-container">
        <!-- 主导航栏 -->
        <nav class="main-nav">
            <a href="pczhuye-pc.html" class="nav-item" data-page="home">
                <i class="fas fa-home"></i>
                <span>主页</span>
            </a>
            <a href="#" class="nav-item" data-page="erp">
                <i class="fas fa-chart-bar"></i>
                <span>ERP</span>
            </a>
            <a href="#" class="nav-item" data-page="community">
                <i class="fas fa-users"></i>
                <span>社区</span>
            </a>
            <a href="#" class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>我的</span>
            </a>
        </nav>

        <!-- 主容器 -->
        <div class="main-container">
            <!-- 左侧边栏 -->
            <aside class="sidebar">
                <!-- 配方管理类别 -->
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-[#64748B] dark:text-slate-400 mb-3 uppercase tracking-wide">配方管理</h3>
                    <div class="space-y-1">
                        <button class="category-item active" onclick="filterByCategory('全部配方')">
                            <i class="fas fa-th-large"></i>
                            <span>全部配方</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('面包类')">
                            <i class="fas fa-bread-slice"></i>
                            <span>面包类</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('蛋糕类')">
                            <i class="fas fa-birthday-cake"></i>
                            <span>蛋糕类</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('饼干类')">
                            <i class="fas fa-cookie-bite"></i>
                            <span>饼干类</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('糕点类')">
                            <i class="fas fa-cookie"></i>
                            <span>糕点类</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('慕斯类')">
                            <i class="fas fa-ice-cream"></i>
                            <span>慕斯类</span>
                        </button>
                        <button class="category-item" onclick="filterByCategory('饮品类')">
                            <i class="fas fa-coffee"></i>
                            <span>饮品类</span>
                        </button>
                    </div>
                </div>
                
                <!-- 快捷操作 -->
                <div class="border-t border-[#E2E8F0] dark:border-[#334155] pt-4">
                    <h3 class="text-sm font-semibold text-[#64748B] dark:text-slate-400 mb-3 uppercase tracking-wide">快捷操作</h3>
                    <div class="space-y-2">
                        <button class="btn btn-secondary w-full justify-start">
                            <i class="fas fa-save"></i>
                            <span>保存草稿</span>
                        </button>
                        <button class="btn btn-secondary w-full justify-start">
                            <i class="fas fa-upload"></i>
                            <span>导入配方</span>
                        </button>
                        <button class="btn btn-secondary w-full justify-start">
                            <i class="fas fa-eye"></i>
                            <span>预览效果</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- 主内容区 -->
            <main class="main-content">
                <!-- 页面标题 -->
                <div class="card p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <button class="btn btn-secondary" onclick="goBack()" title="返回配方列表">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <div class="w-12 h-12 bg-gradient-to-r from-[#3B82F6] to-[#2563EB] rounded-full flex items-center justify-center">
                                <i class="fas fa-plus text-white text-xl"></i>
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-[#1E293B] dark:text-slate-100">新建配方</h1>
                                <p class="text-[#64748B] dark:text-slate-400">创建您的专属烘焙配方</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <button class="btn btn-secondary" onclick="openCameraModal()" title="拍照识别配方">
                                <i class="fas fa-camera"></i>
                                <span>拍照识别</span>
                            </button>
                            <button class="btn btn-secondary" onclick="saveDraft()">
                                <i class="fas fa-save"></i>
                                <span>保存草稿</span>
                            </button>
                            <button class="btn btn-primary" onclick="saveRecipe()">
                                <i class="fas fa-check"></i>
                                <span>保存配方</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab切换 -->
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('recipe')" id="tab-recipe">
                        <i class="fas fa-bread-slice text-xl"></i>
                        <span>配方</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('sop')" id="tab-sop">
                        <i class="fas fa-list-alt text-xl"></i>
                        <span>SOP</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('step')" id="tab-step">
                        <i class="fas fa-tasks text-xl"></i>
                        <span>步骤</span>
                    </button>
                </div>

                <!-- 配方内容区 -->
                <div class="content-section" id="recipe-content">
                    <!-- 基本信息 -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100 mb-4">基本信息</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">配方名称 *</label>
                                <input type="text" id="recipeName" class="w-full px-4 py-3 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" placeholder="请输入配方名称">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">配方分类 *</label>
                                <select id="recipeCategory" class="w-full px-4 py-3 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                                    <option value="">选择分类</option>
                                    <option value="bread">面包</option>
                                    <option value="cake">蛋糕</option>
                                    <option value="cookie">饼干</option>
                                    <option value="pastry">糕点</option>
                                    <option value="mousse">慕斯</option>
                                    <option value="drink">饮品</option>
                                    <option value="other">其他</option>
                                </select>
                            </div>
                            <div class="lg:col-span-2">
                                <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">配方描述</label>
                                <textarea id="recipeDescription" rows="3" class="w-full px-4 py-3 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100 resize-none" placeholder="请输入配方描述"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 封面图片 -->
                    <div class="mb-8">
                        <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100 mb-4">封面图片</h2>
                        <div class="image-upload" onclick="document.getElementById('coverImageInput').click()">
                            <input type="file" id="coverImageInput" class="hidden" accept="image/*" onchange="previewCoverImage(event)">
                            <div id="coverImagePreview">
                                <i class="fas fa-camera text-4xl text-[#3B82F6] dark:text-[#60A5FA] mb-4"></i>
                                <p class="text-[#3B82F6] dark:text-[#60A5FA] font-medium">点击上传封面图片</p>
                                <p class="text-sm text-[#64748B] dark:text-slate-400 mt-2">支持 JPG、PNG 格式，建议尺寸 800x600</p>
                            </div>
                        </div>
                    </div>

                    <!-- 配料分组 -->
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100">配料分组</h2>
                            <button class="btn btn-secondary" onclick="addIngredientGroup()">
                                <i class="fas fa-plus"></i>
                                <span>添加分组</span>
                            </button>
                        </div>
                        <div id="ingredientGroups">
                            <!-- 面粉分组 -->
                            <div class="group-card group-blue" data-group="flour">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#3B82F6] rounded-full flex items-center justify-center">
                                            <i class="fas fa-bread-slice text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">面粉 (基准100%)</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('flour')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="flour-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 种面分组 -->
                            <div class="group-card group-yellow" data-group="starter">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#F59E0B] rounded-full flex items-center justify-center">
                                            <i class="fas fa-bacteria text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">种面</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('starter')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="starter-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 干料分组 -->
                            <div class="group-card group-pink" data-group="dry">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#EC4899] rounded-full flex items-center justify-center">
                                            <i class="fas fa-prescription-bottle text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">干料</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('dry')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="dry-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 湿料分组 -->
                            <div class="group-card group-green" data-group="wet">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#10B981] rounded-full flex items-center justify-center">
                                            <i class="fas fa-tint text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">湿料</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('wet')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="wet-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 辅料分组 -->
                            <div class="group-card group-gray" data-group="aux">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#6B7280] rounded-full flex items-center justify-center">
                                            <i class="fas fa-plus-circle text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">辅料</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('aux')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="aux-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 基础面团分组 -->
                            <div class="group-card group-blue" data-group="base">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#3B82F6] rounded-full flex items-center justify-center">
                                            <i class="fas fa-circle text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">基础面团</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('base')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="base-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>

                            <!-- 变化款分组 -->
                            <div class="group-card group-yellow" data-group="variant">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-[#F59E0B] rounded-full flex items-center justify-center">
                                            <i class="fas fa-magic text-white text-sm"></i>
                                        </div>
                                        <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">变化款</h3>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addIngredient('variant')">
                                        <i class="fas fa-plus"></i>
                                        <span>添加</span>
                                    </button>
                                </div>
                                <div class="space-y-2" id="variant-ingredients">
                                    <!-- 配料项将在这里动态添加 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SOP内容区 -->
                <div class="content-section hidden" id="sop-content">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100">标准作业程序</h2>
                            <p class="text-[#64748B] dark:text-slate-400 mt-1">设定每个步骤的具体参数和要求</p>
                        </div>
                        <button class="btn btn-secondary" onclick="addSopStep()">
                            <i class="fas fa-plus"></i>
                            <span>添加SOP步骤</span>
                        </button>
                    </div>
                    <div id="sopSteps">
                        <!-- SOP步骤将在这里动态添加 -->
                    </div>
                </div>

                <!-- 步骤内容区 -->
                <div class="content-section hidden" id="step-content">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-xl font-bold text-[#1E293B] dark:text-slate-100">制作步骤</h2>
                            <p class="text-[#64748B] dark:text-slate-400 mt-1">详细记录每个制作环节，支持图片和视频说明</p>
                        </div>
                        <button class="btn btn-secondary" onclick="addStep()">
                            <i class="fas fa-plus"></i>
                            <span>添加步骤</span>
                        </button>
                    </div>
                    <div id="steps">
                        <!-- 制作步骤将在这里动态添加 -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notification" class="notification"></div>

    <!-- 拍照识别弹窗 -->
    <div id="cameraModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-[#1E293B] rounded-lg p-6 w-full max-w-2xl mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-[#1E293B] dark:text-slate-100">拍照识别配方</h3>
                <button onclick="closeCameraModal()" class="text-[#64748B] hover:text-[#1E293B] dark:hover:text-slate-100">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="flex gap-4">
                    <button class="btn btn-primary flex-1" onclick="startCamera()">
                        <i class="fas fa-camera"></i>
                        <span>打开相机</span>
                    </button>
                    <button class="btn btn-secondary flex-1" onclick="selectImage()">
                        <i class="fas fa-image"></i>
                        <span>选择图片</span>
                    </button>
                </div>
                <div id="cameraContainer" class="hidden">
                    <video id="cameraVideo" class="w-full rounded-lg" autoplay></video>
                    <div class="flex justify-center mt-4">
                        <button class="btn btn-primary" onclick="capturePhoto()">
                            <i class="fas fa-camera"></i>
                            <span>拍照</span>
                        </button>
                    </div>
                </div>
                <div id="imagePreview" class="hidden">
                    <img id="previewImage" class="w-full rounded-lg">
                    <div class="flex justify-center mt-4 gap-4">
                        <button class="btn btn-secondary" onclick="retakePhoto()">
                            <i class="fas fa-redo"></i>
                            <span>重新拍照</span>
                        </button>
                        <button class="btn btn-primary" onclick="recognizeRecipe()">
                            <i class="fas fa-magic"></i>
                            <span>识别配方</span>
                        </button>
                    </div>
                </div>
                <input type="file" id="imageInput" class="hidden" accept="image/*" onchange="handleImageSelect(event)">
            </div>
        </div>
    </div>

    <!-- 识别结果弹窗 -->
    <div id="recognitionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white dark:bg-[#1E293B] rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-[#1E293B] dark:text-slate-100">识别结果</h3>
                <button onclick="closeRecognitionModal()" class="text-[#64748B] hover:text-[#1E293B] dark:hover:text-slate-100">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="recognitionResult" class="space-y-4">
                <!-- 识别结果将在这里显示 -->
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button class="btn btn-secondary" onclick="closeRecognitionModal()">
                    <span>取消</span>
                </button>
                <button class="btn btn-primary" onclick="applyRecognitionResult()">
                    <i class="fas fa-check"></i>
                    <span>应用到配方</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 主题切换器 -->
    <div id="themeSelector" class="fixed top-4 right-4 z-40">
        <div class="theme-switcher">
            <button class="theme-btn active" data-theme="light" title="浅色主题">
                <i class="fas fa-sun"></i>
            </button>
            <button class="theme-btn" data-theme="dark" title="深色主题">
                <i class="fas fa-moon"></i>
            </button>
            <button class="theme-btn" data-theme="japanese" title="日式主题">
                <i class="fas fa-torii-gate"></i>
            </button>
            <button class="theme-btn" data-theme="korean" title="韩式主题">
                <i class="fas fa-mountain"></i>
            </button>
        </div>
    </div>

    <script>
        // 全局变量
        let currentTab = 'recipe';
        let ingredientCounter = 0;
        let sopCounter = 0;
        let stepCounter = 0;
        let currentTheme = 'light';
        let cameraStream = null;
        let recognitionData = null;

        // 多主题切换系统
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // 初始化主题切换器
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    setTheme(theme);
                });
            });
        }

        function setTheme(theme) {
            // 移除所有主题类
            document.documentElement.classList.remove('light', 'dark', 'japanese', 'korean');
            
            // 添加新主题类
            document.documentElement.classList.add(theme);
            
            // 更新当前主题
            currentTheme = theme;
            
            // 保存到本地存储
            localStorage.setItem('theme', theme);
            
            // 更新主题切换器状态
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
        }

        // 拍照识别功能
        function openCameraModal() {
            document.getElementById('cameraModal').classList.remove('hidden');
        }

        function closeCameraModal() {
            document.getElementById('cameraModal').classList.add('hidden');
            stopCamera();
        }

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraVideo');
                    video.srcObject = stream;
                    document.getElementById('cameraContainer').classList.remove('hidden');
                })
                .catch(err => {
                    showNotification('无法访问相机：' + err.message, 'error');
                });
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            document.getElementById('cameraContainer').classList.add('hidden');
            document.getElementById('imagePreview').classList.add('hidden');
        }

        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/jpeg');
            showImagePreview(imageData);
        }

        function selectImage() {
            document.getElementById('imageInput').click();
        }

        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    showImagePreview(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function showImagePreview(imageData) {
            document.getElementById('previewImage').src = imageData;
            document.getElementById('cameraContainer').classList.add('hidden');
            document.getElementById('imagePreview').classList.remove('hidden');
            stopCamera();
        }

        function retakePhoto() {
            document.getElementById('imagePreview').classList.add('hidden');
            startCamera();
        }

        function recognizeRecipe() {
            showNotification('正在识别配方...', 'info');
            
            // 模拟识别过程
            setTimeout(() => {
                const mockResult = {
                    recipeName: '经典吐司面包',
                    category: 'bread',
                    ingredients: {
                        flour: [{ name: '高筋面粉', amount: '500', unit: 'g', percentage: '100' }],
                        wet: [{ name: '水', amount: '320', unit: 'ml', percentage: '64' }],
                        dry: [{ name: '盐', amount: '8', unit: 'g', percentage: '1.6' }, { name: '糖', amount: '30', unit: 'g', percentage: '6' }],
                        aux: [{ name: '酵母', amount: '6', unit: 'g', percentage: '1.2' }]
                    },
                    steps: [
                        '将所有干料混合均匀',
                        '加入水，搅拌成团',
                        '揉面至光滑有弹性',
                        '发酵至两倍大',
                        '整形后二次发酵',
                        '烘烤至金黄色'
                    ]
                };
                
                recognitionData = mockResult;
                showRecognitionResult(mockResult);
                closeCameraModal();
                showNotification('配方识别完成！', 'success');
            }, 2000);
        }

        function showRecognitionResult(result) {
            const container = document.getElementById('recognitionResult');
            container.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-[#1E293B] dark:text-slate-100 mb-2">配方名称</h4>
                        <p class="text-[#64748B] dark:text-slate-400">${result.recipeName}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-[#1E293B] dark:text-slate-100 mb-2">配料清单</h4>
                        ${Object.entries(result.ingredients).map(([group, items]) => `
                            <div class="mb-3">
                                <h5 class="text-sm font-medium text-[#374151] dark:text-slate-300 mb-1">${getGroupName(group)}</h5>
                                <ul class="space-y-1">
                                    ${items.map(item => `
                                        <li class="text-sm text-[#64748B] dark:text-slate-400">
                                            ${item.name}: ${item.amount}${item.unit} (${item.percentage}%)
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h4 class="font-semibold text-[#1E293B] dark:text-slate-100 mb-2">制作步骤</h4>
                        <ol class="space-y-1">
                            ${result.steps.map((step, index) => `
                                <li class="text-sm text-[#64748B] dark:text-slate-400">
                                    ${index + 1}. ${step}
                                </li>
                            `).join('')}
                        </ol>
                    </div>
                </div>
            `;
            
            document.getElementById('recognitionModal').classList.remove('hidden');
        }

        function getGroupName(group) {
            const names = {
                flour: '面粉',
                starter: '种面',
                dry: '干料',
                wet: '湿料',
                aux: '辅料',
                base: '基础面团',
                variant: '变化款'
            };
            return names[group] || group;
        }

        function closeRecognitionModal() {
            document.getElementById('recognitionModal').classList.add('hidden');
        }

        function applyRecognitionResult() {
            if (!recognitionData) return;
            
            // 应用配方名称和分类
            document.getElementById('recipeName').value = recognitionData.recipeName;
            document.getElementById('recipeCategory').value = recognitionData.category;
            
            // 应用配料
            Object.entries(recognitionData.ingredients).forEach(([group, items]) => {
                items.forEach(item => {
                    addIngredientWithData(group, item);
                });
            });
            
            // 应用制作步骤
            recognitionData.steps.forEach(stepText => {
                addStepWithData(stepText);
            });
            
            closeRecognitionModal();
            showNotification('配方已应用到编辑器', 'success');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Tab切换
        function switchTab(tab) {
            try {
                // 更新Tab按钮状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });
                
                const activeTab = document.getElementById(`tab-${tab}`);
                if (activeTab) {
                    activeTab.classList.add('active');
                    activeTab.setAttribute('aria-selected', 'true');
                }
                
                // 隐藏所有内容区
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.add('hidden');
                    section.setAttribute('aria-hidden', 'true');
                });
                
                // 显示对应内容区
                const targetContent = document.getElementById(`${tab}-content`);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                    targetContent.setAttribute('aria-hidden', 'false');
                    
                    // 平滑滚动到顶部
                    targetContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                
                currentTab = tab;
                
                // 保存当前Tab状态到localStorage
                localStorage.setItem('currentRecipeTab', tab);
                
                console.log(`切换到${tab}标签页`);
            } catch (error) {
                console.error('Tab切换出错:', error);
                showNotification('切换失败，请重试', 'error');
            }
        }

        // 预览封面图片
        function previewCoverImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('coverImagePreview');
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-48 object-cover rounded-lg mb-4">
                        <p class="text-[#3B82F6] dark:text-[#60A5FA] font-medium">点击重新选择图片</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // 添加配料分组
        function addIngredientGroup() {
            const groupName = prompt('请输入分组名称:');
            if (!groupName) return;
            
            const groupId = groupName.toLowerCase().replace(/\s+/g, '-');
            const groupsContainer = document.getElementById('ingredientGroups');
            
            const groupHtml = `
                <div class="group-card" data-group="${groupId}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-[#3B82F6] rounded-full flex items-center justify-center">
                                <i class="fas fa-layer-group text-white text-sm"></i>
                            </div>
                            <h3 class="font-semibold text-[#1E293B] dark:text-slate-100">${groupName}</h3>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="btn btn-secondary btn-sm" onclick="addIngredient('${groupId}')">
                                <i class="fas fa-plus"></i>
                                <span>添加</span>
                            </button>
                            <button class="btn btn-secondary btn-sm text-red-600" onclick="removeIngredientGroup('${groupId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="space-y-2" id="${groupId}-ingredients">
                        <!-- 配料项将在这里动态添加 -->
                    </div>
                </div>
            `;
            
            groupsContainer.insertAdjacentHTML('beforeend', groupHtml);
            showNotification(`分组「${groupName}」已添加`, 'success');
        }

        // 删除配料分组
        function removeIngredientGroup(groupId) {
            if (confirm('确定要删除这个分组吗？')) {
                const groupElement = document.querySelector(`[data-group="${groupId}"]`);
                groupElement.remove();
                showNotification('分组已删除', 'success');
            }
        }

        // 添加配料
        function addIngredient(groupId) {
            ingredientCounter++;
            const container = document.getElementById(`${groupId}-ingredients`);
            
            const ingredientHtml = `
                <div class="ingredient-item" data-ingredient-id="${ingredientCounter}">
                    <div class="relative">
                        <input type="text" placeholder="配料名称" class="px-3 py-2 pr-8 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" oninput="searchMaterial(this)">
                        <button type="button" onclick="openMaterialSearch(this)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <input type="text" placeholder="规格" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                    <input type="number" placeholder="用量" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" oninput="calculatePercentage(this)">
                    <div class="relative">
                        <select class="px-3 py-2 pr-8 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                            <option value="g">克(g)</option>
                            <option value="kg">千克(kg)</option>
                            <option value="ml">毫升(ml)</option>
                            <option value="l">升(l)</option>
                            <option value="个">个</option>
                            <option value="勺">勺</option>
                        </select>
                        <button type="button" onclick="openUnitSelector(this)" class="absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <input type="number" placeholder="百分比" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" step="0.1" oninput="calculateAmount(this)">
                    <input type="number" placeholder="价格" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" step="0.01">
                    <div class="flex items-center gap-2">
                        <button type="button" class="drag-handle px-2 py-2 text-gray-400 hover:text-gray-600 cursor-move">
                            <i class="fas fa-grip-vertical"></i>
                        </button>
                        <button class="btn btn-secondary btn-sm text-red-600" onclick="removeIngredient(${ingredientCounter})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', ingredientHtml);
            initSortable(container);
        }

        // 添加配料（带数据）
        function addIngredientWithData(groupId, data) {
            ingredientCounter++;
            const container = document.getElementById(`${groupId}-ingredients`);
            
            const ingredientHtml = `
                <div class="ingredient-item" data-ingredient-id="${ingredientCounter}">
                    <div class="relative">
                        <input type="text" placeholder="配料名称" value="${data.name}" class="px-3 py-2 pr-8 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" oninput="searchMaterial(this)">
                        <button type="button" onclick="openMaterialSearch(this)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <input type="text" placeholder="规格" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                    <input type="number" placeholder="用量" value="${data.amount}" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" oninput="calculatePercentage(this)">
                    <div class="relative">
                        <select class="px-3 py-2 pr-8 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                            <option value="g" ${data.unit === 'g' ? 'selected' : ''}>克(g)</option>
                            <option value="kg" ${data.unit === 'kg' ? 'selected' : ''}>千克(kg)</option>
                            <option value="ml" ${data.unit === 'ml' ? 'selected' : ''}>毫升(ml)</option>
                            <option value="l" ${data.unit === 'l' ? 'selected' : ''}>升(l)</option>
                            <option value="个" ${data.unit === '个' ? 'selected' : ''}>个</option>
                            <option value="勺" ${data.unit === '勺' ? 'selected' : ''}>勺</option>
                        </select>
                        <button type="button" onclick="openUnitSelector(this)" class="absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <input type="number" placeholder="百分比" value="${data.percentage}" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" step="0.1" oninput="calculateAmount(this)">
                    <input type="number" placeholder="价格" class="px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100" step="0.01">
                    <div class="flex items-center gap-2">
                        <button type="button" class="drag-handle px-2 py-2 text-gray-400 hover:text-gray-600 cursor-move">
                            <i class="fas fa-grip-vertical"></i>
                        </button>
                        <button class="btn btn-secondary btn-sm text-red-600" onclick="removeIngredient(${ingredientCounter})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', ingredientHtml);
            initSortable(container);
        }

        // 删除配料
        function removeIngredient(ingredientId) {
            const ingredient = document.querySelector(`[data-ingredient-id="${ingredientId}"]`);
            ingredient.remove();
        }

        // 初始化拖拽排序
        function initSortable(container) {
            if (typeof Sortable !== 'undefined') {
                new Sortable(container, {
                    handle: '.drag-handle',
                    animation: 150,
                    ghostClass: 'sortable-ghost'
                });
            }
        }

        // 材料搜索功能
        const materialDatabase = [
            '高筋面粉', '中筋面粉', '低筋面粉', '全麦面粉', '黑麦面粉',
            '水', '牛奶', '鸡蛋', '黄油', '橄榄油', '植物油',
            '盐', '糖', '红糖', '蜂蜜', '酵母', '泡打粉',
            '香草精', '柠檬汁', '可可粉', '巧克力', '坚果',
            '葡萄干', '蔓越莓干', '芝麻', '亚麻籽'
        ];

        function searchMaterial(input) {
            const query = input.value.toLowerCase();
            if (query.length < 1) return;
            
            const matches = materialDatabase.filter(material => 
                material.toLowerCase().includes(query)
            );
            
            showMaterialSuggestions(input, matches);
        }

        function showMaterialSuggestions(input, suggestions) {
            // 移除现有的建议列表
            const existingSuggestions = input.parentNode.querySelector('.material-suggestions');
            if (existingSuggestions) {
                existingSuggestions.remove();
            }
            
            if (suggestions.length === 0) return;
            
            const suggestionsList = document.createElement('div');
            suggestionsList.className = 'material-suggestions absolute top-full left-0 right-0 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md shadow-lg z-10 max-h-40 overflow-y-auto';
            
            suggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-700 cursor-pointer text-sm';
                item.textContent = suggestion;
                item.onclick = () => {
                    input.value = suggestion;
                    suggestionsList.remove();
                };
                suggestionsList.appendChild(item);
            });
            
            input.parentNode.appendChild(suggestionsList);
        }

        function openMaterialSearch(button) {
            document.getElementById('materialSearchModal').classList.remove('hidden');
            document.getElementById('materialSearchInput').focus();
        }

        function closeMaterialSearch() {
            document.getElementById('materialSearchModal').classList.add('hidden');
        }

        // 单位选择功能
        function openUnitSelector(button) {
            document.getElementById('unitModal').classList.remove('hidden');
        }

        function closeUnitModal() {
            document.getElementById('unitModal').classList.add('hidden');
        }

        // 百分比和用量计算
        function calculatePercentage(input) {
            // 这里可以添加自动计算百分比的逻辑
        }

        function calculateAmount(input) {
            // 这里可以添加根据百分比计算用量的逻辑
        }

        // 添加SOP步骤
        function addSopStep() {
            sopCounter++;
            const container = document.getElementById('sopSteps');
            
            const sopHtml = `
                <div class="sop-step bg-white dark:bg-slate-800 p-6 rounded-lg border border-gray-200 dark:border-slate-700 mb-4" data-sop-id="${sopCounter}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-[#3B82F6] rounded-full flex items-center justify-center text-white font-bold">
                                ${sopCounter}
                            </div>
                            <div class="relative">
                                <input type="text" placeholder="SOP类型" class="text-lg font-semibold bg-transparent border-b border-gray-300 dark:border-slate-600 outline-none text-[#1E293B] dark:text-slate-100 placeholder-slate-400 pr-8" onclick="openSopTypeModal(this)" readonly>
                                <button type="button" onclick="openSopTypeModal(this.previousElementSibling)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button type="button" class="drag-handle px-2 py-2 text-gray-400 hover:text-gray-600 cursor-move">
                                <i class="fas fa-grip-vertical"></i>
                            </button>
                            <button type="button" onclick="openSopMenu(${sopCounter})" class="px-2 py-2 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <button class="btn btn-secondary btn-sm text-red-600" onclick="removeSopStep(${sopCounter})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">温度</label>
                            <input type="text" placeholder="例如：180°C" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">时间</label>
                            <input type="text" placeholder="例如：15分钟" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">速度</label>
                            <input type="text" placeholder="例如：中速" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">其他参数</label>
                            <input type="text" placeholder="例如：湿度60%" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">操作说明</label>
                        <textarea rows="3" placeholder="详细描述操作步骤和注意事项" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100 resize-none"></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', sopHtml);
            initSortable(container);
        }

        // SOP类型数据
        const sopTypes = [
            { name: '搅拌', icon: 'fas fa-blender', color: '#3B82F6' },
            { name: '发酵', icon: 'fas fa-thermometer-half', color: '#10B981' },
            { name: '烘烤', icon: 'fas fa-fire', color: '#F59E0B' },
            { name: '冷却', icon: 'fas fa-snowflake', color: '#06B6D4' },
            { name: '整形', icon: 'fas fa-hands', color: '#8B5CF6' },
            { name: '分割', icon: 'fas fa-cut', color: '#EF4444' },
            { name: '醒发', icon: 'fas fa-clock', color: '#F97316' },
            { name: '装饰', icon: 'fas fa-palette', color: '#EC4899' }
        ];

        // 打开SOP类型选择模态框
        function openSopTypeModal(input) {
            const modal = document.getElementById('sopTypeModal');
            const container = document.getElementById('sopTypeList');
            
            // 清空并重新填充SOP类型列表
            container.innerHTML = '';
            sopTypes.forEach(type => {
                const item = document.createElement('div');
                item.className = 'sop-type-item flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer rounded-lg';
                item.innerHTML = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-white" style="background-color: ${type.color}">
                        <i class="${type.icon} text-sm"></i>
                    </div>
                    <span class="font-medium text-[#1E293B] dark:text-slate-100">${type.name}</span>
                `;
                item.onclick = () => {
                    input.value = type.name;
                    closeSopTypeModal();
                };
                container.appendChild(item);
            });
            
            modal.classList.remove('hidden');
        }

        function closeSopTypeModal() {
            document.getElementById('sopTypeModal').classList.add('hidden');
        }

        // 打开SOP操作菜单
        function openSopMenu(sopId) {
            const modal = document.getElementById('sopMenuModal');
            modal.classList.remove('hidden');
            
            // 设置当前操作的SOP ID
            modal.dataset.currentSopId = sopId;
        }

        function closeSopMenu() {
            document.getElementById('sopMenuModal').classList.add('hidden');
        }

        // SOP菜单操作
        function duplicateSop() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopElement = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopElement) {
                const clonedSop = sopElement.cloneNode(true);
                sopCounter++;
                clonedSop.dataset.sopId = sopCounter;
                
                // 更新编号
                const numberElement = clonedSop.querySelector('.w-8.h-8');
                numberElement.textContent = sopCounter;
                
                // 更新按钮事件
                clonedSop.querySelector('.btn.text-red-600').onclick = () => removeSopStep(sopCounter);
                clonedSop.querySelector('[onclick*="openSopMenu"]').onclick = () => openSopMenu(sopCounter);
                
                sopElement.parentNode.insertBefore(clonedSop, sopElement.nextSibling);
            }
            
            closeSopMenu();
        }

        function moveSopUp() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopElement = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopElement && sopElement.previousElementSibling) {
                sopElement.parentNode.insertBefore(sopElement, sopElement.previousElementSibling);
                updateSopNumbers();
            }
            
            closeSopMenu();
        }

        function moveSopDown() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopElement = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopElement && sopElement.nextElementSibling) {
                sopElement.parentNode.insertBefore(sopElement.nextElementSibling, sopElement);
                updateSopNumbers();
            }
            
            closeSopMenu();
        }

        // 删除SOP步骤
        function removeSopStep(sopId) {
            if (confirm('确定要删除这个SOP步骤吗？')) {
                const sop = document.querySelector(`[data-sop-id="${sopId}"]`);
                sop.remove();
                updateSopNumbers();
            }
        }

        // 更新SOP步骤编号
        function updateSopNumbers() {
            const sopSteps = document.querySelectorAll('.sop-step');
            sopSteps.forEach((step, index) => {
                const numberElement = step.querySelector('.w-8.h-8');
                numberElement.textContent = index + 1;
            });
        }

        // 添加制作步骤
        function addStep() {
            stepCounter++;
            const container = document.getElementById('steps');
            
            const stepHtml = `
                <div class="step-card bg-white dark:bg-slate-800 p-6 rounded-lg border border-gray-200 dark:border-slate-700 mb-4" data-step-id="${stepCounter}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-[#3B82F6] rounded-full flex items-center justify-center text-white font-bold text-lg">
                                ${stepCounter}
                            </div>
                            <input type="text" placeholder="步骤标题" class="text-xl font-semibold bg-transparent border-b border-gray-300 dark:border-slate-600 outline-none text-[#1E293B] dark:text-slate-100 placeholder-slate-400">
                        </div>
                        <div class="flex items-center gap-2">
                            <button type="button" class="drag-handle px-2 py-2 text-gray-400 hover:text-gray-600 cursor-move">
                                <i class="fas fa-grip-vertical"></i>
                            </button>
                            <button type="button" onclick="openStepMenu(${stepCounter})" class="px-2 py-2 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <button class="btn btn-secondary btn-sm text-red-600" onclick="removeStep(${stepCounter})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">步骤描述</label>
                        <textarea rows="4" placeholder="详细描述制作过程" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100 resize-none"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">媒体上传</label>
                        <div class="flex gap-2 mb-2">
                            <button type="button" onclick="openMediaUpload(${stepCounter})" class="btn btn-secondary btn-sm">
                                <i class="fas fa-camera"></i>
                                <span>添加图片/视频</span>
                            </button>
                        </div>
                        <div id="stepMedia${stepCounter}" class="media-preview-container flex gap-2 flex-wrap">
                            <!-- 媒体预览将在这里显示 -->
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">步骤图片</label>
                        <div class="image-upload" onclick="document.getElementById('stepImage${stepCounter}').click()">
                            <input type="file" id="stepImage${stepCounter}" class="hidden" accept="image/*" onchange="previewStepImage(event, ${stepCounter})">
                            <div id="stepImagePreview${stepCounter}">
                                <i class="fas fa-camera text-2xl text-[#3B82F6] dark:text-[#60A5FA] mb-2"></i>
                                <p class="text-[#3B82F6] dark:text-[#60A5FA] font-medium">点击上传步骤图片</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', stepHtml);
            initSortable(container);
        }

        // 添加制作步骤（带数据）
        function addStepWithData(stepText) {
            stepCounter++;
            const container = document.getElementById('steps');
            
            const stepHtml = `
                <div class="step-card bg-white dark:bg-slate-800 p-6 rounded-lg border border-gray-200 dark:border-slate-700 mb-4" data-step-id="${stepCounter}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-[#3B82F6] rounded-full flex items-center justify-center text-white font-bold text-lg">
                                ${stepCounter}
                            </div>
                            <input type="text" placeholder="步骤标题" value="步骤 ${stepCounter}" class="text-xl font-semibold bg-transparent border-b border-gray-300 dark:border-slate-600 outline-none text-[#1E293B] dark:text-slate-100 placeholder-slate-400">
                        </div>
                        <div class="flex items-center gap-2">
                            <button type="button" class="drag-handle px-2 py-2 text-gray-400 hover:text-gray-600 cursor-move">
                                <i class="fas fa-grip-vertical"></i>
                            </button>
                            <button type="button" onclick="openStepMenu(${stepCounter})" class="px-2 py-2 text-gray-400 hover:text-gray-600">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <button class="btn btn-secondary btn-sm text-red-600" onclick="removeStep(${stepCounter})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">步骤描述</label>
                        <textarea rows="4" placeholder="详细描述制作过程" class="w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg focus:border-[#3B82F6] outline-none bg-white dark:bg-[#1E293B] text-[#1E293B] dark:text-slate-100 resize-none">${stepText}</textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">媒体上传</label>
                        <div class="flex gap-2 mb-2">
                            <button type="button" onclick="openMediaUpload(${stepCounter})" class="btn btn-secondary btn-sm">
                                <i class="fas fa-camera"></i>
                                <span>添加图片/视频</span>
                            </button>
                        </div>
                        <div id="stepMedia${stepCounter}" class="media-preview-container flex gap-2 flex-wrap">
                            <!-- 媒体预览将在这里显示 -->
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#374151] dark:text-slate-300 mb-2">步骤图片</label>
                        <div class="image-upload" onclick="document.getElementById('stepImage${stepCounter}').click()">
                            <input type="file" id="stepImage${stepCounter}" class="hidden" accept="image/*" onchange="previewStepImage(event, ${stepCounter})">
                            <div id="stepImagePreview${stepCounter}">
                                <i class="fas fa-camera text-2xl text-[#3B82F6] dark:text-[#60A5FA] mb-2"></i>
                                <p class="text-[#3B82F6] dark:text-[#60A5FA] font-medium">点击上传步骤图片</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', stepHtml);
            initSortable(container);
        }

        // 打开步骤操作菜单
        function openStepMenu(stepId) {
            const modal = document.getElementById('stepMenuModal');
            modal.classList.remove('hidden');
            modal.dataset.currentStepId = stepId;
        }

        function closeStepMenu() {
            document.getElementById('stepMenuModal').classList.add('hidden');
        }

        // 打开媒体上传选择
        function openMediaUpload(stepId) {
            const modal = document.getElementById('mediaUploadModal');
            modal.classList.remove('hidden');
            modal.dataset.currentStepId = stepId;
        }

        function closeMediaUpload() {
            document.getElementById('mediaUploadModal').classList.add('hidden');
        }

        // 选择图片
        function selectStepImage() {
            document.getElementById('stepMediaInput').click();
        }

        // 选择视频
        function selectStepVideo() {
            document.getElementById('stepVideoInput').click();
        }

        // 拍照
        function takeStepPhoto() {
            // 这里可以调用相机功能
            openCameraModal();
            closeMediaUpload();
        }

        // 删除制作步骤
        function removeStep(stepId) {
            if (confirm('确定要删除这个制作步骤吗？')) {
                const step = document.querySelector(`[data-step-id="${stepId}"]`);
                step.remove();
                updateStepNumbers();
            }
        }

        // 更新制作步骤编号
        function updateStepNumbers() {
            const steps = document.querySelectorAll('.step-card');
            steps.forEach((step, index) => {
                const numberElement = step.querySelector('.w-10.h-10');
                numberElement.textContent = index + 1;
            });
        }

        // 预览步骤图片
        function previewStepImage(event, stepId) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(`stepImagePreview${stepId}`);
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="w-full h-32 object-cover rounded-lg mb-2">
                        <p class="text-[#3B82F6] dark:text-[#60A5FA] font-medium text-sm">点击重新选择</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // 保存草稿
        function saveDraft() {
            showNotification('草稿已保存', 'success');
        }

        // 保存配方
        function saveRecipe() {
            const recipeName = document.getElementById('recipeName').value;
            const recipeCategory = document.getElementById('recipeCategory').value;
            
            if (!recipeName || !recipeCategory) {
                showNotification('请填写配方名称和分类', 'error');
                return;
            }
            
            // 这里可以添加实际的保存逻辑
            showNotification(`配方「${recipeName}」保存成功！`, 'success');
            
            // 3秒后跳转回主页
            setTimeout(() => {
                window.location.href = 'pczhuye-pc.html';
            }, 3000);
        }

        // 返回配方列表
        function goBack() {
            try {
                // 检查是否有未保存的内容
                const recipeName = document.getElementById('recipeName')?.value || '';
                const recipeDescription = document.getElementById('recipeDescription')?.value || '';
                
                if (recipeName.trim() || recipeDescription.trim()) {
                    if (confirm('您有未保存的内容，确定要离开吗？')) {
                        // 使用 history.back() 或直接跳转
                        if (window.history.length > 1) {
                            window.history.back();
                        } else {
                            window.location.href = 'pczhuye-pc.html';
                        }
                    }
                } else {
                    // 使用 history.back() 或直接跳转
                    if (window.history.length > 1) {
                        window.history.back();
                    } else {
                        window.location.href = 'pczhuye-pc.html';
                    }
                }
            } catch (error) {
                console.error('返回功能出错:', error);
                // 备用方案：直接跳转
                window.location.href = 'pczhuye-pc.html';
            }
        }

        // 类别筛选（保持与主页一致）
        function filterByCategory(category) {
            // 这里可以添加筛选逻辑
            showNotification(`切换到${category}`, 'info');
        }

        // 获取URL参数
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // 根据类别初始化配方内容
        function initRecipeByCategory(category) {
            const categorySelect = document.getElementById('recipeCategory');
            if (categorySelect && category) {
                categorySelect.value = category;
            }
            
            // 为所有现有的配料分组添加默认的空配料项
            const ingredientGroups = ['flour', 'starter', 'dry', 'wet', 'aux', 'base'];
            ingredientGroups.forEach(groupId => {
                const groupContainer = document.getElementById(`${groupId}-ingredients`);
                if (groupContainer && groupContainer.children.length === 0) {
                    // 如果分组存在且为空，添加一个默认配料项
                    addIngredient(groupId);
                }
            });
            
            // 根据不同类别添加相应的SOP步骤
            switch(category) {
                case 'bread':
                    // 面包类别 - 添加面包相关的SOP步骤
                    addSopStep('mixing', '和面');
                    addSopStep('fermentation', '发酵');
                    addSopStep('shaping', '整形');
                    addSopStep('baking', '烘烤');
                    break;
                    
                case 'cake':
                    // 蛋糕类别
                    addSopStep('mixing', '搅拌');
                    addSopStep('baking', '烘烤');
                    addSopStep('decoration', '装饰');
                    break;
                    
                case 'drink':
                    // 饮品类别
                    addSopStep('preparation', '准备');
                    addSopStep('mixing', '调制');
                    addSopStep('serving', '装杯');
                    break;
                    
                default:
                    // 默认添加一个SOP步骤
                    addSopStep();
            }
            
            // 默认添加一个制作步骤
            addStep();
        }
        
        // 单位选择相关函数
        function switchUnitTab(tabName) {
            // 移除所有tab的激活状态
            document.querySelectorAll('.unit-tab').forEach(tab => {
                tab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                tab.classList.add('text-gray-500');
            });
            
            // 激活当前tab
            const currentTab = document.querySelector(`[data-tab="${tabName}"]`);
            currentTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            currentTab.classList.remove('text-gray-500');
            
            // 隐藏所有内容
            document.querySelectorAll('.unit-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 显示对应内容
            document.getElementById(tabName + 'Units').classList.remove('hidden');
        }

        function selectUnit(unit) {
            const modal = document.getElementById('unitModal');
            const targetInput = modal.dataset.targetInput;
            if (targetInput) {
                document.getElementById(targetInput).value = unit;
            }
            closeUnitModal();
        }

        function addCustomUnit() {
            const customUnit = document.getElementById('customUnitInput').value.trim();
            if (customUnit) {
                selectUnit(customUnit);
            }
        }

        // 材料搜索相关函数
        const materialDatabase = [
            '高筋面粉', '中筋面粉', '低筋面粉', '全麦面粉', '黑麦面粉',
            '酵母', '盐', '糖', '蜂蜜', '橄榄油', '黄油', '牛奶', '鸡蛋',
            '芝麻', '核桃', '杏仁', '葡萄干', '蔓越莓干', '巧克力豆',
            '香草精', '肉桂粉', '可可粉', '抹茶粉', '红豆沙', '奶油奶酪'
        ];

        function searchMaterial() {
            const query = document.getElementById('materialSearchInput').value.toLowerCase();
            const suggestions = document.getElementById('materialSuggestions');
            
            if (query.length === 0) {
                suggestions.innerHTML = '';
                return;
            }
            
            const filtered = materialDatabase.filter(material => 
                material.toLowerCase().includes(query)
            );
            
            suggestions.innerHTML = filtered.map(material => 
                `<div class="p-2 hover:bg-gray-100 dark:hover:bg-slate-700 cursor-pointer rounded" onclick="selectMaterial('${material}')">
                    ${material}
                </div>`
            ).join('');
        }

        function selectMaterial(material) {
            const modal = document.getElementById('materialSearchModal');
            const targetInput = modal.dataset.targetInput;
            if (targetInput) {
                document.getElementById(targetInput).value = material;
            }
            closeMaterialSearch();
        }

        // SOP类型选择函数
        function selectSopType(type) {
            const modal = document.getElementById('sopTypeModal');
            const targetSopId = modal.dataset.currentSopId;
            if (targetSopId) {
                // 更新SOP类型显示
                const sopCard = document.querySelector(`[data-sop-id="${targetSopId}"]`);
                const typeDisplay = sopCard.querySelector('.sop-type-display');
                if (typeDisplay) {
                    typeDisplay.textContent = type;
                }
            }
            closeSopTypeModal();
        }

        // 步骤操作函数
        function duplicateStep() {
            const modal = document.getElementById('stepMenuModal');
            const stepId = modal.dataset.currentStepId;
            const stepCard = document.querySelector(`[data-step-id="${stepId}"]`);
            
            if (stepCard) {
                const clonedStep = stepCard.cloneNode(true);
                stepCounter++;
                clonedStep.dataset.stepId = stepCounter;
                
                // 更新克隆步骤中的ID和事件
                clonedStep.innerHTML = clonedStep.innerHTML.replace(new RegExp(stepId, 'g'), stepCounter);
                
                stepCard.parentNode.insertBefore(clonedStep, stepCard.nextSibling);
                updateStepNumbers();
            }
            closeStepMenu();
        }

        function moveStepUp() {
            const modal = document.getElementById('stepMenuModal');
            const stepId = modal.dataset.currentStepId;
            const stepCard = document.querySelector(`[data-step-id="${stepId}"]`);
            
            if (stepCard && stepCard.previousElementSibling) {
                stepCard.parentNode.insertBefore(stepCard, stepCard.previousElementSibling);
                updateStepNumbers();
            }
            closeStepMenu();
        }

        function moveStepDown() {
            const modal = document.getElementById('stepMenuModal');
            const stepId = modal.dataset.currentStepId;
            const stepCard = document.querySelector(`[data-step-id="${stepId}"]`);
            
            if (stepCard && stepCard.nextElementSibling) {
                stepCard.parentNode.insertBefore(stepCard.nextElementSibling, stepCard);
                updateStepNumbers();
            }
            closeStepMenu();
        }

        // SOP操作函数
        function duplicateSop() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopCard = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopCard) {
                const clonedSop = sopCard.cloneNode(true);
                sopCounter++;
                clonedSop.dataset.sopId = sopCounter;
                
                // 更新克隆SOP中的ID和事件
                clonedSop.innerHTML = clonedSop.innerHTML.replace(new RegExp(sopId, 'g'), sopCounter);
                
                sopCard.parentNode.insertBefore(clonedSop, sopCard.nextSibling);
                updateSopNumbers();
            }
            closeSopMenu();
        }

        function moveSopUp() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopCard = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopCard && sopCard.previousElementSibling) {
                sopCard.parentNode.insertBefore(sopCard, sopCard.previousElementSibling);
                updateSopNumbers();
            }
            closeSopMenu();
        }

        function moveSopDown() {
            const modal = document.getElementById('sopMenuModal');
            const sopId = modal.dataset.currentSopId;
            const sopCard = document.querySelector(`[data-sop-id="${sopId}"]`);
            
            if (sopCard && sopCard.nextElementSibling) {
                sopCard.parentNode.insertBefore(sopCard.nextElementSibling, sopCard);
                updateSopNumbers();
            }
            closeSopMenu();
        }

        // 媒体上传处理函数
        function handleStepMediaUpload(event) {
            const file = event.target.files[0];
            const modal = document.getElementById('mediaUploadModal');
            const stepId = modal.dataset.currentStepId;
            
            if (file && stepId) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaContainer = document.getElementById(`stepMedia${stepId}`);
                    const mediaElement = document.createElement('div');
                    mediaElement.className = 'relative';
                    mediaElement.innerHTML = `
                        <img src="${e.target.result}" class="w-20 h-20 object-cover rounded border">
                        <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs">
                            ×
                        </button>
                    `;
                    mediaContainer.appendChild(mediaElement);
                };
                reader.readAsDataURL(file);
            }
            closeMediaUpload();
        }

        function handleStepVideoUpload(event) {
            const file = event.target.files[0];
            const modal = document.getElementById('mediaUploadModal');
            const stepId = modal.dataset.currentStepId;
            
            if (file && stepId) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaContainer = document.getElementById(`stepMedia${stepId}`);
                    const mediaElement = document.createElement('div');
                    mediaElement.className = 'relative';
                    mediaElement.innerHTML = `
                        <video src="${e.target.result}" class="w-20 h-20 object-cover rounded border" controls></video>
                        <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs">
                            ×
                        </button>
                    `;
                    mediaContainer.appendChild(mediaElement);
                };
                reader.readAsDataURL(file);
            }
            closeMediaUpload();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initTheme();
                
                // 获取URL中的类别参数
                const category = getUrlParameter('category');
                
                // 根据类别初始化配方内容
                initRecipeByCategory(category);
                
                // 恢复之前保存的Tab状态
                const savedTab = localStorage.getItem('currentRecipeTab');
                if (savedTab && ['recipe', 'sop', 'steps'].includes(savedTab)) {
                    switchTab(savedTab);
                } else {
                    // 默认显示配方Tab
                    switchTab('recipe');
                }
                
                console.log('页面初始化完成');
            } catch (error) {
                console.error('页面初始化出错:', error);
                // 确保至少显示配方Tab
                switchTab('recipe');
            }
        });
        
        // 确保所有配料分组都有默认输入框
        function ensureDefaultIngredients() {
            const ingredientGroups = ['flour', 'starter', 'dry', 'wet', 'aux', 'base'];
            ingredientGroups.forEach(groupId => {
                const groupContainer = document.getElementById(`${groupId}-ingredients`);
                if (groupContainer && groupContainer.children.length === 0) {
                    addIngredient(groupId);
                }
            });
        }
        
        // 页面完全加载后确保默认输入框
        window.addEventListener('load', function() {
            setTimeout(ensureDefaultIngredients, 100);
        });
    </script>

    <!-- 材料搜索弹窗 -->
    <div id="materialSearchModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">搜索材料</h3>
                        <button onclick="closeMaterialSearch()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <input type="text" id="materialSearchInput" placeholder="输入材料名称" class="w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:border-blue-500 outline-none bg-white dark:bg-slate-700 text-gray-900 dark:text-white" oninput="searchMaterial()">
                    </div>
                    <div id="materialSuggestions" class="max-h-60 overflow-y-auto">
                        <!-- 材料建议列表 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 单位选择弹窗 -->
    <div id="unitModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">选择单位</h3>
                        <button onclick="closeUnitModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <div class="flex border-b border-gray-200 dark:border-slate-600">
                            <button onclick="switchUnitTab('weight')" class="unit-tab px-4 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600" data-tab="weight">质量</button>
                            <button onclick="switchUnitTab('volume')" class="unit-tab px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="volume">体积</button>
                            <button onclick="switchUnitTab('custom')" class="unit-tab px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="custom">自定义</button>
                        </div>
                    </div>
                    <div id="weightUnits" class="unit-content">
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="selectUnit('g')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">g</button>
                            <button onclick="selectUnit('kg')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">kg</button>
                            <button onclick="selectUnit('斤')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">斤</button>
                        </div>
                    </div>
                    <div id="volumeUnits" class="unit-content hidden">
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="selectUnit('ml')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">ml</button>
                            <button onclick="selectUnit('L')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">L</button>
                            <button onclick="selectUnit('杯')" class="unit-option p-2 text-center border border-gray-300 dark:border-slate-600 rounded hover:bg-gray-50 dark:hover:bg-slate-700">杯</button>
                        </div>
                    </div>
                    <div id="customUnits" class="unit-content hidden">
                        <div class="mb-4">
                            <input type="text" id="customUnitInput" placeholder="输入自定义单位" class="w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg focus:border-blue-500 outline-none bg-white dark:bg-slate-700 text-gray-900 dark:text-white">
                        </div>
                        <button onclick="addCustomUnit()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">添加自定义单位</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SOP类型选择弹窗 -->
    <div id="sopTypeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">选择SOP类型</h3>
                        <button onclick="closeSopTypeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-2">
                        <button onclick="selectSopType('搅拌')" class="w-full text-left p-3 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700">
                            <div class="font-medium">搅拌</div>
                            <div class="text-sm text-gray-500">设置搅拌参数</div>
                        </button>
                        <button onclick="selectSopType('发酵')" class="w-full text-left p-3 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700">
                            <div class="font-medium">发酵</div>
                            <div class="text-sm text-gray-500">设置发酵条件</div>
                        </button>
                        <button onclick="selectSopType('烘烤')" class="w-full text-left p-3 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700">
                            <div class="font-medium">烘烤</div>
                            <div class="text-sm text-gray-500">设置烘烤参数</div>
                        </button>
                        <button onclick="selectSopType('冷却')" class="w-full text-left p-3 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700">
                            <div class="font-medium">冷却</div>
                            <div class="text-sm text-gray-500">设置冷却条件</div>
                        </button>
                        <button onclick="selectSopType('其他')" class="w-full text-left p-3 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700">
                            <div class="font-medium">其他</div>
                            <div class="text-sm text-gray-500">自定义操作</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SOP操作菜单弹窗 -->
    <div id="sopMenuModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-xs">
                <div class="p-4">
                    <div class="space-y-2">
                        <button onclick="duplicateSop()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-copy mr-2"></i>
                            复制步骤
                        </button>
                        <button onclick="moveSopUp()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-arrow-up mr-2"></i>
                            上移
                        </button>
                        <button onclick="moveSopDown()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-arrow-down mr-2"></i>
                            下移
                        </button>
                        <button onclick="closeSopMenu()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg text-gray-500">
                            <i class="fas fa-times mr-2"></i>
                            取消
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 步骤操作菜单弹窗 -->
    <div id="stepMenuModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-xs">
                <div class="p-4">
                    <div class="space-y-2">
                        <button onclick="duplicateStep()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-copy mr-2"></i>
                            复制步骤
                        </button>
                        <button onclick="moveStepUp()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-arrow-up mr-2"></i>
                            上移
                        </button>
                        <button onclick="moveStepDown()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-arrow-down mr-2"></i>
                            下移
                        </button>
                        <button onclick="closeStepMenu()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg text-gray-500">
                            <i class="fas fa-times mr-2"></i>
                            取消
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 媒体上传选择弹窗 -->
    <div id="mediaUploadModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-slate-800 rounded-lg w-full max-w-xs">
                <div class="p-4">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">选择媒体类型</h3>
                    </div>
                    <div class="space-y-2">
                        <button onclick="selectStepImage()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-image mr-2"></i>
                            选择图片
                        </button>
                        <button onclick="selectStepVideo()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-video mr-2"></i>
                            选择视频
                        </button>
                        <button onclick="takeStepPhoto()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg">
                            <i class="fas fa-camera mr-2"></i>
                            拍照
                        </button>
                        <button onclick="closeMediaUpload()" class="w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-slate-700 rounded-lg text-gray-500">
                            <i class="fas fa-times mr-2"></i>
                            取消
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="stepMediaInput" class="hidden" accept="image/*" onchange="handleStepMediaUpload(event)">
    <input type="file" id="stepVideoInput" class="hidden" accept="video/*" onchange="handleStepVideoUpload(event)">

</body>
</html>