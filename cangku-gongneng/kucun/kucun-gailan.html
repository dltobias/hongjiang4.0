<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>库存概况 - 烘匠 BakeManager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-inventory {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .gradient-recipe {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        .gradient-message {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .gradient-order {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            position: relative;
            height: 200px;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .status-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航栏 -->
    <div class="gradient-primary px-4 py-4 shadow-lg">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button onclick="goBack()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300">
                    <i class="fas fa-chevron-left text-white text-lg"></i>
                </button>
                <div>
                    <h1 class="text-xl font-bold text-white">库存概况</h1>
                    <div class="flex items-center space-x-2 mt-1">
                        <div class="w-2 h-2 bg-green-300 rounded-full status-indicator"></div>
                        <span class="text-sm text-white text-opacity-80">实时更新</span>
                    </div>
                </div>
            </div>
            <button onclick="refreshData()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300">
                <i class="fas fa-sync-alt text-white text-lg" id="refreshIcon"></i>
            </button>
        </div>
    </div>

    <!-- 总览卡片 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalValue">¥128,500</div>
                    <div class="text-sm text-gray-500 mt-1">库存总值</div>
                    <div class="flex items-center justify-center mt-2">
                        <i class="fas fa-arrow-up text-green-500 text-xs mr-1"></i>
                        <span class="text-xs text-green-500">+5.2%</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-800" id="totalItems">156</div>
                    <div class="text-sm text-gray-500 mt-1">物料种类</div>
                    <div class="flex items-center justify-center mt-2">
                        <i class="fas fa-arrow-up text-green-500 text-xs mr-1"></i>
                        <span class="text-xs text-green-500">+3</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 库存状态统计 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">库存状态分布</h3>
            
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-2 relative">
                        <svg class="w-16 h-16 progress-ring">
                            <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="transparent"/>
                            <circle cx="32" cy="32" r="28" stroke="#10b981" stroke-width="4" fill="transparent"
                                    stroke-dasharray="175.929" stroke-dashoffset="52.779" class="progress-ring__circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-bold text-green-600">70%</span>
                        </div>
                    </div>
                    <div class="text-sm font-medium text-gray-800">库存充足</div>
                    <div class="text-xs text-gray-500">109种</div>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-2 relative">
                        <svg class="w-16 h-16 progress-ring">
                            <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="transparent"/>
                            <circle cx="32" cy="32" r="28" stroke="#f59e0b" stroke-width="4" fill="transparent"
                                    stroke-dasharray="175.929" stroke-dashoffset="123.151" class="progress-ring__circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-bold text-orange-600">30%</span>
                        </div>
                    </div>
                    <div class="text-sm font-medium text-gray-800">库存不足</div>
                    <div class="text-xs text-gray-500">35种</div>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-2 relative">
                        <svg class="w-16 h-16 progress-ring">
                            <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="transparent"/>
                            <circle cx="32" cy="32" r="28" stroke="#ef4444" stroke-width="4" fill="transparent"
                                    stroke-dasharray="175.929" stroke-dashoffset="158.336" class="progress-ring__circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-bold text-red-600">10%</span>
                        </div>
                    </div>
                    <div class="text-sm font-medium text-gray-800">即将过期</div>
                    <div class="text-xs text-gray-500">12种</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 分类统计 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">分类统计</h3>
                <button onclick="viewCategoryDetail()" class="text-sm text-blue-600">
                    查看详情 <i class="fas fa-chevron-right text-xs"></i>
                </button>
            </div>
            
            <div class="space-y-3" id="categoryStats">
                <!-- 分类统计项将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 仓库分布 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">仓库分布</h3>
                <button onclick="viewWarehouseDetail()" class="text-sm text-blue-600">
                    查看详情 <i class="fas fa-chevron-right text-xs"></i>
                </button>
            </div>
            
            <div class="space-y-3" id="warehouseStats">
                <!-- 仓库统计项将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 价值趋势 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">库存价值趋势</h3>
                <div class="flex space-x-2">
                    <button class="text-xs px-3 py-1 bg-blue-100 text-blue-600 rounded-full" onclick="switchPeriod('week')">7天</button>
                    <button class="text-xs px-3 py-1 bg-gray-200 text-gray-600 rounded-full" onclick="switchPeriod('month')">30天</button>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="h-40 bg-gray-100 rounded-lg flex items-end justify-around p-2" id="trendChart">
                    <!-- 趋势图表 -->
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500" id="chartLabels">
                    <!-- 图表标签 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 快速操作 -->
    <div class="px-4 mt-4 pb-8">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">快速操作</h3>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="exportReport()" class="stat-card bg-blue-50 p-4 rounded-xl text-left">
                    <i class="fas fa-download text-blue-600 mb-2 text-lg"></i>
                    <div class="text-sm font-medium text-gray-800">导出报表</div>
                    <div class="text-xs text-gray-500">生成库存报表</div>
                </button>
                
                <button onclick="viewAlerts()" class="stat-card bg-orange-50 p-4 rounded-xl text-left">
                    <i class="fas fa-exclamation-triangle text-orange-600 mb-2 text-lg"></i>
                    <div class="text-sm font-medium text-gray-800">查看预警</div>
                    <div class="text-xs text-gray-500">47个预警待处理</div>
                </button>
                
                <button onclick="inventoryCheck()" class="stat-card bg-green-50 p-4 rounded-xl text-left">
                    <i class="fas fa-clipboard-check text-green-600 mb-2 text-lg"></i>
                    <div class="text-sm font-medium text-gray-800">库存盘点</div>
                    <div class="text-xs text-gray-500">执行盘点任务</div>
                </button>
                
                <button onclick="viewHistory()" class="stat-card bg-purple-50 p-4 rounded-xl text-left">
                    <i class="fas fa-history text-purple-600 mb-2 text-lg"></i>
                    <div class="text-sm font-medium text-gray-800">历史记录</div>
                    <div class="text-xs text-gray-500">查看操作记录</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 分类数据
        const categoryData = [
            { name: '粉类', value: 45800, percentage: 35.6, color: 'bg-blue-500', icon: 'fa-wheat-awn' },
            { name: '油脂类', value: 32100, percentage: 25.0, color: 'bg-orange-500', icon: 'fa-oil-can' },
            { name: '糖类', value: 25700, percentage: 20.0, color: 'bg-green-500', icon: 'fa-cube' },
            { name: '乳制品', value: 15900, percentage: 12.4, color: 'bg-purple-500', icon: 'fa-glass-whiskey' },
            { name: '其他', value: 9000, percentage: 7.0, color: 'bg-gray-500', icon: 'fa-box' }
        ];

        // 仓库数据
        const warehouseData = [
            { name: '主原料仓', value: 68500, percentage: 53.3, utilization: 78, color: 'bg-blue-500', icon: 'fa-warehouse' },
            { name: '成品仓库', value: 35200, percentage: 27.4, utilization: 65, color: 'bg-green-500', icon: 'fa-box' },
            { name: '冷冻储存区', value: 18900, percentage: 14.7, utilization: 82, color: 'bg-cyan-500', icon: 'fa-snowflake' },
            { name: '临时仓库', value: 5900, percentage: 4.6, utilization: 45, color: 'bg-gray-500', icon: 'fa-warehouse' }
        ];

        // 趋势数据
        const trendData = {
            week: {
                labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                values: [122000, 125000, 123000, 126000, 128500, 127000, 128500]
            },
            month: {
                labels: ['第1周', '第2周', '第3周', '第4周'],
                values: [115000, 120000, 125000, 128500]
            }
        };

        let currentPeriod = 'week';

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderCategoryStats();
            renderWarehouseStats();
            renderTrendChart();
        });

        // 渲染分类统计
        function renderCategoryStats() {
            const container = document.getElementById('categoryStats');
            container.innerHTML = categoryData.map(item => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 ${item.color} rounded-lg flex items-center justify-center">
                            <i class="fas ${item.icon} text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-800">${item.name}</div>
                            <div class="text-xs text-gray-500">¥${item.value.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-medium text-gray-800">${item.percentage}%</div>
                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                            <div class="${item.color} h-2 rounded-full" style="width: ${item.percentage}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 渲染仓库统计
        function renderWarehouseStats() {
            const container = document.getElementById('warehouseStats');
            container.innerHTML = warehouseData.map(item => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 ${item.color} rounded-lg flex items-center justify-center">
                            <i class="fas ${item.icon} text-white"></i>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-800">${item.name}</div>
                            <div class="text-xs text-gray-500">¥${item.value.toLocaleString()} · 利用率 ${item.utilization}%</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-medium text-gray-800">${item.percentage}%</div>
                        <div class="w-16 h-2 bg-gray-200 rounded-full mt-1">
                            <div class="${item.color} h-2 rounded-full" style="width: ${item.percentage}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 渲染趋势图表
        function renderTrendChart() {
            const chart = document.getElementById('trendChart');
            const labels = document.getElementById('chartLabels');
            const data = trendData[currentPeriod];
            
            const maxValue = Math.max(...data.values);
            
            chart.innerHTML = data.values.map((value, index) => {
                const height = (value / maxValue) * 100;
                return `<div class="w-8 bg-blue-500 rounded-t mx-1 relative group" style="height: ${height}%">
                    <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">
                        ¥${(value / 1000).toFixed(0)}K
                    </div>
                </div>`;
            }).join('');
            
            labels.innerHTML = data.labels.map(label => `<span>${label}</span>`).join('');
        }

        // 切换时间周期
        function switchPeriod(period) {
            currentPeriod = period;
            
            // 更新按钮状态
            const buttons = document.querySelectorAll('[onclick^="switchPeriod"]');
            buttons.forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-600');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-600');
            event.target.classList.add('bg-blue-100', 'text-blue-600');
            
            renderTrendChart();
        }

        // 刷新数据
        function refreshData() {
            const icon = document.getElementById('refreshIcon');
            icon.classList.add('animate-spin');
            
            showToast('正在刷新数据...', 'info');
            
            setTimeout(() => {
                icon.classList.remove('animate-spin');
                showToast('数据刷新成功', 'success');
                
                // 重新渲染数据
                renderCategoryStats();
                renderWarehouseStats();
                renderTrendChart();
            }, 1500);
        }

        // 查看分类详情
        function viewCategoryDetail() {
            showToast('分类详情功能开发中', 'info');
        }

        // 查看仓库详情
        function viewWarehouseDetail() {
            window.location.href = 'cangku-liebiao.html';
        }

        // 导出报表
        function exportReport() {
            showToast('正在生成库存报表...', 'info');
            setTimeout(() => {
                showToast('报表导出成功', 'success');
            }, 2000);
        }

        // 查看预警
        function viewAlerts() {
            window.location.href = 'kucunyujingye-mobile.html';
        }

        // 库存盘点
        function inventoryCheck() {
            showToast('库存盘点功能开发中', 'info');
        }

        // 查看历史
        function viewHistory() {
            showToast('历史记录功能开发中', 'info');
        }

        // 返回上一页
        function goBack() {
            window.location.href = '../erp-zhuye-canku.html';
        }

        // 显示提示消息
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg text-white text-sm z-50 transition-opacity duration-300 opacity-0';
            
            switch(type) {
                case 'success':
                    toast.classList.add('bg-green-600');
                    break;
                case 'error':
                    toast.classList.add('bg-red-600');
                    break;
                case 'warning':
                    toast.classList.add('bg-yellow-600');
                    break;
                default:
                    toast.classList.add('bg-blue-600');
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-90');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('opacity-90');
                toast.classList.add('opacity-0');
                
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html> 