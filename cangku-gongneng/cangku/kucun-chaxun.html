<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>库存查询 - 烘匠 BakeManager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradient-primary {
            background: linear-gradient(135deg, #ff9f43 0%, #ff8c00 100%);
        }
        .gradient-inventory {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .gradient-recipe {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        .gradient-message {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .gradient-order {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .inventory-card {
            transition: all 0.3s ease;
        }
        .inventory-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .filter-chip {
            transition: all 0.3s ease;
        }
        .filter-chip.active {
            background: linear-gradient(135deg, #ff9f43 0%, #ff8c00 100%);
            color: white;
        }
        
        .status-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航栏 -->
    <div class="gradient-primary px-4 py-4 shadow-lg">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <button onclick="goBack()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300">
                    <i class="fas fa-chevron-left text-white text-lg"></i>
                </button>
                <div>
                    <h1 class="text-xl font-bold text-white" id="pageTitle">库存查询</h1>
                    <p class="text-sm text-white text-opacity-80" id="warehouseInfo">查看仓库库存详情</p>
                </div>
            </div>
            <button onclick="refreshData()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300">
                <i class="fas fa-sync-alt text-white text-lg" id="refreshIcon"></i>
            </button>
        </div>
    </div>

    <!-- 搜索和筛选 -->
    <div class="px-4 mt-4">
        <div class="relative mb-4">
            <input type="text" placeholder="搜索物料名称、编号或批次..." 
                   class="w-full bg-white rounded-xl px-4 py-3 pl-10 text-sm border border-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                   id="searchInput">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
        
        <!-- 筛选标签 -->
        <div class="flex space-x-2 overflow-x-auto pb-2">
            <button class="filter-chip active px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 whitespace-nowrap" data-filter="all">
                全部
            </button>
            <button class="filter-chip px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 whitespace-nowrap" data-filter="low">
                低库存
            </button>
            <button class="filter-chip px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 whitespace-nowrap" data-filter="sufficient">
                库存充足
            </button>
            <button class="filter-chip px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700 whitespace-nowrap" data-filter="expiring">
                即将过期
            </button>
        </div>
    </div>

    <!-- 库存统计概览 -->
    <div class="px-4 mt-4">
        <div class="bg-white rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-800">库存概览</h3>
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full status-indicator"></div>
                    <span class="text-xs text-gray-500">实时更新</span>
                </div>
            </div>
            
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <div class="text-xl font-bold text-gray-800" id="totalItems">--</div>
                    <div class="text-xs text-gray-500 mt-1">总物料</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-green-600" id="sufficientItems">--</div>
                    <div class="text-xs text-gray-500 mt-1">充足</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-orange-600" id="lowItems">--</div>
                    <div class="text-xs text-gray-500 mt-1">低库存</div>
                </div>
                <div>
                    <div class="text-xl font-bold text-red-600" id="expiringItems">--</div>
                    <div class="text-xs text-gray-500 mt-1">即将过期</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 库存列表 -->
    <div class="px-4 mt-4 pb-24">
        <div id="inventoryList" class="space-y-3">
            <!-- 库存卡片将通过JavaScript动态生成 -->
        </div>
        
        <!-- 空状态 -->
        <div id="emptyState" class="text-center py-12 hidden">
            <i class="fas fa-boxes text-gray-300 text-6xl mb-4"></i>
            <h3 class="text-lg font-semibold text-gray-600 mb-2">暂无库存数据</h3>
            <p class="text-sm text-gray-500">该仓库暂无物料库存</p>
        </div>
    </div>

    <script>
        // 模拟库存数据
        const inventoryData = [
            {
                id: 1,
                name: '高筋面粉',
                code: 'MAT001',
                category: '粉类',
                currentStock: 15,
                unit: 'kg',
                minStock: 20,
                maxStock: 100,
                price: 8.5,
                batch: 'B20231201',
                expiryDate: '2024-06-01',
                location: 'A区-1层-001',
                supplier: '金龙鱼食品',
                status: 'low'
            },
            {
                id: 2,
                name: '低筋面粉',
                code: 'MAT002',
                category: '粉类',
                currentStock: 35,
                unit: 'kg',
                minStock: 20,
                maxStock: 100,
                price: 7.8,
                batch: 'B20231205',
                expiryDate: '2024-06-05',
                location: 'A区-1层-002',
                supplier: '金龙鱼食品',
                status: 'sufficient'
            },
            {
                id: 3,
                name: '黄油',
                code: 'MAT003',
                category: '油脂类',
                currentStock: 8,
                unit: 'kg',
                minStock: 15,
                maxStock: 50,
                price: 25.0,
                batch: 'B20231128',
                expiryDate: '2024-01-15',
                location: 'B区-冷藏-001',
                supplier: '安佳乳业',
                status: 'expiring'
            },
            {
                id: 4,
                name: '白砂糖',
                code: 'MAT004',
                category: '糖类',
                currentStock: 45,
                unit: 'kg',
                minStock: 25,
                maxStock: 80,
                price: 6.2,
                batch: 'B20231210',
                expiryDate: '2025-12-31',
                location: 'A区-2层-001',
                supplier: '太古糖业',
                status: 'sufficient'
            },
            {
                id: 5,
                name: '鸡蛋',
                code: 'MAT005',
                category: '蛋类',
                currentStock: 120,
                unit: '个',
                minStock: 100,
                maxStock: 300,
                price: 0.8,
                batch: 'B20231215',
                expiryDate: '2024-01-05',
                location: 'B区-冷藏-002',
                supplier: '德青源',
                status: 'expiring'
            },
            {
                id: 6,
                name: '牛奶',
                code: 'MAT006',
                category: '乳制品',
                currentStock: 25,
                unit: 'L',
                minStock: 30,
                maxStock: 100,
                price: 12.5,
                batch: 'B20231218',
                expiryDate: '2024-01-10',
                location: 'B区-冷藏-003',
                supplier: '蒙牛乳业',
                status: 'low'
            },
            {
                id: 7,
                name: '可可粉',
                code: 'MAT007',
                category: '调料',
                currentStock: 5,
                unit: 'kg',
                minStock: 8,
                maxStock: 30,
                price: 45.0,
                batch: 'B20231120',
                expiryDate: '2024-11-20',
                location: 'A区-3层-001',
                supplier: '好时食品',
                status: 'low'
            },
            {
                id: 8,
                name: '香草精',
                code: 'MAT008',
                category: '调料',
                currentStock: 2,
                unit: 'L',
                minStock: 3,
                maxStock: 10,
                price: 85.0,
                batch: 'B20231115',
                expiryDate: '2025-11-15',
                location: 'A区-3层-002',
                supplier: '麦德龙',
                status: 'low'
            }
        ];

        let filteredData = [...inventoryData];
        let currentFilter = 'all';
        let warehouseId = null;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            bindEvents();
        });

        // 初始化页面
        function initializePage() {
            // 从URL参数获取仓库ID
            const urlParams = new URLSearchParams(window.location.search);
            warehouseId = urlParams.get('warehouse');
            
            if (warehouseId) {
                updatePageTitle();
            }
            
            renderInventoryList();
            updateStatistics();
        }

        // 更新页面标题
        function updatePageTitle() {
            const warehouseNames = {
                '1': '主原料仓',
                '2': '成品仓库',
                '3': '冷冻储存区'
            };
            
            const warehouseName = warehouseNames[warehouseId] || '仓库';
            document.getElementById('pageTitle').textContent = `${warehouseName} - 库存查询`;
            document.getElementById('warehouseInfo').textContent = `查看${warehouseName}的库存详情`;
        }

        // 绑定事件
        function bindEvents() {
            // 搜索功能
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                performSearch(this.value);
            });

            // 筛选功能
            const filterChips = document.querySelectorAll('.filter-chip');
            filterChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    // 更新筛选状态
                    filterChips.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 执行筛选
                    const filter = this.getAttribute('data-filter');
                    currentFilter = filter;
                    filterInventory(filter);
                });
            });
        }

        // 渲染库存列表
        function renderInventoryList() {
            const container = document.getElementById('inventoryList');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredData.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredData.map(item => `
                <div class="inventory-card bg-white rounded-xl p-4 shadow-sm" onclick="viewItemDetail(${item.id})">
                    <div class="flex items-start space-x-4">
                        <!-- 物料图标 -->
                        <div class="w-12 h-12 ${getItemIconBg(item.category)} rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas ${getItemIcon(item.category)} text-white text-lg"></i>
                        </div>
                        
                        <!-- 物料信息 -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 truncate">${item.name}</h3>
                                    <div class="flex items-center space-x-2 mt-1">
                                        <span class="text-sm text-gray-500">${item.code}</span>
                                        <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">${item.category}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold ${getStockColor(item.status)}">${item.currentStock}</div>
                                    <div class="text-xs text-gray-500">${item.unit}</div>
                                </div>
                            </div>
                            
                            <!-- 库存状态栏 -->
                            <div class="mb-3">
                                <div class="flex items-center justify-between text-xs text-gray-500 mb-1">
                                    <span>库存状态</span>
                                    <span>${item.currentStock}/${item.maxStock} ${item.unit}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full ${getProgressColor(item.status)}" 
                                         style="width: ${Math.min((item.currentStock / item.maxStock) * 100, 100)}%"></div>
                                </div>
                            </div>
                            
                            <!-- 详细信息 -->
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">批次：</span>
                                    <span class="font-medium">${item.batch}</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">位置：</span>
                                    <span class="font-medium">${item.location}</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">过期时间：</span>
                                    <span class="font-medium ${getExpiryColor(item.expiryDate)}">${formatDate(item.expiryDate)}</span>
                                </div>
                                <div>
                                    <span class="text-gray-500">单价：</span>
                                    <span class="font-medium">¥${item.price}</span>
                                </div>
                            </div>
                            
                            <!-- 状态标签 -->
                            <div class="flex items-center justify-between mt-3">
                                <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(item.status)}">
                                    ${getStatusText(item.status)}
                                </span>
                                <div class="text-xs text-gray-500">
                                    供应商：${item.supplier}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 获取物料图标
        function getItemIcon(category) {
            const icons = {
                '粉类': 'fa-wheat-awn',
                '油脂类': 'fa-oil-can',
                '糖类': 'fa-cube',
                '蛋类': 'fa-egg',
                '乳制品': 'fa-glass-whiskey',
                '调料': 'fa-seedling'
            };
            return icons[category] || 'fa-box';
        }

        // 获取物料图标背景
        function getItemIconBg(category) {
            const backgrounds = {
                '粉类': 'gradient-primary',
                '油脂类': 'gradient-message',
                '糖类': 'gradient-recipe',
                '蛋类': 'gradient-order',
                '乳制品': 'gradient-inventory',
                '调料': 'gradient-primary'
            };
            return backgrounds[category] || 'gradient-primary';
        }

        // 获取库存颜色
        function getStockColor(status) {
            const colors = {
                'sufficient': 'text-green-600',
                'low': 'text-orange-600',
                'expiring': 'text-red-600'
            };
            return colors[status] || 'text-gray-600';
        }

        // 获取进度条颜色
        function getProgressColor(status) {
            const colors = {
                'sufficient': 'bg-green-500',
                'low': 'bg-orange-500',
                'expiring': 'bg-red-500'
            };
            return colors[status] || 'bg-gray-500';
        }

        // 获取状态标签样式
        function getStatusBadgeClass(status) {
            const classes = {
                'sufficient': 'bg-green-100 text-green-600',
                'low': 'bg-orange-100 text-orange-600',
                'expiring': 'bg-red-100 text-red-600'
            };
            return classes[status] || 'bg-gray-100 text-gray-600';
        }

        // 获取状态文本
        function getStatusText(status) {
            const texts = {
                'sufficient': '库存充足',
                'low': '库存不足',
                'expiring': '即将过期'
            };
            return texts[status] || '正常';
        }

        // 获取过期时间颜色
        function getExpiryColor(expiryDate) {
            const today = new Date();
            const expiry = new Date(expiryDate);
            const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 7) return 'text-red-600';
            if (diffDays <= 30) return 'text-orange-600';
            return 'text-gray-600';
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        // 筛选库存
        function filterInventory(filter) {
            if (filter === 'all') {
                filteredData = [...inventoryData];
            } else {
                filteredData = inventoryData.filter(item => item.status === filter);
            }
            renderInventoryList();
            updateStatistics();
        }

        // 搜索功能
        function performSearch(query) {
            if (!query.trim()) {
                filterInventory(currentFilter);
                return;
            }
            
            const searchTerm = query.toLowerCase();
            filteredData = inventoryData.filter(item => 
                item.name.toLowerCase().includes(searchTerm) ||
                item.code.toLowerCase().includes(searchTerm) ||
                item.batch.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm)
            );
            renderInventoryList();
            updateStatistics();
        }

        // 更新统计信息
        function updateStatistics() {
            const total = filteredData.length;
            const sufficient = filteredData.filter(item => item.status === 'sufficient').length;
            const low = filteredData.filter(item => item.status === 'low').length;
            const expiring = filteredData.filter(item => item.status === 'expiring').length;
            
            document.getElementById('totalItems').textContent = total;
            document.getElementById('sufficientItems').textContent = sufficient;
            document.getElementById('lowItems').textContent = low;
            document.getElementById('expiringItems').textContent = expiring;
        }

        // 查看物料详情
        function viewItemDetail(itemId) {
            const item = inventoryData.find(i => i.id === itemId);
            if (item) {
                showToast(`查看 ${item.name} 详情`, 'info');
                // 这里可以跳转到物料详情页面
                // window.location.href = `cailiao-detail-mobile.html?id=${itemId}`;
            }
        }

        // 刷新数据
        function refreshData() {
            const icon = document.getElementById('refreshIcon');
            icon.classList.add('animate-spin');
            
            showToast('正在刷新数据...', 'info');
            
            setTimeout(() => {
                icon.classList.remove('animate-spin');
                showToast('数据刷新成功', 'success');
                renderInventoryList();
                updateStatistics();
            }, 1500);
        }

        // 返回上一页
        function goBack() {
            if (warehouseId) {
                window.location.href = `cangku-xiangqing.html?id=${warehouseId}`;
            } else {
                window.location.href = 'cangku-liebiao.html';
            }
        }

        // 显示提示消息
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg text-white text-sm z-50 transition-opacity duration-300 opacity-0';
            
            switch(type) {
                case 'success':
                    toast.classList.add('bg-green-600');
                    break;
                case 'error':
                    toast.classList.add('bg-red-600');
                    break;
                case 'warning':
                    toast.classList.add('bg-yellow-600');
                    break;
                default:
                    toast.classList.add('bg-orange-600');
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-90');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('opacity-90');
                toast.classList.add('opacity-0');
                
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html> 